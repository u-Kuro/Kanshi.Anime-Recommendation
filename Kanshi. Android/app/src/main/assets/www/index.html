<!DOCTYPE html>
<html lang="en" class="darkMode">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanshi. - Anime Recommendation</title>
    <link rel="shortcut icon" type="image/x-icon" href="./public/logo.png" />
    <!-- Jquery -->
    <script src="./js-css/jquery-3.6.0.js" defer></script>
    <!-- Swal 2 -->
    <link rel="preload" href="./js-css/swal2/sweetalert2.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="./js-css/swal2/sweetalert2.css"></noscript>
    <script src="./js-css/swal2/sweetalert2.all.js" defer></script>
    <!-- Table Sort -->
    <link rel="preload" href="./js-css/jquery tablesorter/theme.default.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="./js-css/jquery tablesorter/theme.default.min.css"></noscript>
    <script type="text/javascript" src="./js-css/jquery tablesorter/jquery.tablesorter.js" defer></script>
    <script type="text/javascript" src="./js-css/jquery tablesorter/jquery.metadata.min.js" defer></script>
    <script type="text/javascript" src="./js-css/jquery tablesorter/jquery.tablesorter.pager.min.js" defer></script>
    <!-- Datalist Search Code -->
    <link rel="preload" href="./js-css/flexdatalist/jquery.flex-datalist-v1.0.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="./js-css/flexdatalist/jquery.flex-datalist-v1.0.css"></noscript>
    <script src="./js-css/flexdatalist/jquery.flex-datalist-v1.4.js" defer></script>
    <!-- Bootstrap -->
    <link rel="preload" href="./js-css/bootstrap-3.3.6.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="./js-css/bootstrap-3.3.6.min.css"></noscript>
    <!-- Fontawesome -->
    <link rel="preload" href="./js-css/font-awesome.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="./js-css/font-awesome.min.css"></noscript>
    <script src="./js-css/fontawesome-5.0.js" crossorigin="anonymous" defer></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PPMY92TJCE" defer></script>
    <script defer>
        window.onload = () => {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-PPMY92TJCE');
        }
    </script>
    <style>
            /* Change For Text Size */
            :root{
                font-size: 0.9rem !important;
            }
            /* Change/Add to Class/Tag of desired division for Padding */
            .Home,
            .overlay{
                padding-inline: clamp(0px, 5vw, 75px) !important;
            }
            /* Default */
            html,
            body {
                height: 100%;
                width: 100%;
                overflow: auto;
            }
            :root{
                font-size: 0.9rem;
                background-color: #fff;
                font-family: sans-serif;
                z-index: 0;
                min-width: 100%;
                min-height: 100%;
                overflow:auto;
            }
            :root>*{
                background-color: #fff;
                min-width: inherit;
                min-height: inherit;
            }
            *,
            ::after,
            ::before{
                margin: 0;
                padding: 0;
                text-indent: 0;
                box-sizing: border-box;
            }
            /* Text */
            .textLogo{
                font-size: clamp(1.6rem, 2vw,1.6rem) !important;
            }
            h1{
                font-size: clamp(1.3rem, 2vw,1.3rem);
            }
            h2{
                font-size: clamp(1.05rem, 2vw,1.05rem);
            }
            h3{
                font-size: clamp(1.05rem, 2vw,1.05rem);
            }
            p,
            label,
            input[type="text"]{
                font-size: clamp(0.95rem, 2vw,0.95rem);
            }
            h4{
                font-size: clamp(1rem, 2vw,1rem);
            }
            h5{
                font-size: clamp(0.9rem, 2vw,0.9rem);
            }
            h6{
                font-size: clamp(0.8rem, 2vw,0.8rem);
            }
            h1,
            h2,
            h3,
            h4,
            h5,
            h6,
            p,
            input,
            textarea,
            .textLogo{
                cursor:default;
                -webkit-hyphens:manual;
                hyphens:manual;
                white-space:pre-wrap;
                word-break:break-word;
                overflow-wrap:break-word;
                transform-origin: left;
            }
            h1,
            h2,
            h3,
            h4,
            h5,
            h6,
            p,
            .textLogo{
                max-width: -moz-fit-content;
                min-width: -moz-fit-content;
                min-width: -webkit-fill-available;
                max-width: fit-content;
                min-width: fit-content;
            }
            /* Forms */
            input,
            textarea{
                outline: 0;
            }
            input[type=text]{
                -ms-user-select: text;
                -webkit-user-select: text;
                user-select: text;
            }
            button,
            button>*{
                cursor: pointer;
            }
            dialog{
                border: 0;
            }
            img{
                max-width: 100%;
            }
            /* Additional */
            *{
                scrollbar-width: none !important;
            }
            body{
                -ms-overflow-style: none;
            }
            ::-webkit-scrollbar {
                display: none;
            }
            .example {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            button {
                background-color: black;
                color: white;
            }
            input {
                padding: 0.5em;
            }
            .userInput {
                width: min-content;
                border-color: rgb(118, 118, 118);
                border-width: 2px;
                border-style: inset;
                border-radius: 0px;
                background-color: rgb(255, 255, 255);
            }
            .loader {
                position: fixed;
                left: 0px;
                top: 0px;
                width: 100%;
                height: 100%;
                z-index: 9999;
                background: url('./public/loading.gif')
                    50% 50% no-repeat
                    rgb(0, 0, 0)
            }
            .loader > * {
                justify-content: center;
                min-height: 100%;
                align-items: center;
                display: flex;
                margin-top: 150px;
                color: wheat;
                text-align: center;
            }
            html,body,.home{
                width: 100%;
                min-height: 100%;
                height: 100%;
            }
            label{margin: 0}
            .searchData,.table-responsive{
                margin-top: 15px;
                margin-bottom: 15px;
            }
            .searchData,
            .btn-container{
                margin-bottom: 10px !important;
            }
            .table-responsive{
                margin-top: 10px !important;
            }
            .flexdatalist-multiple > .value {
                height: fit-content;
                max-height: fit-content;
                min-height: fit-content;
                max-width: -moz-fit-content;
                max-width: fit-content;
                cursor: pointer;
            }
            .userInputContainer,.filter-container,.btn-container{
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
                margin-block: 15px;
            }
            .userInputContainer>:not(label),.filter-container>:not(label),.btn-container>:not(label){
                flex-grow: 1;
            }
            .flex0.flexdatalist-multiple{
                display: flex;
                max-height: 100px;
                min-height: 100px;
                height: 100px;
                overflow-y: scroll;
            }
            .flex1.flexdatalist-multiple,
            .flex2.flexdatalist-multiple{
                display: flex;
                max-height: 175px;
                min-height: 175px;
                height: 175px;
                overflow-y: scroll;
            }
            .flex0.flexdatalist-multiple{
                flex-wrap: wrap;
            }
            .flex1.flexdatalist-multiple,
            .flex2.flexdatalist-multiple{
                flex-wrap: wrap-reverse;
            }
            .flexdatalist-multiple>.flexdatalist-multiple-value{
                flex-grow: 1;
                display: flex !important;
                min-width: calc(100% - 10px) !important;
            }
            .flexdatalist-multiple>.flexdatalist-multiple-value>.flexdatalist-alias{
                outline: none;
                flex-grow: 1;
                padding-left: 5px !important;
                padding-right: 5px !important;
            }
            .tableLoadingContainer{
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .show-hidden-anime-btn{
                text-align: center !important;
                min-width: 85px !important;
            }
            header {
                background: url('./public/header.png');
                text-align: left;
                width: 100%;
                height: 165px;
                background-size: contain;
                position: relative;
                overflow: hidden;
                border-radius: 0 0 50% 50% / 5%;
            }
            header .overlay{
                width: 100%;
                height: 100%;
                padding: 1.75em;
                color: #FFF;
                background-image: linear-gradient( 135deg, #39343c69 10%, #6d00006b 100%);
            }
            header .overlay>*{
                padding-right: 50%;
            }
            button {
                border: none;
                outline: none;
                padding: 10px 20px;
                border-radius: 50px;
                box-shadow: 0 3px 20px 0 #0000003b;
            }
            button:hover{
                cursor: pointer;
            }
            a,
            a:hover,
            a:focus {
                color: #864548;
            }
            #anime-table{
                border: 1px solid #ddd !important;
            }
            #animeRecommendationList{
                content-visibility: auto;
            }
            /* #animeRecommendationList > tr > *{
                white-space: nowrap;
            } */
            #updateIntervalBtn,
            #updateBtn,
            #showAllAnime{
                display: none;
            }
            #hiddenUnhiddenBtn{
                background: black !important;
                color: white !important;
                max-width: -moz-fit-content !important;
                max-width: fit-content !important;
                cursor: pointer;
            }
            #searchBtn:hover,
            #searchBtn:focus{
                color: white;
            }
            .anime-table-headers > th{
                vertical-align: middle !important;
                padding: 1em !important;
            }
            .tablesorter-header-inner{
                margin-right: 0.5em !important;
                min-width: max-content !important;
            }
            .show-all-anime{
                background: black !important;
                color: white !important;
                border-radius: 5%;
                max-width: -moz-fit-content !important;
                max-width: fit-content !important;
            }
            .tablesorter-default{
                margin: 0 !important;
            }
            .hide-anime-column{
                padding-block: 1.5em !important;
                vertical-align: middle !important;
                text-align: center !important;
                -ms-user-select: none !important;
                -webkit-user-select: none !important;
                user-select: none !important;
            }
            .item > td {
                vertical-align: middle !important;
            }
            .anime-score{
                text-align: center !important;
                max-width: 50px !important;
                text-overflow: ellipsis !important;
                overflow: hidden !important;
                cursor: pointer;
            }
            .anime-score > div {
                display: flex;
                gap: 0.5ch;
                max-width: 50px !important;
                text-overflow: ellipsis !important;
                overflow: hidden !important;
            }
            .spinner {
                border: 2px solid #f3f3f3;
                border-top: 2px solid #B06D70;
                border-radius: 50%;
                width: 13px;
                min-width: 13px;
                height: 13px;
                min-height: 13px;
                animation: spin 2s linear infinite;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .data-status-container{
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .table-responsive{
                border: 1px solid #dddddd;
                min-height: 556px !important;
                margin-bottom: 100px !important;
            }
            .pager{
                position: fixed;
                bottom: 0;
                width: 100%;
                border-radius: 50% 50% 0 0 / 5%;
                background: rgb(0,0,0,0.925);
                color: white;
                margin: 0;
                z-index: 100;
            }
            .pager-form{
                display: flex;
                justify-content: center;
                align-items: center;
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .pager-form>*{
                flex: 1;
                min-width: -moz-fit-content;
                min-width: -webkit-fill-available;
                min-width: fit-content;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
            }
            .pager-form>*>*{
                flex: 1;
                min-width: -moz-fit-content;
                min-width: -webkit-fill-available;
                min-width: fit-content;
                cursor: pointer;
            }
            .tablesorter-pager {
                padding: 1em;
            }
            td.tablesorter-pager {
                background-color: #e6eeee;
                margin: 0;
            }
            .tablesorter-pager img {
                vertical-align: middle;
                margin-right: 2px;
                cursor: pointer;
            }
            .tablesorter-pager .pagedisplay {
                margin-block: auto;
                text-align: left;
            }
            .tablesorter-pager select {
                margin: 0;
                padding: 0;
            }
            .tablesorter-pager.disabled {
                display: none;
            }
            .tablesorter-pager .disabled {
                opacity: 0.5;
                filter: alpha(opacity=50);
                cursor: default;
            }
            .pagedisplay{
                max-width: -moz-fit-content;
                max-width: fit-content;
            }
            .pagenum{
                height: -webkit-fill-available;
                height: fit-content;
                border: transparent;
                text-align: center;
                outline: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background-color: transparent !important;
            }
            .pagenum>*{
                background-color: black;
                color: white;
            }
            .endPage{
                text-align: left;
            }
            .nav{
                z-index: 100;
                position: fixed;
                width: 100%;
                height: 50px;
                display: flex;
                color: white;
                justify-content: space-between;
                background-color: rgb(0,0,0,0.925);
                padding: 1em;
                align-items: center;
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .nav > div{
                flex: 1;
                display: flex;
            }
            .nav img{
                margin-left: auto;
                max-height: 40px;
                cursor: pointer;
            }
            .nav h1{
                cursor: pointer;
            }
            header{
                margin-top: 50px;
            }
            #menu-container {
                overflow: auto;
                top: 0px;
                right: 0;
                position: fixed;
                z-index: 99;
                height: 100%;
                width: 100%;
                background-color: rgb(0, 0, 0, 0.925);
                color: white;
                display: none;
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            #menu-container>div{
                margin-bottom: 63px;
                padding: 1em;
                margin-top: 50px;
                display: flex;
                flex-wrap: wrap;
                gap: 1.5em;
                height: min-content;
            }
            #menu-container>div>button{
                -moz-box-shadow: 0 3px 20px 0 #af6e7138 !important;
                -webkit-box-shadow: 0 3px 20px 0 #af6e7138 !important;
                box-shadow: 0 3px 20px 0 #af6e7138 !important;
            }
            .no-before::before{
                content: none;
            }
            .whitespace-pre-wrap{
                white-space: pre-wrap !important;
            }
            .swal2-container{
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .swal2-validation-message{
                color: black !important;
            }
            .swal2-validation-message.no-before::before{
                content: none;
            }
            .swal2-validation-message.error-before::before {
                content: "!";
                display: inline-block;
                width: 1.5em;
                min-width: 1.5em;
                height: 1.5em;
                margin: 0 0.625em;
                border-radius: 50%;
                background-color: #f27474;
                color: #fff;
                font-weight: 600;
                line-height: 1.5em;
                text-align: center;
            }
            .swal2-validation-message.success-before::before {
                content: "✓";
                display: inline-block;
                width: 1.5em;
                min-width: 1.5em;
                height: 1.5em;
                margin: 0 0.625em;
                border-radius: 50%;
                background-color: #78f274;
                color: #fff;
                font-weight: 600;
                line-height: 1.5em;
                text-align: center;
            }
            .swal2-actions{
                justify-content: space-evenly !important;
                width: 100% !important;
                gap: 1em !important;
                padding-inline: 1em !important;
            }
            .swal2-actions button{
                min-width: -moz-fit-content !important;
                min-width: -webkit-fill-available !important;
                min-width: fit-content !important;
                flex:1 !important;
            }
            .swal2-footer{
                justify-content: space-evenly !important;
                width: 100% !important;
                flex-wrap: wrap;
                gap: 1.5ch;
            }
            .no-border{
                border: none !important;
            }
            .swal2-footer > *{
                flex: 1 !important;
                min-width: 100% !important;
                text-align: center !important;
            }
            .swal-overlay-custom{
                display: none;
                position: fixed;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                text-align: center;
                font-size: 0;
                overflow-y: auto;
                background-color: rgba(0,0,0,.4);
                z-index: 10000;
                pointer-events: none;
                opacity: 0;
                transition: opacity .3s;
            }
            .swal-overlay--show-modal-custom{
                opacity: 1;
                pointer-events: auto;
            }
            .swal-overlay--show-modal-custom .swal-modal-custom{
                opacity: 1;
                pointer-events: auto;
                box-sizing: border-box;
                -webkit-animation: showSweetAlert .3s;
                animation: showSweetAlert .3s;
                will-change: transform;
            }
            @keyframes swal2-show-custom {
                0% {
                    transform: scale(0.7);
                }
                45% {
                    transform: scale(1.05);
                }
                80% {
                    transform: scale(0.95);
                }
                100% {
                    transform: scale(1);
                }
            }
            @keyframes swal2-hide-custom {
                0% {
                    transform: scale(1);
                    opacity: 1;
                }
                100% {
                    transform: scale(0.5);
                    opacity: 0;
                }
            }
            .swal2-show-custom {
                animation: swal2-show 0.3s;
            }
            .swal2-hide-custom {
                animation: swal2-hide 0.15s forwards;
            }
            .swal2-container-custom.swal2-top-custom, 
            .swal2-container-custom.swal2-center-custom, 
            .swal2-container-custom.swal2-bottom-custom {
                grid-template-columns: auto minmax(0, 1fr) auto;
            }
            .swal2-container-custom.swal2-backdrop-show-custom,
            .swal2-container-custom.swal2-noanimation-custom {
                background: rgba(0, 0, 0, 0.4);
            }
            [class^=swal2] {
                -webkit-tap-highlight-color: transparent;
            }
            .swal2-container-custom {
                display: grid;
                position: fixed;
                z-index: 1060;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                box-sizing: border-box;
                grid-template-areas:
                    "top-start top top-end"
                    "center-start center center-end"
                    "bottom-start bottom-center bottom-end";
                grid-template-rows: minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);
                height: 100%;
                padding: 0.625em;
                overflow-x: hidden;
                transition: background-color 0.1s;
                -webkit-overflow-scrolling: touch;
            }
            .swal2-container-custom.swal2-center-custom > .swal2-popup-custom {
                grid-column: 2;
                grid-row: 2;
                align-self: center;
                justify-self: center;
            }
            .swal2-show-custom {
                animation-duration: 0.3s;
                animation-timing-function: ease;
                animation-delay: 0s;
                animation-iteration-count: 1;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: swal2-show;
            }
            .swal2-show-custom {
                animation: swal2-show 0.3s;
            }
            .swal2-popup-custom {
                display: none;
                position: relative;
                box-sizing: border-box;
                grid-template-columns: minmax(0, 100%);
                width: 32em;
                max-width: 100%;
                padding: 0 0 1.25em;
                border: none;
                border-radius: 5px;
                background: #fff;
                color: #545454;
                font-family: inherit;
                font-size: 1rem;
            }
            .swal2-html-container-custom {
                z-index: 1;
                justify-content: center;
                margin: 1em 1.6em 0.3em;
                padding: 0;
                overflow: auto;
                color: inherit;
                font-size: 1.125em;
                font-weight: normal;
                line-height: normal;
                text-align: center;
                word-wrap: break-word;
                word-break: break-word;
            }
            .swal2-actions-custom {
                display: flex;
                z-index: 0;
                box-sizing: border-box;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
                width: auto;
                margin: 1.25em auto 0;
                padding: 0;
            }
            .swal2-actions-custom {
                justify-content: space-evenly !important;
                width: 100% !important;
                gap: 1em !important;
                padding-inline: 1em !important;
            }
            .swal2-styled-custom.swal2-deny-custom {
                border: 0;
                border-radius: 0.25em;
                background: initial;
                background-color: #dc3741;
                color: #fff;
                font-size: 1em;
            }
            .swal2-styled-custom.swal2-confirm-custom {
                border: 0;
                border-radius: 0.25em;
                background: initial;
                background-color: #7066e0;
                color: #fff;
                font-size: 1em;
            }
            .swal2-styled-custom:not([disabled]) {
                cursor: pointer;
            }
            .swal2-actions-custom button {
                min-width: -mozfit-content !important;
                min-width: -webkit-fill-available !important;
                min-width: fit-content !important;
                flex: 1 !important;
            }
            .swal2-styled-custom {
                margin: 0.3125em;
                padding: 0.625em 1.1em;
                transition: box-shadow 0.1s;
                box-shadow: 0 0 0 3px transparent;
                font-weight: 500;
            }
            .swal2-timer-progress-bar-container-custom {
                position: absolute;
                right: 0;
                bottom: 0;
                left: 0;
                grid-column: auto !important;
                overflow: hidden;
                border-bottom-right-radius: 5px;
                border-bottom-left-radius: 5px;
            }
            button.selected{
                background-color: white !important;
                color: black !important;
            }
            /* Dark Mode */
            html.darkMode,
            body.darkMode,
            .Home.darkMode,
            .searchData.darkMode,
            #dataStatusHolder.darkMode{
                background-color: rgb(11,22,34) !important;
                color: rgb(185, 202, 221) !important
            }
            header .overlay.darkMode{
                width: 100%;
                height: 100%;
                padding: 1.75em;
                color: #FFF;
                background-image: linear-gradient( 135deg, #39343c69 10%, #151F2E6b 100%) !important;
            }
            .overlay.darkMode{
                color: rgb(214 233 255) !important;
            }
            #searchBtn.darkMode,
            #hiddenUnhiddenBtn.darkMode,
            .hide-anime-column button.darkMode,
            #menu-container button.darkMode,
            .swal2-confirm.darkMode, 
            .swal2-confirm-custom.darkMode{
                background-color: rgb(40 69 102) !important;
                color: rgb(185, 202, 221) !important;
            }
            #menu-container button.selected.darkMode{
                background-color: black !important;
                color: rgb(185, 202, 221) !important;
            }
            #username.darkMode,
            .table-responsive.darkMode,
            #anime-table.darkMode,
            #animeRecommendationList.darkMode,
            #animeRecommendationList tr.darkMode,
            #animeRecommendationList td.darkMode,
            .flexdatalist-multiple.darkMode,
            .flexdatalist-alias.darkMode,
            .flexdatalist-results.darkMode{
                background-color: rgb(21,31,46) !important;
                color: rgb(185, 202, 221) !important
            }
            .flexdatalist-results.darkMode,
            .flexdatalist-results.darkMode>li.item{
                border: 1px solid rgb(21,34,50) !important;
            }
            #anime-table.darkMode,
            #anime-table thead.darkMode,
            #anime-table tbody.darkMode,
            #anime-table th.darkMode,
            #anime-table tr.darkMode,
            #anime-table td.darkMode,
            .table-responsive.darkMode,
            .userInput.darkMode, 
            .flexdatalist-multiple.darkMode{
                border: 1px solid rgb(21,34,50) !important;
            }
            #anime-table th:not(:first-child).darkMode,
            .flexdatalist-multiple li.value.darkMode{
                background-color: rgb(67,81,97) !important;
                color: rgb(185, 202, 221) !important;
            }
            #animeRecommendationList a.darkMode,
            .swal2-footer a.darkMode{
                color: rgb(110, 185, 255) !important;
            }
            .nav.darkMode, 
            #pager.darkMode,
            .pagenum.darkMode>*,
            .swal2-popup.darkMode,
            .swal2-popup-custom.darkMode{
                background-color: rgb(21,34,50) !important;
                color: rgb(185, 202, 221) !important;
            }
            .swal2-modal.darkMode{
                background-color: rgb(11,22,34) !important;
            }
            .swal2-validation-message.darkMode{
                background-color: transparent !important;
                color: rgb(185, 202, 221) !important;
            }
            .spinner.darkMode{
                border: 2px solid #f3f3f3;
                border-top: 2px solid rgb(110, 185, 255);
                border-radius: 50%;
                width: 13px;
                min-width: 13px;
                height: 13px;
                min-height: 13px;
                animation: spin 2s linear infinite;
            }
            #menu-container>div>button.darkMode{
                -moz-box-shadow: 0 3px 20px 0 #6e89af38 !important;
                -webkit-box-shadow: 0 3px 20px 0 #6e89af38 !important;
                box-shadow: 0 3px 20px 0 #6e89af38 !important;
            }
            .darkMode ::placeholder{
                opacity: 1 !important;
                color: rgb(131,144,160) !important;
            }
            .darkMode :-ms-input-placeholder,
            .darkMode ::-ms-input-placeholder{ 
                color: rgb(131,144,160) !important;
            }
            /* Dark Mode */
            .orange{
                color: rgb(255,152,0);
            }
            .red{
                color: rgb(239,48,81);
            }
            td.animeTitle>i{
                padding: 0.5ch;
            }
            .searchData #filters{
                height: 100px !important;
                max-height: 100px !important;
                min-height: 100px !important;
            }
            #warnAnimeContainer,
            #filterAlgoContainer{
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            #dataStatusHolder{
                height: 20px;
                min-height: 20px;
                max-height: 20px;
            }
            #dataStatusContainer{
                justify-content: center;
                align-items: center;
            }
            #dataStatusWrapper{
                display: flex;
                flex-wrap: nowrap;
                align-items: center;
                overflow-x: auto;
            }
            .dataStatusSpinner{
                flex: 1;
                display: flex;
                justify-content: end;
            }
            #dataStatus{
                display: flex;
                flex-wrap: nowrap;
                justify-content: center;
                margin: 0 !important;
                overflow-x: auto;
                cursor: pointer;
            }
            #dataStatus{
                text-align: center;
            }
            #dataStatus>span{
                padding-block: 0.5ch;
                white-space: nowrap;
                display: flex;
                align-items: center;
                gap: 0.75ch;
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .flexdatalist-alias{
                height: 41px !important;
            }
            /* Top of Loader */
            .topOfLoader{
                z-index: 10000 !important;
            }
        </style>
</head>
<body class="darkMode">
<nav class="nav darkMode">
    <div><h1 id="menuTitle" class="textLogo">Kanshi.</h1></div>
    <div><img id="menuIcon" src="./public/logo.png" alt="menubar"></div>
</nav>
<div id="menu-container">
    <div>
        <button class="darkMode" id="updateBtn">Update</button>
        <button class="darkMode" id="showAllAnime">Show All</button>
        <input class="darkMode" type="file" id="importFile" style="display: none;" accept=".json"/>
        <button class="darkMode" id="deepUpdateBtn">Deep Update</button>
        <button class="darkMode" id="importBtn">Import</button>
        <button class="darkMode" id="exportBtn">Export</button>
        <!-- Android -->
        <button class="darkMode" id="chooseExportPathBtn">Change Export Folder</button>
        <!-- Android -->
        <button class="darkMode" id="warnAnimeBtn">Choose Content to Warn</button>
        <button class="darkMode" id="filterAlgoBtn">Filter Algorithm Contents</button>
        <button class="darkMode" id="themeBtn">Dark Mode</button>
        <button class="darkMode" id="hideKidsAnimeBtn">Hide Kids Anime</button>
        <button class="darkMode" id="hideUnwatchedSequelsBtn">Hide Unwatched Sequels</button>
        <button class="darkMode" id="updateIntervalBtn">Update Every Hour</button>
        <button class="darkMode" id="exportIntervalBtn">Export Every Hour</button>
        <button class="darkMode" id="sign-up">Create Another Account</button>
        <!-- Android -->
        <button class="darkMode" id="restart">Restart</button>
        <!-- Android -->
    </div>
</div>
<header>
    <div class="overlay darkMode">
        <h1 class="textLogo">Kanshi.</h1>
        <h3>Anime - Anilist</h3>
        <h3>Recommendations</h3>
    </div>
</header>
<div class="Home darkMode">
    <div class="searchData darkMode">
        <div class="userInputContainer">
            <input class="userInput darkMode" placeholder="Anilist Username" name="username" id="username" type="text">
        </div>
        <div id="filters" class="filter-container">
            <input type="text"
                   placeholder="Filter Table/List Contents (Include: Content / Exclude: !Content / WScore>=N / etc.)"
                   class="flexdatalist"
                   data-search-in="info"
                   multiple="multiple"
                   data-min-length="1"
                   data-search-by-word="true"
                   data-max-shown-results="7"
                   name="filter">
        </div>
        <div class="btn-container">
            <button id="searchBtn" class="btn darkMode" type="submit">Search</button>
        </div>
    </div>
    <div id="dataStatusHolder">
        <div id="dataStatusContainer" class="data-status-container">
            <div id="dataStatusWrapper">
                <div id="dataStatusSpinnerHome" style="display: inline-table;"><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner darkMode"></div></div>
                <h6 id="dataStatus"><b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A</h6>
            </div>
        </div>
    </div>
    <div class="table-responsive darkMode">
        <table id="anime-table" class="tablesorter table table-bordered table-striped darkMode">
            <thead class="darkMode">
            <tr class="anime-table-headers darkMode">
                <th id="hiddenUnhiddenBtn" class="trigger-btn sorter-false show-hidden-anime-btn darkMode">Unhidden</th>
                <th class="darkMode">WScore</th>
                <th class="darkMode">Title</th>
                <th class="darkMode">Format</th>
                <th class="darkMode">Top Similarities</th>
                <th class="darkMode">Score</th>
                <th class="darkMode">User Score</th>
                <th class="darkMode">Average Score</th>
                <th class="darkMode">Popularity</th>
                <th class="darkMode">User Status</th>
                <th class="darkMode">Status</th>
            </tr>
            </thead>
            <tbody id="animeRecommendationList" class="darkMode">
            <tr class="item darkMode" role="row">
                <td class="darkMode" style="padding: 1.5em !important;" colspan="11">
                    <i class="fa fa-solid fa-file fa-xl darkMode" style="padding-right: 1ch;"></i>
                    No Data
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- pager -->
<div id="pager" class="pager darkMode">
    <form class="pager-form">
        <div id="first" class="first"><h5>First</h5></div>
        <div id="prev" class="prev"><h5>Prev</h5></div>
        <div id="selectPageNumber">
            <select id="pageNumberOptions" class="custom-select pagenum darkMode" title="Select page number"></select>
        </div>
        <div id="next" class="next"><h5>Next</h5></div>
        <div id="last" class="last"><h5>Last</h5></div>
    </form>
</div>

<div id="warnAnimeContainer" class="swal2-container-custom swal2-center-custom swal2-backdrop-show-custom" style="display: none; overflow-y: auto;">
    <div id="warnAnimeModal" class="swal2-popup-custom swal2-modal-custom swal2-hide-custom darkMode" style="display: grid;">
        <div class="swal2-html-container-custom" style="display: block;">
            Add Custom Contents to be Warned
        </div>
        <div class="swal2-html-container-custom" style="display: block;">
            <div class="filter-container-custom">
                <input type="text"
                       placeholder="Yellow-Warning (Content) or Red-Warning (!Content)"
                       class="flexdatalistWarnAnime"
                       data-search-in="info"
                       multiple="multiple"
                       data-min-length="1"
                       data-search-by-word="true"
                       data-max-shown-results="7"
                       name="filter">
            </div>
        </div>
        <div class="swal2-actions-custom" style="display: flex;">
            <button id="cancelWarnAnime" type="button" class="darkMode swal2-deny-custom swal2-styled-custom swal2-default-outline-custom" style="display: inline-block; background-color: rgb(226, 125, 129);">Later</button>
            <button id="submitWarnAnime" type="button" class="darkMode swal2-confirm-custom swal2-styled-custom swal2-default-outline-custom" style="display: inline-block; background-color: rgb(0, 0, 0);">Submit</button>
        </div>
        <div class="swal2-timer-progress-bar-container-custom"></div>
    </div>
</div>

<div id="filterAlgoContainer" class="swal2-container-custom swal2-center-custom swal2-backdrop-show-custom" style="overflow-y: auto;">
    <div id="filterAlgoModal" class="darkMode swal2-popup-custom swal2-modal-custom" style="display: grid;">
        <div class="swal2-html-container-custom" style="display: block;">
            Filter Algorithm Contents
        </div>
        <div class="swal2-html-container-custom" style="display: block;">
            <div class="filter-container-custom">
                <input type="text"
                       placeholder="Filter Algorithm Contents (Include: Content / Exclude: !Content / WScore>=N / etc.)"
                       class="flexdatalistFilterAlgo"
                       data-search-in="info"
                       multiple="multiple"
                       data-min-length="1"
                       data-search-by-word="true"
                       data-max-shown-results="7"
                       name="filter">
            </div>
        </div>
        <div class="darkMode swal2-validation-message" id="filterAlgo-validation" style="display: none;">
            <div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner darkMode"></div></div>
                <div>Checking Username...</div>
            </div>
        </div>
        <div class="swal2-actions-custom" style="display: flex;">
            <button id="cancelFilterAlgo" type="button" class="darkMode swal2-deny-custom swal2-styled-custom swal2-default-outline-custom" style="display: inline-block; background-color: rgb(226, 125, 129);">Later</button>
            <button id="submitFilterAlgo" type="button" class="darkMode swal2-confirm-custom swal2-styled-custom swal2-default-outline-custom" style="display: inline-block; background-color: rgb(0, 0, 0);">Submit</button>
        </div>
        <div class="swal2-timer-progress-bar-container-custom"></div>
    </div>
</div>

<div id="loader" class="loader">
    <div><h1 id="loaderText">Loading...</h1></div>
</div>

<script defer>
    // Declare Global Variables
        // Production Version
    const version = "5.6",
          backUpVersion = 3.4
        // IndexDB
    var request, db,
        // Saved Data
    savedUsername, savedRecScheme, savedUserList, savedAnimeEntries, savedHiddenAnimeIDs, savedAnimeFranchises,
    savedFilters, savedWarnAnime, savedFilterAlgo, savedBackUpVersion,
    savedHiddenTablePage, savedUnhiddenTablePage, savedTableStatus, savedYscroll, savedSort,
    savedTheme, kidsAnimeIsHidden, hideUnwatchedSequels,
    savedFilterOptionsJson, allFilterInfo,
    exportIntervalIsActive, updateIntervalIsActive, exportIntervalStartDate, updateIntervalStartDate,
    exportIntervalTimeout = [], updateIntervalTimeout = [],
        // Android
    exportPathIsAvailable,
        // Android
        // Load Saved API Request State
    updateIDs = [], requestIntervalMS = 0,
    savedAnalyzeVariableTime, savedUpdateAnalyzeAnimeTime, savedDeepUpdateTime, lastSavedUpdateTime, lastAnilistPage,
    deepUpdateStartTime, updateStartTime,
    isRunning = false, requestIsRunning = false, isLoading = false,
    isDeepUpdate = false, willAutoUpdate = false, updateStateText = [], checkFiltersFocus = [],
        // Helper
    pageInits = true, enteredOnce = false, versionUpdate = false, exportWorker, initStartTime,
    pageLoadStartDate = new Date().getTime(), maxClientHeight,
        // Jquery Elements
    bodyEl, usernameEl, pagerEl, menuContainerEl, pageNumberOptionsEl,
    animeTableEl, animeRecommendationListEl, filtersEl,
    warnAnimeContainerEl, warnAnimeModalEl,
    filterAlgoContainerEl, filterAlgoModalEl, filterAlgoValidationEl,
    dataStatusEl, dataStatusSpinnerHomeEl,
    searchBtnEl, updateBtnEl, importBtnEl, importFileEl, exportIntervalBtnEl, updateIntervalBtnEl,
    hiddenUnhiddenBtnEl, showAllAnimeBtnEl, hideUnwatchedSequelsBtnEl, themeBtnEl

    window.onload = async () => {
        // Check Client Height
        maxClientHeight = document.body.clientHeight
        // Initialize Jquery Elements
        bodyEl = await $("body"),
        usernameEl = await $("#username"),
        pagerEl = await $("#pager"),
        menuContainerEl = await $("#menu-container"),
        pageNumberOptionsEl = await $("#pageNumberOptions"),
        animeTableEl = await $("#anime-table"),
        animeRecommendationListEl = await $("#animeRecommendationList"),
        filtersEl = await $("#filters"),
        warnAnimeContainerEl = await $("#warnAnimeContainer"),
        warnAnimeModalEl = await $("#warnAnimeModal"),
        filterAlgoContainerEl = await $("#filterAlgoContainer"),
        filterAlgoModalEl = await $("#filterAlgoModal")
        filterAlgoValidationEl = await $("#filterAlgo-validation"),
        dataStatusEl = await $("#dataStatus"),
        dataStatusSpinnerHomeEl = await $("#dataStatusSpinnerHome"),
        searchBtnEl = await $("#searchBtn"),
        updateBtnEl = await $("#updateBtn"),
        importBtnEl = await $("#importBtn"),
        importFileEl = await $("#importFile"),
        exportIntervalBtnEl = await $("#exportIntervalBtn"),
        updateIntervalBtnEl = await $("#updateIntervalBtn"),
        hiddenUnhiddenBtnEl = await $("#hiddenUnhiddenBtn"),
        showAllAnimeBtnEl = await $("#showAllAnime"),
        hideUnwatchedSequelsBtnEl = await $("#hideUnwatchedSequelsBtn"),
        hideKidsAnimeBtnEl = await $("#hideKidsAnimeBtn"),
        themeBtnEl = await $("#themeBtn")

        // Init Page
        return await new Promise((resolve)=>{
            // Create/Load IndexedDB
            request = window.indexedDB.open("MyIndexDB", 1)
            request.onerror = (event) => {
                Swal.fire({
                    heightAuto: false,
                    title: "Oops, heh",
                    text: "Your browser is not supported, to continue please update or install a recent version.",
                    imageUrl: './public/anya-smile.gif',
                    imageAlt: 'Custom image',
                    confirmButtonColor: "#000",
                    background: "#0b1622",
                    color: "#b9cadd",
                    confirmButtonColor: "#284566",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    customClass: {
                        container: 'topOfLoader',
                    }
                }).then(()=>{
                    window.location.href = window.location.href
                })
                console.error("MyIndexDB is Not Allowed!")
            }
            request.onsuccess = (event) => {
                db = event.target.result
                resolve()
            }
            request.onupgradeneeded = (event) => {
                db = event.target.result;
                db.createObjectStore("MyObjectStore")
                resolve()
            }
        }).then(async()=>{
            // Init Global Saved Data from IndexedDB
            return await new Promise(async(resolve)=>{
                savedAnimeEntries = await retrieveJSON("savedAnimeEntries") || []
                savedUserList = await retrieveJSON("savedUserList") || {}
                lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
                lastAnilistPage = await retrieveJSON("lastAnilistPage") || 284
                savedTheme = await retrieveJSON("savedTheme") || "darkMode"
                savedUnhiddenTablePage = await retrieveJSON("savedUnhiddenTablePage") || 0
                savedHiddenTablePage = await retrieveJSON("savedHiddenTablePage") || 0
                savedTableStatus = await retrieveJSON("savedTableStatus") || "Unhidden"
                savedUsername = await retrieveJSON("savedUsername") || ""
                savedFilterOptionsJson = await retrieveJSON("savedFilterOptionsJson") || []
                allFilterInfo = await retrieveJSON("allFilterInfo") || {}
                savedFilters = await retrieveJSON("savedFilters") || []
                savedAnimeFranchises = await retrieveJSON("savedAnimeFranchises") || []
                savedBackUpVersion = await retrieveJSON(`backUpVersion`) || 0
                kidsAnimeIsHidden = await retrieveJSON("kidsAnimeIsHidden") ?? true
                hideUnwatchedSequels = await retrieveJSON("hideUnwatchedSequels") ?? true
                initStartTime = await retrieveJSON("initStartTime")
                savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs") || {}
                savedSort = await retrieveJSON("savedSort") || [1,1]
                savedYscroll = await retrieveJSON("savedYscroll") || 0.0
                savedFilterAlgo = await retrieveJSON("savedFilterAlgo") || []
                savedWarnAnime = await retrieveJSON("savedWarnAnime") || [ "!genre: !ecchi","!tag: !boys' love","tag: cgi","!tag: !ero guro","!tag: !female harem",
                                                                            "tag: full cgi","!tag: !male harem","!tag: !mixed gender harem",
                                                                            "!tag: !nudity","!tag: !slavery","!tag: !suicide","!tag: !yuri","!tag: !netorare", "!tag: !rape"
                                                                         ]
                updateIntervalIsActive = await retrieveJSON("updateIntervalIsActive") ?? false
                updateIntervalStartDate = await retrieveJSON("updateIntervalStartDate") || new Date()
                exportIntervalIsActive = await retrieveJSON("exportIntervalIsActive") ?? false
                exportIntervalStartDate = await retrieveJSON("exportIntervalStartDate") || new Date()
                // Android
                exportPathIsAvailable = await retrieveJSON("exportPathIsAvailable") ?? false
                // Android
                savedAnalyzeVariableTime = await retrieveJSON("savedAnalyzeVariableTime") || [90]
                savedUpdateAnalyzeAnimeTime = await retrieveJSON("savedUpdateAnalyzeAnimeTime") || [3]
                savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime") || [320]
                versionUpdate = await retrieveJSON("versionUpdate") ?? false
                resolve()
            })
        }).then(async()=>{
            // Load Event Listeners
            return await new Promise((resolve)=>{
                usernameEl.on('keypress',async (e) =>{
                    if(e.which===13&&!isLoading) {
                        searchBtnEl.click()
                    }
                })
                filtersEl.on('keypress',async (e) =>{
                    if( e.which===13
                        &&!pageInits
                        &&!isLoading
                        &&e.target.id==="flex0"
                        &&!e.target.value
                        &&usernameEl.val()
                    ){
                        searchBtnEl.click()
                    }
                })
                searchBtnEl.on('click', async ()=>{
                    deepUpdateTime = arrayMean(savedDeepUpdateTime)
                    if(Object.keys(savedRecScheme).length>0) {
                        var newUsername = await usernameEl.val()
                        if(!newUsername){
                            await usernameEl[0]?.setCustomValidity("Anilist Username is Required!")
                            await usernameEl[0]?.reportValidity()
                        } else {
                            if(equalsNCS(newUsername,savedUsername)){
                                await animeRecommendationListEl.empty()
                                await animeRecommendationListEl.append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                            <div style="display:flex; align-items:center;">
                                                <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                                <div>Loading...</div>
                                            </div>
                                        </td>
                                    </tr>
                                `)
                                LoadData(savedRecScheme)
                            } else {
                                Swal.fire({
                                    heightAuto: false,
                                    text: `Username was changed from ${savedUsername} to ${newUsername}. This will remove your current recommendation list, do you still want to continue?`,
                                    showConfirmButton: true,
                                    confirmButtonText: "Yes",
                                    showDenyButton: true,
                                    denyButtonText: "No",
                                    confirmButtonColor: '#000',
                                    denyButtonColor: '#e27d81',
                                    icon: "question",
                                    reverseButtons: true
                                }).then(async(value)=>{
                                    if(value.isConfirmed){
                                        if(requestIsRunning){
                                            Swal.fire({
                                                heightAuto: false,
                                                text: `List is already updating! Do you want to restart the update?`,
                                                showConfirmButton: true,
                                                confirmButtonText: "Yes",
                                                showDenyButton: true,
                                                denyButtonText: "No",
                                                confirmButtonColor: '#000',
                                                denyButtonColor: '#e27d81',
                                                icon: "question",
                                                reverseButtons: true
                                            }).then(async(value)=>{
                                                if(value.isConfirmed){
                                                    // Reset User List
                                                    savedUserList = await {}
                                                    await saveJSON(savedUserList,"savedUserList")
                                                    Update(false)
                                                }
                                            })
                                        } else {
                                            // Reset User List
                                            savedUserList = await {}
                                            await saveJSON(savedUserList,"savedUserList")
                                            Update(false)
                                        }
                                    } else {
                                        usernameEl.focus()
                                    }
                                })
                            }
                        }
                    } else {
                        if(requestIsRunning){
                            Swal.fire({
                                heightAuto: false,
                                text: `List is already updating! Do you want to restart the update?`,
                                showConfirmButton: true,
                                confirmButtonText: "Yes",
                                showDenyButton: true,
                                denyButtonText: "No",
                                confirmButtonColor: '#000',
                                denyButtonColor: '#e27d81',
                                icon: "question",
                                reverseButtons: true
                            }).then(async(value)=>{
                                if(value.isConfirmed){
                                    deepUpdateStartTime = new Date()
                                    isDeepUpdate = true
                                    Update(false)
                                }
                            })
                        } else {
                            Swal.fire({
                                heightAuto: false,
                                text: `Do you want to continue and update your recommendations list?
                                The estimated time to finish is ${msToTime(deepUpdateTime*1000)}`,
                                showConfirmButton: true,
                                confirmButtonText: "Yes",
                                showDenyButton: true,
                                denyButtonText: "No",
                                confirmButtonColor: '#000',
                                denyButtonColor: '#e27d81',
                                icon: "question",
                                reverseButtons: true
                            })
                            .then((value) => {
                                if(value.isConfirmed){
                                    deepUpdateStartTime = new Date()
                                    isDeepUpdate = true
                                    Update(false)
                                }
                            })
                        }
                    }
                })
                $("nav.nav, #menu-container").on("click",()=>{
                    if(menuContainerEl.css("display")==="none"){
                        menuContainerEl.fadeIn(250)
                    } else {
                        menuContainerEl.fadeOut(250)
                    }
                })
                $("#pager, #menu-container button").on('click', (e)=>{
                    e.stopPropagation()
                })
                dataStatusEl.on('click',async (e) =>{
                    var updateTime = arrayMean(savedAnalyzeVariableTime) + arrayMean(savedUpdateAnalyzeAnimeTime)
                    if(requestIsRunning){
                        Swal.fire({
                            heightAuto: false,
                            text: `List is already updating! Do you want to restart the update?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                var newUsername = await usernameEl.val()
                                if(!newUsername){
                                    menuContainerEl.fadeOut(250)
                                    usernameEl[0]?.setCustomValidity("Anilist Username is Required!")
                                    usernameEl[0]?.reportValidity()
                                } else {
                                    if(newUsername!==savedUsername){
                                        Swal.fire({
                                            heightAuto: false,
                                            text: `Username was changed from ${savedUsername} to ${newUsername}. This will remove your current recommendation list, do you still want to continue?`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Yes",
                                            showDenyButton: true,
                                            denyButtonText: "No",
                                            confirmButtonColor: '#000',
                                            denyButtonColor: '#e27d81',
                                            icon: "question",
                                            reverseButtons: true
                                        }).then(async(value)=>{
                                            menuContainerEl.fadeOut(250)
                                            if(value.isConfirmed){
                                                // Reset User List
                                                savedUserList = await {}
                                                await saveJSON(savedUserList,"savedUserList")
                                                Update(false)
                                            } else {
                                                usernameEl.focus()
                                            }
                                        })
                                    } else {
                                        Update(false)
                                        menuContainerEl.fadeOut(250)
                                    }
                                }
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to continue and update your recommendations list?
                            This may take ${msToTime(updateTime*1000)} to finish.`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                var newUsername = await usernameEl.val()
                                if(!newUsername){
                                    menuContainerEl.fadeOut(250)
                                    usernameEl[0]?.setCustomValidity("Anilist Username is Required!")
                                    usernameEl[0]?.reportValidity()
                                } else {
                                    if(newUsername!==savedUsername){
                                        Swal.fire({
                                            heightAuto: false,
                                            text: `Username was changed from ${savedUsername} to ${newUsername}. This will remove your current recommendation list, do you still want to continue?`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Yes",
                                            showDenyButton: true,
                                            denyButtonText: "No",
                                            confirmButtonColor: '#000',
                                            denyButtonColor: '#e27d81',
                                            icon: "question",
                                            reverseButtons: true
                                        }).then(async(value)=>{
                                            menuContainerEl.fadeOut(250)
                                            if(value.isConfirmed){
                                                // Reset User List
                                                savedUserList = await {}
                                                await saveJSON(savedUserList,"savedUserList")
                                                Update(false)
                                            } else {
                                                usernameEl.focus()
                                            }
                                        })
                                    } else {
                                        Update(false)
                                        menuContainerEl.fadeOut(250)
                                    }
                                }
                            }
                        })
                    }
                })
                updateBtnEl.on('click', async ()=>{
                    var updateTime = arrayMean(savedAnalyzeVariableTime) + arrayMean(savedUpdateAnalyzeAnimeTime)
                    if(requestIsRunning){
                        Swal.fire({
                            heightAuto: false,
                            text: `List is already updating! Do you want to restart the update?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                var newUsername = await usernameEl.val()
                                if(!newUsername){
                                    menuContainerEl.fadeOut(250)
                                    usernameEl[0]?.setCustomValidity("Anilist Username is Required!")
                                    usernameEl[0]?.reportValidity()
                                } else {
                                    if(newUsername!==savedUsername){
                                        Swal.fire({
                                            heightAuto: false,
                                            text: `Username was changed from ${savedUsername} to ${newUsername}. This will remove your current recommendation list, do you still want to continue?`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Yes",
                                            showDenyButton: true,
                                            denyButtonText: "No",
                                            confirmButtonColor: '#000',
                                            denyButtonColor: '#e27d81',
                                            icon: "question",
                                            reverseButtons: true
                                        }).then(async(value)=>{
                                            menuContainerEl.fadeOut(250)
                                            if(value.isConfirmed){
                                                // Reset User List
                                                savedUserList = await {}
                                                await saveJSON(savedUserList,"savedUserList")
                                                Update(false)
                                            } else {
                                                usernameEl.focus()
                                            }
                                        })
                                    } else {
                                        Update(false)
                                        menuContainerEl.fadeOut(250)
                                    }
                                }
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to continue and update your recommendations list?
                            This may take ${msToTime(updateTime*1000)} to finish.`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                var newUsername = await usernameEl.val()
                                if(!newUsername){
                                    menuContainerEl.fadeOut(250)
                                    usernameEl[0]?.setCustomValidity("Anilist Username is Required!")
                                    usernameEl[0]?.reportValidity()
                                } else {
                                    if(newUsername!==savedUsername){
                                        Swal.fire({
                                            heightAuto: false,
                                            text: `Username was changed from ${savedUsername} to ${newUsername}. This will remove your current recommendation list, do you still want to continue?`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Yes",
                                            showDenyButton: true,
                                            denyButtonText: "No",
                                            confirmButtonColor: '#000',
                                            denyButtonColor: '#e27d81',
                                            icon: "question",
                                            reverseButtons: true
                                        }).then(async(value)=>{
                                            menuContainerEl.fadeOut(250)
                                            if(value.isConfirmed){
                                                // Reset User List
                                                savedUserList = await {}
                                                await saveJSON(savedUserList,"savedUserList")
                                                Update(false)
                                            } else {
                                                usernameEl.focus()
                                            }
                                        })
                                    } else {
                                        Update(false)
                                        menuContainerEl.fadeOut(250)
                                    }
                                }
                            }
                        })
                    }
                })
                $("#deepUpdateBtn").on("click", async ()=>{
                    deepUpdateTime = arrayMean(savedDeepUpdateTime)
                    if(requestIsRunning){
                        Swal.fire({
                            heightAuto: false,
                            text: `List is already updating! Do you want to restart the update?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                deepUpdateStartTime = new Date()
                                isDeepUpdate = true
                                Update(false)
                                menuContainerEl.fadeOut(250)
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to continue and update all data in your recommendations list?
                            This may take ${msToTime(deepUpdateTime*1000)} to finish.`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                deepUpdateStartTime = new Date()
                                isDeepUpdate = true
                                Update(false)
                                menuContainerEl.fadeOut(250)
                            }
                        })
                    }
                })
                hiddenUnhiddenBtnEl.on('click', async()=>{
                    if(!isRunning){
                        isRunning = true
                        if(savedUsername&&Object.keys(savedRecScheme).length>0){
                            var state = await hiddenUnhiddenBtnEl.text()
                            if(!equalsNCS(usernameEl.val(),savedUsername)){
                                await usernameEl.val(savedUsername)
                            }
                            if(state==="Unhidden"){
                                if($("#filters .flexdatalist-multiple-value > .flexdatalist-alias").length){
                                    var filterInput = await $("#filters .flexdatalist-multiple-value > .flexdatalist-alias")
                                    await filterInput.val("hidden")
                                    var e = await $.Event("keyup",{keyCode:13})
                                    await filterInput.trigger(e)
                                    await filterInput.val("")
                                }
                                await hiddenUnhiddenBtnEl.text("Hidden")
                                savedTableStatus = await "Hidden"
                                await saveJSON(savedTableStatus,"savedTableStatus")
                                await animeRecommendationListEl.empty()
                                await animeRecommendationListEl.append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                            <div style="display:flex; align-items:center;">
                                                <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                                <div>Loading...</div>
                                            </div>
                                        </td>
                                    </tr>
                                `)
                                await LoadData(savedRecScheme)
                                pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                                isRunning = false
                            } else {
                                if($("#filters .flexdatalist-multiple-value").length){
                                    var filters = await $("#filters .flexdatalist-multiple").children("li.value")
                                    for(let i=0; i<filters.length; i++) {
                                        var filterName = await filters.eq(i).children(".text")[0]?.innerText
                                        if(filterName.toLowerCase()==="hidden"){
                                            await filters.eq(i).children(".fdl-remove").trigger("click")
                                            await $("#filters .flexdatalist-alias").blur()
                                        }
                                    }
                                }
                                await hiddenUnhiddenBtnEl.text("Unhidden")
                                savedTableStatus = await "Unhidden"
                                await saveJSON(savedTableStatus,"savedTableStatus")
                                await animeRecommendationListEl.empty()
                                await animeRecommendationListEl.append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                            <div style="display:flex; align-items:center;">
                                                <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                                <div>Loading...</div>
                                            </div>
                                        </td>
                                    </tr>
                                `)
                                await LoadData(savedRecScheme)
                                pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                                isRunning = false
                            }
                        } else isRunning = false
                    }
                })

                showAllAnimeBtnEl.on('click', ()=>{
                    Swal.fire({
                        heightAuto: false,
                        text: "Do you want to show all your hidden anime? This will remove all hidden Anime in the hidden's list!",
                        showConfirmButton: true,
                        confirmButtonText: "Yes",
                        showDenyButton: true,
                        denyButtonText: "No",
                        confirmButtonColor: '#000',
                        denyButtonColor: '#e27d81',
                        icon: "question",
                        reverseButtons: true
                    })
                    .then(async(value) => {
                        if(value.isConfirmed){
                            if(!equalsNCS(usernameEl.val(),savedUsername)){
                                usernameEl.val(savedUsername)
                            }
                            savedHiddenAnimeIDs = await {}
                            await saveJSON(savedHiddenAnimeIDs, "savedHiddenAnimeIDs")
                            if(await $("#filters .flexdatalist-multiple-value").length){
                                var filters = await $("#filters .flexdatalist-multiple").children("li.value")
                                for(let i=0; i<filters.length; i++) {
                                    var filterName = await filters.eq(i).children(".text")[0]?.innerText
                                    if(filterName.toLowerCase()==="hidden"){
                                        await filters.eq(i).children(".fdl-remove").trigger("click")
                                        await $("#filters .flexdatalist-alias").blur()
                                    }
                                }
                            }
                            if(hiddenUnhiddenBtnEl.text()==="Hidden"){
                                await animeRecommendationListEl.empty()
                                await animeRecommendationListEl.append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                            <div style="display:flex; align-items:center;">
                                                <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                                <div>Loading...</div>
                                            </div>
                                        </td>
                                    </tr>
                                `)
                            }
                            await LoadData(savedRecScheme)
                            hiddenUnhiddenBtnEl.text("Unhidden")
                            await animeTableEl.trigger("pageSet",savedUnhiddenTablePage)
                            pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                            savedTableStatus = await "Unhidden"
                            await saveJSON(savedTableStatus,"savedTableStatus")
                            showAllAnimeBtnEl.hide()
                            menuContainerEl.fadeOut(250)
                            Swal.fire({
                                heightAuto: false,
                                text: "All hidden anime has now been successfully transferred to your List!",
                                icon: "success",
                                confirmButtonColor: "#000"
                            })
                        }
                    })
                })
                importBtnEl.on("click", async()=>{
                    if(savedUsername){
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to import your backup data?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                importFileEl.click()
                            }
                        })
                    } else {
                        importFileEl.click()
                        menuContainerEl.hide()
                    }
                })
                importFileEl.on("change",(event)=>{
                    if((importFileEl.val()??null)!==null&&importFileEl?.[0]?.files?.[0]){
                        const importedFile = importFileEl[0].files[0]
                        const reader = new FileReader()
                        reader.onload = async() => {
                            const fullPath = importFileEl.val()
                            var filename
                            if(typeof fullPath==="string"&&fullPath){
                                const startIndex = (fullPath.indexOf('\\') >= 0 ? fullPath.lastIndexOf('\\') : fullPath.lastIndexOf('/'));
                                filename = fullPath.substring(startIndex);
                                if (filename.indexOf('\\') === 0 || filename.indexOf('/') === 0) {
                                    filename = filename.substring(1);
                                }
                            }
                            if(savedUsername){
                                Swal.fire({
                                    heightAuto: false,
                                    text: `File ${filename?'named ['+filename+'] ':''}has been detected, do you want to continue the import? This will remove your current data!`,
                                    showConfirmButton: true,
                                    confirmButtonText: "Yes",
                                    showDenyButton: true,
                                    denyButtonText: "No",
                                    confirmButtonColor: '#000',
                                    denyButtonColor: '#e27d81',
                                    icon: "question",
                                    reverseButtons: true
                                })
                                .then(async(value) => {
                                    if(value.isConfirmed){
                                        var fileContent
                                        await new Promise(async(resolve,reject)=>{
                                            await importBtnEl.css({background: "black", color: "white"})
                                            try{
                                                fileContent = await JSON.parse(reader.result);
                                            } catch(ex) {
                                                importFileEl.val(null)
                                                Swal.fire({
                                                    heightAuto: false,
                                                    text: "Error: Invalid Backup File",
                                                    icon: "error",
                                                    confirmButtonColor: "#000"
                                                })
                                            }
                                            if(!fileContent.savedUsername){
                                                importFileEl.val(null)
                                                Swal.fire({
                                                    heightAuto: false,
                                                    text: "Error: Backup file does not Have a Username",
                                                    icon: "error",
                                                    confirmButtonColor: "#000"
                                                })
                                                reject()
                                            } else {
                                                await menuContainerEl.fadeOut(250)
                                                dataStatusSpinnerHomeEl.show()
                                                dataStatusEl
                                                    .empty()
                                                    .append(`<span style="white-space:nowrap;">Importing data, please wait...</span>`)
                                                resolve()
                                            }
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                await saveJSON(importedBackUpVersion, "backUpVersion")
                                            }
                                            return
                                        }).then(async()=>{
                                            savedUsername = await fileContent.savedUsername || ""
                                            await saveJSON(savedUsername,"savedUsername")
                                            await usernameEl.val(savedUsername)
                                            return
                                        }).then(async()=>{
                                            savedHiddenAnimeIDs = await fileContent.savedHiddenAnimeIDs || {}
                                            await saveJSON(savedHiddenAnimeIDs,"savedHiddenAnimeIDs")
                                            if(jsonIsEmpty(savedHiddenAnimeIDs)) {
                                                showAllAnimeBtnEl.hide()
                                            } else {
                                                showAllAnimeBtnEl.show()
                                            }
                                            return
                                        }).then(async()=>{
                                            savedRecScheme = await fileContent.savedRecScheme || {}
                                            await saveJSON(savedRecScheme,"savedRecScheme")
                                            return
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                savedAnimeEntries = await fileContent.savedAnimeEntries || []
                                                await saveJSON(savedAnimeEntries,"savedAnimeEntries")
                                            }
                                            return
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                lastSavedUpdateTime = await fileContent.lastSavedUpdateTime || 0
                                                await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                                            }
                                            return
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                savedAnimeFranchises = await fileContent.savedAnimeFranchises || []
                                                await saveJSON(savedAnimeFranchises,"savedAnimeFranchises") || []
                                            }
                                            return
                                        }).then(async()=>{
                                            savedUserList = await fileContent.savedUserList || {}
                                            await saveJSON(savedUserList,"savedUserList")
                                            return
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                savedAnalyzeVariableTime = await fileContent.savedAnalyzeVariableTime || [90]
                                                await saveJSON(savedAnalyzeVariableTime,"savedAnalyzeVariableTime")
                                            }
                                            return
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                savedUpdateAnalyzeAnimeTime = await fileContent.savedUpdateAnalyzeAnimeTime || [3]
                                                await saveJSON(savedUpdateAnalyzeAnimeTime,"savedUpdateAnalyzeAnimeTime")
                                            }
                                            return
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                savedDeepUpdateTime = await fileContent.savedDeepUpdateTime || [320]
                                                await saveJSON(savedDeepUpdateTime,"savedDeepUpdateTime")
                                            }
                                            return
                                        }).then(async()=>{
                                            lastAnilistPage = await fileContent.lastAnilistPage || 284
                                            await saveJSON(lastAnilistPage,"lastAnilistPage")
                                            return
                                        }).then(async()=>{
                                            savedWarnAnime = await fileContent.savedWarnAnime || [ "!genre: ecchi","tag: boys' love","tag: cgi","!tag: ero guro","!tag: female harem",
                                                                                                   "tag: full cgi","!tag: male harem","!tag: mixed gender harem",
                                                                                                   "!tag: nudity","!tag: slavery","!tag: suicide","!tag: yuri","!tag: netorare", "!tag: rape"
                                                                                                 ]
                                            await saveJSON(savedWarnAnime,"savedWarnAnime")
                                            return
                                        }).then(async()=>{
                                            savedFilterAlgo = await fileContent.savedFilterAlgo || []
                                            await saveJSON(savedFilterAlgo,"savedFilterAlgo")
                                            return
                                        }).then(async()=>{
                                            await usernameEl.val(savedUsername)
                                            return
                                        }).then(async()=>{
                                            await new Promise(async(resolve)=>{
                                                await warnAnimeContainerEl.css({visibility:"hidden"}).show()
                                                // Remove Current Filters
                                                var warnInfo = await $("#warnAnimeModal .flexdatalist-multiple").children("li.value")
                                                for(let i=0; i<warnInfo.length; i++) {
                                                    await warnInfo.eq(i).children(".fdl-remove").trigger("click")
                                                    await $("#warnAnimeModal .flexdatalist-alias").blur()
                                                }
                                                resolve()
                                            }).then(async()=>{
                                                // Reload Filters
                                                var warnAnimeInput
                                                for(let i=0; i<savedWarnAnime.length; i++) {
                                                    warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                                    await warnAnimeInput.val(savedWarnAnime[i])
                                                    var e = await $.Event("keyup",{keyCode:13})
                                                    await warnAnimeInput.trigger(e)
                                                    await warnAnimeInput.val("")
                                                }
                                                await warnAnimeContainerEl.css({visibility:"visible"}).hide()
                                                return
                                            })
                                        }).then(async()=>{
                                            return await new Promise(async(resolve)=>{
                                                await filterAlgoContainerEl.css({visibility:"hidden"}).show()
                                                // Remove Current Filters
                                                var filterInfo = await $("#filterAlgoModal .flexdatalist-multiple").children("li.value")
                                                for(let i=0; i<filterInfo.length; i++) {
                                                    await filterInfo.eq(i).children(".fdl-remove").trigger("click")
                                                    await $("#filterAlgoModal .flexdatalist-alias").blur()
                                                }
                                                resolve()
                                            }).then(async()=>{
                                                // Reload Filters
                                                var filterAlgoInput
                                                for(let i=0; i<savedFilterAlgo.length; i++) {
                                                    filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                                    await filterAlgoInput.val(savedFilterAlgo[i])
                                                    var e = await $.Event("keyup",{keyCode:13})
                                                    await filterAlgoInput.trigger(e)
                                                    await filterAlgoInput.val("")
                                                }
                                                await filterAlgoContainerEl.css({visibility:"visible"}).hide()
                                                return
                                            })
                                        }).then(async()=>{
                                            if(Object.keys(savedRecScheme).length) {
                                                await updateBtnEl.show()
                                                await updateIntervalBtnEl.show()
                                                await LoadData(savedRecScheme)
                                            } else {
                                                await updateBtnEl.hide()
                                                await updateIntervalBtnEl.hide()
                                                animeData = `
                                                    <tr class="item ${savedTheme}" role="row">
                                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                                            <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                                            No Data
                                                        </td>
                                                    </tr>
                                                `
                                                await animeRecommendationListEl.empty()
                                                await animeRecommendationListEl.append(animeData)
                                                await animeTableEl.trigger("update")
                                            }
                                            return
                                        }).then(async()=>{
                                            importFileEl.val(null)
                                            if(!requestIsRunning){
                                                dataStatusSpinnerHomeEl.hide()
                                                dataStatusEl
                                                    .empty()
                                                    .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                                            }
                                            await Swal.fire({
                                                heightAuto: false,
                                                text: "Data has been updated!",
                                                icon: "success",
                                                confirmButtonColor: "#000"
                                            })
                                            return
                                        }).then(async()=>{
                                            // If version is lower, Update
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion<backUpVersion){
                                                versionUpdate = await true
                                                await saveJSON(versionUpdate,"versionUpdate")
                                                if(usernameEl.val()){
                                                    Update(true)
                                                }
                                            }
                                            return
                                        })
                                        .catch(()=>{
                                            return
                                        })
                                    } else {
                                        importFileEl.val(null)
                                        await importBtnEl.css({background: "black", color: "white"})
                                    }
                                })
                            } else {
                                var fileContent
                                await new Promise(async(resolve,reject)=>{
                                    await importBtnEl.css({background: "black", color: "white"})
                                    try{
                                        fileContent = await JSON.parse(reader.result)
                                    } catch(ex) {
                                        importFileEl.val(null)
                                        $(".swal2-validation-message")
                                            .addClass("no-before").removeClass("no-before")
                                            .addClass("error-before")
                                            .html(
                                                `Error: Invalid Backup File`
                                            )
                                            .css({display:"flex"})
                                        return
                                    }
                                    if(!fileContent.savedUsername){
                                        importFileEl.val(null)
                                        $(".swal2-validation-message")
                                            .addClass("no-before").removeClass("no-before")
                                            .addClass("error-before")
                                            .html(
                                                `Error: Backup file does not Have a Username`
                                            )
                                            .css({display:"flex"})
                                        reject()
                                    } else {
                                        $(".swal2-validation-message")
                                            .addClass("no-before")
                                            .css({display:"flex"})
                                            .html(
                                                `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                                    <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                                    <div>Importing Data...</div>
                                                </div>`
                                            )
                                        resolve()
                                    }
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion>=backUpVersion){
                                        await saveJSON(importedBackUpVersion, "backUpVersion")
                                    }
                                    return
                                }).then(async()=>{
                                    savedUsername = await fileContent.savedUsername || ""
                                    await saveJSON(savedUsername,"savedUsername")
                                    await usernameEl.val(savedUsername)
                                    return
                                }).then(async()=>{
                                    savedHiddenAnimeIDs = await fileContent.savedHiddenAnimeIDs || {}
                                    await saveJSON(savedHiddenAnimeIDs,"savedHiddenAnimeIDs")
                                    if(jsonIsEmpty(savedHiddenAnimeIDs)) {
                                        showAllAnimeBtnEl.hide()
                                    } else {
                                        showAllAnimeBtnEl.show()
                                    }
                                    return
                                }).then(async()=>{
                                    savedRecScheme = await fileContent.savedRecScheme || {}
                                    await saveJSON(savedRecScheme,"savedRecScheme")
                                    return
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion>=backUpVersion){
                                        savedAnimeEntries = await fileContent.savedAnimeEntries || []
                                        await saveJSON(savedAnimeEntries,"savedAnimeEntries")
                                    }
                                    return
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion>=backUpVersion){
                                        lastSavedUpdateTime = await fileContent.lastSavedUpdateTime || 0
                                        await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                                    }
                                    return
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion>=backUpVersion){
                                        savedAnimeFranchises = await fileContent.savedAnimeFranchises || []
                                        await saveJSON(savedAnimeFranchises,"savedAnimeFranchises")
                                    }
                                    return
                                }).then(async()=>{
                                    savedUserList = await fileContent.savedUserList || {}
                                    await saveJSON(savedUserList,"savedUserList")
                                    return
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion>=backUpVersion){
                                        savedAnalyzeVariableTime = await fileContent.savedAnalyzeVariableTime || [90]
                                        await saveJSON(savedAnalyzeVariableTime,"savedAnalyzeVariableTime")
                                    }
                                    return
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion>=backUpVersion){
                                        savedUpdateAnalyzeAnimeTime = await fileContent.savedUpdateAnalyzeAnimeTime || [3]
                                        await saveJSON(savedUpdateAnalyzeAnimeTime,"savedUpdateAnalyzeAnimeTime")
                                    }
                                    return
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion>=backUpVersion){
                                        savedDeepUpdateTime = await fileContent.savedDeepUpdateTime || [320]
                                        await saveJSON(savedDeepUpdateTime,"savedDeepUpdateTime")
                                    }
                                    return
                                }).then(async()=>{
                                    lastAnilistPage = await fileContent.lastAnilistPage || 284
                                    await saveJSON(lastAnilistPage,"lastAnilistPage")
                                    return
                                }).then(async()=>{
                                    savedWarnAnime = await fileContent.savedWarnAnime || [ "!genre: ecchi","tag: boys' love","tag: cgi","!tag: ero guro","!tag: female harem",
                                                                                           "tag: full cgi","!tag: male harem","!tag: mixed gender harem",
                                                                                           "!tag: nudity","!tag: slavery","!tag: suicide","!tag: yuri","!tag: netorare", "!tag: rape"
                                                                                         ]
                                    await saveJSON(savedWarnAnime,"savedWarnAnime")
                                    return
                                }).then(async()=>{
                                    savedFilterAlgo = await fileContent.savedFilterAlgo || []
                                    await saveJSON(savedFilterAlgo,"savedFilterAlgo")
                                    return
                                }).then(async()=>{
                                    await usernameEl.val(savedUsername)
                                    return
                                }).then(async()=>{
                                    return await new Promise(async(resolve)=>{
                                        await warnAnimeContainerEl.css({visibility:"hidden"}).show()
                                        // Remove Current Filters
                                        var warnInfo = await $("#warnAnimeModal .flexdatalist-multiple").children("li.value")
                                        for(let i=0; i<warnInfo.length; i++) {
                                            await warnInfo.eq(i).children(".fdl-remove").trigger("click")
                                            await $("#warnAnimeModal .flexdatalist-alias").blur()
                                        }
                                        resolve()
                                    }).then(async()=>{
                                        // Reload Filters
                                        var warnAnimeInput
                                        for(let i=0; i<savedWarnAnime.length; i++) {
                                            warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                            await warnAnimeInput.val(savedWarnAnime[i])
                                            var e = await $.Event("keyup",{keyCode:13})
                                            await warnAnimeInput.trigger(e)
                                            await warnAnimeInput.val("")
                                        }
                                        await warnAnimeContainerEl.css({visibility:"visible"}).hide()
                                        return
                                    })
                                }).then(async()=>{
                                    return await new Promise(async(resolve)=>{
                                        await filterAlgoContainerEl.css({visibility:"hidden"}).show()
                                        // Remove Current Filters
                                        var filterInfo = await $("#filterAlgoModal .flexdatalist-multiple").children("li.value")
                                        for(let i=0; i<filterInfo.length; i++) {
                                            await filterInfo.eq(i).children(".fdl-remove").trigger("click")
                                            await $("#filterAlgoModal .flexdatalist-alias").blur()
                                        }
                                        resolve()
                                    }).then(async()=>{
                                        // Reload Filters
                                        var filterAlgoInput
                                        for(let i=0; i<savedFilterAlgo.length; i++) {
                                            filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                            await filterAlgoInput.val(savedFilterAlgo[i])
                                            var e = await $.Event("keyup",{keyCode:13})
                                            await filterAlgoInput.trigger(e)
                                            await filterAlgoInput.val("")
                                        }
                                        await filterAlgoContainerEl.css({visibility:"visible"}).hide()
                                        return
                                    })
                                }).then(async()=>{
                                    if(Object.keys(savedRecScheme).length) {
                                        await updateBtnEl.show()
                                        await updateIntervalBtnEl.show()
                                        await LoadData(savedRecScheme)
                                    } else {
                                        await updateBtnEl.hide()
                                        await updateIntervalBtnEl.hide()
                                        animeData = `
                                            <tr class="item ${savedTheme}" role="row">
                                                <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                                    <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                                    No Data
                                                </td>
                                            </tr>
                                        `
                                        await animeRecommendationListEl.empty()
                                        await animeRecommendationListEl.append(animeData)
                                        await animeTableEl.trigger("update")
                                    }
                                    return
                                }).then(async()=>{
                                    dataStatusSpinnerHomeEl.hide()
                                    dataStatusEl
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                                    importFileEl.val(null)
                                    await Swal.fire({
                                        heightAuto: false,
                                        text: "Data has been updated!",
                                        icon: "success",
                                        confirmButtonColor: "#000"
                                    })
                                    // Reset Custom Validation
                                    filterAlgoValidationEl.html("").hide()
                                    return
                                }).then(async()=>{
                                    // If version is lower, Update
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion<backUpVersion){
                                        versionUpdate = await true
                                        await saveJSON(versionUpdate,"versionUpdate")
                                        if(usernameEl.val()){
                                            Update(true)
                                        }
                                    }
                                    return
                                })
                                .catch(()=>{
                                    return
                                })
                            }
                        }
                        reader.readAsText(importedFile);
                    }
                })
                $("#exportBtn").on("click", async()=>{
                    // Android
                    if(exportPathIsAvailable) {
                    // Android
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to export your data?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                await new Promise(async(resolve)=>{
                                    await menuContainerEl.fadeOut(250)
                                    dataStatusSpinnerHomeEl.show()
                                    dataStatusEl
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                    resolve()
                                }).then(async()=>{
                                    await backUpData()
                                    return
                                })
                            }
                        })
                    // Android
                    } else {
                        console.log("WebtoApp: Choose an Export Path")
                    }
                    // Android
                })
                updateIntervalBtnEl.on("click",async()=>{
                    if(updateIntervalIsActive){
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to disable auto update for your recommendations list every hour?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                updateIntervalBtnEl.removeClass("selected")
                                updateIntervalIsActive = await false
                                await saveJSON(updateIntervalIsActive,"updateIntervalIsActive")
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to enable auto update for your recommendations list every hour?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                updateIntervalBtnEl.addClass("selected")
                                updateIntervalIsActive = await true
                                await saveJSON(updateIntervalIsActive,"updateIntervalIsActive")
                                updateIntervalStartDate = await updateIntervalStartDate || new Date()
                                await saveJSON(updateIntervalStartDate,"updateIntervalStartDate")
                                if((new Date).getTime()-(updateIntervalStartDate.getTime())>3600000){// 1hrs
                                    if(!requestIsRunning){
                                        if(await usernameEl.val()!==savedUsername) await usernameEl.val(savedUsername)
                                        willAutoUpdate = true
                                        Update(false)
                                    }
                                    // Interval
                                    if(!updateIntervalTimeout.length){
                                        var saveUpdateIntervalTimeout = setInterval(async()=>{
                                            if(!requestIsRunning){
                                                if(await usernameEl.val()!==savedUsername) await usernameEl.val(savedUsername)
                                                willAutoUpdate = true
                                                Update(false)
                                            }
                                        },3600000)
                                        updateIntervalTimeout.push(saveUpdateIntervalTimeout)
                                    }
                                } else {
                                    // Timeout
                                    setTimeout(async()=>{
                                        if(!requestIsRunning){
                                            if(await usernameEl.val()!==savedUsername) await usernameEl.val(savedUsername)
                                            willAutoUpdate = true
                                            Update(false)
                                        }
                                        // Interval
                                        if(!updateIntervalTimeout.length){
                                            var saveUpdateIntervalTimeout = setInterval(async()=>{
                                                if(!requestIsRunning){
                                                    if(await usernameEl.val()!==savedUsername) await usernameEl.val(savedUsername)
                                                    willAutoUpdate = true
                                                    Update(false)
                                                }
                                            },3600000)
                                            updateIntervalTimeout.push(saveUpdateIntervalTimeout)
                                        }
                                    },3600000-((new Date).getTime()-(updateIntervalStartDate.getTime())))
                                }
                            }
                        })
                    }
                })
                exportIntervalBtnEl.on("click",async()=>{
                    // Android
                    if(exportPathIsAvailable) {
                    // Android
                        if(exportIntervalIsActive){
                            Swal.fire({
                                heightAuto: false,
                                text: `Do you want to disable data back-up every hour?`,
                                showConfirmButton: true,
                                confirmButtonText: "Yes",
                                showDenyButton: true,
                                denyButtonText: "No",
                                confirmButtonColor: '#000',
                                denyButtonColor: '#e27d81',
                                icon: "question",
                                reverseButtons: true
                            })
                            .then(async(value) => {
                                if(value.isConfirmed){
                                    exportIntervalBtnEl.removeClass("selected")
                                    exportIntervalIsActive = await false
                                    await saveJSON(exportIntervalIsActive,"exportIntervalIsActive")
                                }
                            })
                        } else {
                            Swal.fire({
                                heightAuto: false,
                                text: `Do you want to enable data Back-Up every hour?`,
                                showConfirmButton: true,
                                confirmButtonText: "Yes",
                                showDenyButton: true,
                                denyButtonText: "No",
                                confirmButtonColor: '#000',
                                denyButtonColor: '#e27d81',
                                icon: "question",
                                reverseButtons: true
                            })
                            .then(async(value) => {
                                if(value.isConfirmed){
                                    exportIntervalBtnEl.addClass("selected")
                                    exportIntervalIsActive = await true
                                    await saveJSON(exportIntervalIsActive,"exportIntervalIsActive")
                                    exportIntervalStartDate = await exportIntervalStartDate || new Date()
                                    await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                                    if((new Date).getTime()-(exportIntervalStartDate.getTime())>3600000){// 1hrs
                                        await new Promise(async(resolve)=>{
                                            await menuContainerEl.fadeOut(250)
                                            resolve()
                                        }).then(async()=>{
                                            if(!willAutoUpdate){
                                                dataStatusSpinnerHomeEl.show()
                                                dataStatusEl
                                                    .empty()
                                                    .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                                await backUpData()
                                            }
                                            // Interval
                                            if(!exportIntervalTimeout.length){
                                                var saveExportIntervalTimeout = setInterval(async()=>{
                                                    setTimeout(async()=>{
                                                        if(!willAutoUpdate){
                                                            dataStatusSpinnerHomeEl.show()
                                                            dataStatusEl
                                                                .empty()
                                                                .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                                            await backUpData()
                                                        }
                                                    },1000)
                                                },3600000)
                                                exportIntervalTimeout.push(saveExportIntervalTimeout)
                                            }
                                        })
                                    } else {
                                        // Timeout
                                        setTimeout(async()=>{
                                            setTimeout(async()=>{
                                                if(!willAutoUpdate){
                                                    dataStatusSpinnerHomeEl.show()
                                                    dataStatusEl
                                                        .empty()
                                                        .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                                    await backUpData()
                                                }
                                                // Interval
                                                if(!exportIntervalTimeout.length){
                                                    var saveExportIntervalTimeout = setInterval(async()=>{
                                                        setTimeout(async()=>{
                                                            if(!willAutoUpdate){
                                                                dataStatusSpinnerHomeEl.show()
                                                                dataStatusEl
                                                                    .empty()
                                                                    .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                                                await backUpData()
                                                            }
                                                        },1000)
                                                    },3600000)
                                                    exportIntervalTimeout.push(saveExportIntervalTimeout)
                                                }
                                            },1000)
                                        },3600000-((new Date).getTime()-(exportIntervalStartDate.getTime())))
                                    }
                                }
                            })
                        }
                    // Android
                    } else {
                        console.log("WebtoApp: Choose an Export Path")
                    }
                    // Android
                })
                // Android
                $("#chooseExportPathBtn").on("click",()=>{
                    if(exportPathIsAvailable) {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to change your folder for export?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                console.log("WebtoApp: Choose an Export Path")
                            }
                        })
                    } else {
                        // Android has the confirmation here
                        console.log("WebtoApp: Choose an Export Path")
                    }
                })
                // Android
                $("#warnAnimeBtn").on("click", async ()=>{
                    await warnAnimeContainerEl.show()
                    warnAnimeModalEl.removeClass("swal2-hide-custom").addClass("swal2-show-custom").show()
                    var flex1El = await $("ul.flex1")
                    flex1El.animate({scrollTop: -Number.MAX_SAFE_INTEGER},1)
                    flex1El[0]?.scroll(0, -Number.MAX_SAFE_INTEGER)
                })
                $("#submitWarnAnime").on("click",async()=>{
                    var warnAnimeInputs = $("#warnAnimeModal .flexdatalist-multiple > .value").children(".text")
                    var warnAnime = []
                    for(let i=0; i<warnAnimeInputs.length; i++){
                        var warnName = warnAnimeInputs[i].textContent
                        warnAnime.push(warnName)
                    }
                    savedWarnAnime = await warnAnime || []
                    await saveJSON(savedWarnAnime,"savedWarnAnime")
                    await warnAnimeModalEl.removeClass("swal2-show-custom").addClass("swal2-hide-custom")
                    setTimeout(()=>{
                        warnAnimeContainerEl.hide()
                    },300)
                    LoadData(savedRecScheme)
                })
                $("#warnAnimeContainer, #cancelWarnAnime").on("click",async()=>{
                    warnAnimeModalEl.removeClass("swal2-show-custom").addClass("swal2-hide-custom")
                    setTimeout(async()=>{
                        warnAnimeContainerEl.hide()
                        await new Promise(async(resolve)=>{
                            // Remove Current Filters
                            var warnInfo = await $("#warnAnimeModal .flexdatalist-multiple").children("li.value")
                            for(let i=0; i<warnInfo.length; i++) {
                                await warnInfo.eq(i).children(".fdl-remove").trigger("click")
                                await $("#warnAnimeModal .flexdatalist-alias").blur()
                            }
                            resolve()
                        }).then(async()=>{
                            // apply saved
                            for(let i=0; i<savedWarnAnime.length; i++) {
                                warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                await warnAnimeInput.val(savedWarnAnime[i])
                                var e = await $.Event("keyup",{keyCode:13})
                                await warnAnimeInput.trigger(e)
                                await warnAnimeInput.val("")
                            }
                        })
                    },300)
                })
                $("#warnAnimeContainer, .swal2-modal-custom").on("click",(e)=>{
                    e.stopImmediatePropagation()
                })
                $("#filterAlgoBtn").on("click", async ()=>{
                    await filterAlgoContainerEl.show()
                    filterAlgoModalEl.removeClass("swal2-hide-custom").addClass("swal2-show-custom").show()
                    var flex2El = await $("ul.flex2")
                    flex2El.animate({scrollTop: -Number.MAX_SAFE_INTEGER},1)
                    flex2El[0]?.scroll(0, -Number.MAX_SAFE_INTEGER)
                })
                $("#submitFilterAlgo").on("click",async()=>{
                    var savedUserListValues = Object.values(savedUserList||{})
                    if(!isJson(savedUserList)||!isJson(savedUserListValues[0])||jsonIsEmpty(savedUserList)){
                        Swal.fire({
                            heightAuto: false,
                            text: `You need to update first before using this Feature!`,
                            showConfirmButton: true,
                            confirmButtonText: "Update",
                            showDenyButton: true,
                            denyButtonText: "Later",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "info",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                filterAlgoModalEl.removeClass("swal2-show-custom").addClass("swal2-hide-custom")
                                setTimeout(()=>{
                                    filterAlgoContainerEl.hide()
                                },300)
                                Update(false)
                                menuContainerEl.fadeOut(250)
                                for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
                                dataStatusSpinnerHomeEl.hide()
                                dataStatusEl
                                    .empty()
                                    .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                            }
                        })
                        return
                    } else {
                        var filterAlgoInputs = $("#filterAlgoModal .flexdatalist-multiple > .value").children(".text")
                        var filterAlgo = []
                        var filterName
                        for(let i=0; i<filterAlgoInputs.length; i++){
                            filterName = filterAlgoInputs[i].textContent
                            filterAlgo.push(filterName)
                        }
                        filterAlgoValidationEl
                            .removeClass("success-before")
                            .addClass("no-before")
                            .css({display:"flex"})
                            .html(
                                `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                    <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                    <div>Analyzing Variables...</div>
                                </div>`
                            )
                        Update(true, filterAlgo)
                    }
                })
                $("#filterAlgoContainer, #cancelFilterAlgo").on("click",async()=>{
                    filterAlgoModalEl.removeClass("swal2-show-custom").addClass("swal2-hide-custom")
                    setTimeout(async()=>{
                        filterAlgoContainerEl.hide()
                        // Remove Current Filters
                        await new Promise(async(resolve)=>{
                            var filterInfo = await $("#filterAlgoModal .flexdatalist-multiple").children("li.value")
                            for(let i=0; i<filterInfo.length; i++) {
                                await filterInfo.eq(i).children(".fdl-remove").trigger("click")
                                await $("#filterAlgoModal .flexdatalist-alias").blur()
                            }
                            resolve()
                        }).then(async()=>{
                            var filterAlgoInput
                            for(let i=0; i<savedFilterAlgo.length; i++) {
                                filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                await filterAlgoInput.val(savedFilterAlgo[i])
                                var e = await $.Event("keyup",{keyCode:13})
                                await filterAlgoInput.trigger(e)
                                await filterAlgoInput.val("")
                            }
                        })
                    },300)
                })
                $("#filterAlgoContainer, .swal2-modal-custom").on("click",(e)=>{
                    e.stopImmediatePropagation()
                })
                $("#sign-up").on("click", async ()=>{
                    Swal.fire({
                        heightAuto: false,
                        text: `Do you want to create an Anilist account?`,
                        showConfirmButton: true,
                        confirmButtonText: "Yes, Signup",
                        showDenyButton: true,
                        denyButtonText: "No",
                        confirmButtonColor: '#000',
                        denyButtonColor: '#e27d81',
                        icon: "question",
                        reverseButtons: true
                    }).then(async(value)=>{
                        if(value.isConfirmed){
                            await window.open('https://anilist.co/signup', '_blank')
                            if(!requestIsRunning){
                                const { value: username} = await Swal.fire({
                                    heightAuto: false,
                                    text: "Done signing-up your new account with Anilist? Update with your new username to load your own data.",
                                    input: 'text',
                                    inputLabel: 'Enter your Anilist Username:',
                                    customClass: {
                                        icon: 'no-border'
                                    },
                                    allowOutsideClick: false,
                                    allowEscapeKey: false,
                                    showConfirmButton: true,
                                    confirmButtonText: "Update",
                                    confirmButtonColor: '#000',
                                    showDenyButton: true,
                                    denyButtonColor: '#e27d81',
                                    denyButtonText: "Cancel",
                                    reverseButtons: true,
                                    inputValidator: async(value) => {
                                        return await new Promise(async(resolve) => {
                                            if(!value) {
                                                resolve("You need to write Something...")
                                            } else {
                                                var UsernameValidationEl = await $("#UsernameValidation")
                                                $.ajax({
                                                    type: 'POST',
                                                    url: 'https://graphql.anilist.co',
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                        'Accept': 'application/json',
                                                        'Cache-Control': 'max-age=31536000, immutable'
                                                    },
                                                    dataType: 'json',
                                                    data: JSON.stringify({
                                                        query: `{User(name:"${value}"){name}}`
                                                    }),
                                                    beforeSend: () => {
                                                        $(".swal2-validation-message")
                                                            .addClass("no-before")
                                                            .css({display:"flex"})
                                                            .html(
                                                                `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                                                    <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                                                    <div>Checking Username...</div>
                                                                </div>`
                                                            )
                                                    },
                                                    success: (data) => {
                                                        (async()=>{
                                                            initStartTime = await undefined
                                                            await saveJSON(initStartTime,"initStartTime")
                                                            UsernameValidationEl.fadeOut(1000,()=>{
                                                                UsernameValidationEl.remove()
                                                                $(".swal2-validation-message")
                                                                    .addClass("no-before").removeClass("no-before")
                                                                    .addClass("success-before")
                                                                    .html("User has been Found")
                                                                setTimeout(()=>{
                                                                    // Reset Custom Validation
                                                                    filterAlgoValidationEl.html("").hide()
                                                                    resolve()
                                                                },1000)
                                                            })
                                                        })();
                                                    },
                                                    error: (xhr) =>{
                                                        if(!window.navigator.onLine){
                                                            if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                                                (async()=>{
                                                                    initStartTime = await new Date()
                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                })();
                                                            }
                                                            UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                                            resolve("Unable to connect to the Internet")
                                                        } else if(xhr?.responseJSON?.errors?.[0]?.message==='Not Found.'){
                                                            (async()=>{
                                                                initStartTime = await undefined
                                                                await saveJSON(initStartTime,"initStartTime")
                                                                UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                                                resolve("Username not Found, Please Try Again...")
                                                            })();
                                                        } else {
                                                            if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                                                (async()=>{
                                                                    initStartTime = await new Date()
                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                })();
                                                            }
                                                            UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                                            resolve(`An Error Occured, Please Try Again in ${msToTime(Math.max(60000-(new Date()-initStartTime),1000))}`)
                                                        }
                                                    }
                                                })
                                            }
                                        })
                                    }
                                })
                                if(username){
                                    await usernameEl.val(username)
                                    Update(false)
                                }
                            }
                        }
                    })
                })
                themeBtnEl.on("click", async ()=>{
                    if(savedTheme==="darkMode"){
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to change your theme to light mode?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                var newTheme = "lightMode"
                                themeBtnEl.removeClass("selected")
                                await loadTheme(newTheme,savedTheme)
                                savedTheme = await newTheme
                                await saveJSON(savedTheme,"savedTheme")
                                LoadData(savedRecScheme)
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to change your theme to dark mode?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                var newTheme = "darkMode"
                                themeBtnEl.addClass("selected")
                                await loadTheme(newTheme,savedTheme)
                                savedTheme = await newTheme
                                await saveJSON(savedTheme,"savedTheme")
                                LoadData(savedRecScheme)
                            }
                        })
                    }
                })
                hideKidsAnimeBtnEl.on("click", async ()=>{
                    if(kidsAnimeIsHidden){
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to show all anime with Kids tag?`,
                            showConfirmButton: true,
                            confirmButtonText: "Show",
                            showDenyButton: true,
                            denyButtonText: "Cancel",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value)=>{
                            if(value.isConfirmed){
                                kidsAnimeIsHidden = await false
                                await saveJSON(kidsAnimeIsHidden,"kidsAnimeIsHidden")
                                hideKidsAnimeBtnEl.removeClass("selected")
                                LoadData(savedRecScheme)
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to hide all anime with Kids tag?`,
                            showConfirmButton: true,
                            confirmButtonText: "Hide",
                            showDenyButton: true,
                            denyButtonText: "Cancel",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value)=>{
                            if(value.isConfirmed){
                                kidsAnimeIsHidden = await true
                                await saveJSON(kidsAnimeIsHidden,"kidsAnimeIsHidden")
                                hideKidsAnimeBtnEl.addClass("selected")
                                LoadData(savedRecScheme)
                            }
                        })
                    }
                })
                hideUnwatchedSequelsBtnEl.on("click", async ()=>{
                    if(hideUnwatchedSequels){
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to show all unwatched-Animes' sequels?`,
                            showConfirmButton: true,
                            confirmButtonText: "Show",
                            showDenyButton: true,
                            denyButtonText: "Cancel",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value)=>{
                            if(value.isConfirmed){
                                hideUnwatchedSequelsBtnEl.removeClass("selected")
                                Update(true, undefined, false)
                                menuContainerEl.fadeOut(250)
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to hide all unwatched-Animes' sequels?`,
                            showConfirmButton: true,
                            confirmButtonText: "Hide",
                            showDenyButton: true,
                            denyButtonText: "Cancel",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value)=>{
                            if(value.isConfirmed){
                                hideUnwatchedSequelsBtnEl.addClass("selected")
                                Update(true, undefined, true)
                                menuContainerEl.fadeOut(250)
                            }
                        })
                    }
                })
                animeRecommendationListEl.delegate('td.anime-score', 'click' , async function() {
                    var warns = $(this).children("div").children("div").attr("title")
                    if(warns){
                        await Swal.fire({
                            heightAuto: false,
                            text: `Content Warning, Anime has the following contents: \n${warns}`,
                            icon: "info",
                            confirmButtonColor: "#000",
                            customClass: {
                                container: 'whitespace-pre-wrap'
                            }
                        })
                    }
                })
                // Android
                $("#restart").on('click', ()=>{
                    Swal.fire({
                        heightAuto: false,
                        text: `Do you want to restart the app?`,
                        showConfirmButton: true,
                        confirmButtonText: "Yes",
                        showDenyButton: true,
                        denyButtonText: "No",
                        confirmButtonColor: '#000',
                        denyButtonColor: '#e27d81',
                        icon: "question",
                        reverseButtons: true
                    })
                    .then(async(value) => {
                        if(value.isConfirmed){
                            window.location.href=window.location.href
                        }
                    })
                })
                // Android
                $(".anime-table-headers").on('click', ()=>{
                    var savedSort = animeTableEl[0]?.config?.sortList?.[0]
                    if(savedSort instanceof Array){
                        saveJSON(savedSort,"savedSort")
                    }
                    setTimeout(()=>{
                        pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                    },1)
                })
                pageNumberOptionsEl.on('change',()=>{
                    setTimeout(()=>{
                        pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                    },1)
                })
                $(".filter-container, .filter-container-custom").on('DOMNodeInserted','.flexdatalist-multiple',()=>{
                    if(savedTheme==="darkMode"){
                        $(` .flexdatalist-multiple,
                            .flexdatalist-alias,
                            .flexdatalist-results,
                            .flexdatalist-multiple li.value
                        `).addClass('darkMode')
                    }
                })
                bodyEl.on('DOMNodeInserted','.swal2-popup, .swal2-popup-custom, .swal2-container',()=>{
                    if(savedTheme==="darkMode"){
                        $(` .swal2-confirm,
                            .swal2-confirm-custom,
                            .swal2-footer a,
                            .swal2-popup,
                            .swal2-popup-custom,
                            .swal2-validation-message
                        `).addClass('darkMode')
                        // Observe Attribute Change
                        var swalValMes = document.getElementById("swal2-validation-message")
                        if(swalValMes){
                            var observed = new MutationObserver((mutations)=>{
                                var classList = mutations[0]?.target?.classList ?? []
                                if(!classList.contains("darkMode")){
                                    classList.add("darkMode")
                                } else {
                                    return
                                }
                            })
                            observed.observe(document.getElementById("swal2-validation-message"),{attributes:true})
                        }
                    }
                })
                bodyEl.on('DOMNodeInserted','.flexdatalist-results',()=>{
                    if(savedTheme==="darkMode"){
                        $(".flexdatalist-results").addClass('darkMode')
                    }
                })
                $(".filter-container-custom, .filter-container").on('DOMNodeInserted','li.value',()=>{
                    if(savedTheme==="darkMode"){
                        $(".flexdatalist-multiple li.value").addClass('darkMode')
                    }
                })
                bodyEl.on('scroll', function () {
                    setTimeout(async()=>{
                        await saveJSON(bodyEl.scrollTop()||0,"savedYscroll")
                    },1)
                })
                $(window).on("keydown", (e) => {
                    if(!$("input").is(':focus')){
                        e.preventDefault()
                        var evtobj = window.event? event : e
                        var keyCode = evtobj.which || evtobj.keyCode || 0
                        if(keyCode===37){//left arrow
                            if(evtobj.ctrlKey){
                                $("#first").click()
                            } else {
                                $("#prev").click()
                            }
                        } else if(keyCode===39){//right arrow
                            if(evtobj.ctrlKey){
                                $("#last").click()
                            } else {
                                $("#next").click()
                            }
                        }
                    }
                })
                $(window).on("resize", (e) => {
                    // Hide Fixed Pager on Mobile
                    if(maxClientHeight<document.body.clientHeight){
                        maxClientHeight = document.body.clientHeight
                    }
                    if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
                        if(screen.availHeight>screen.availWidth){
                            if(document.body.clientHeight<.9*maxClientHeight){
                                pagerEl.css({position: "static"})
                            } else {
                                setTimeout(()=>{
                                    pagerEl.css({position: "fixed"})
                                },100)
                            }
                        } else {
                            setTimeout(()=>{
                                pagerEl.css({position: "fixed"})
                            },100)
                        }
                    }
                    // Hide Fixed Pager on Mobile
                })
                $(window).on("orientationchange", () => {
                    // Hide Fixed Pager on Mobile
                    if(maxClientHeight<document.body.clientHeight){
                        maxClientHeight = document.body.clientHeight
                    }
                    if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
                        if(screen.availHeight>screen.availWidth){
                            if(document.body.clientHeight<.9*maxClientHeight){
                                pagerEl.css({position: "static"})
                            } else {
                                setTimeout(()=>{
                                    pagerEl.css({position: "fixed"})
                                },100)
                            }
                        } else {
                            setTimeout(()=>{
                                pagerEl.css({position: "fixed"})
                            },100)
                        }
                    }
                    // Hide Fixed Pager on Mobile
                })
                $("input").on("focusout",() => {
                    setTimeout(()=>{
                        pagerEl.css({position: "fixed"}) // If the pager didn't show back
                    },100)
                })
                resolve()
            })
        }).then(async()=>{
            return await new Promise(async(resolve)=>{
                // Initial SavedTheme
                await loadTheme(savedTheme)
                resolve()
            })
        }).then(async()=>{
            // Init Modules/Config/Functions
            return await new Promise(async(resolve)=>{
                // Jquery Table Sorter
                await animeTableEl
                    .tablesorter({
                        sortInitialOrder: "asc",
                        headers: {
                            1:{sortInitialOrder: "desc"},
                            4:{sortInitialOrder: "desc"},
                            9:{sortInitialOrder: "desc"},
                        },
                        widgets: ["saveSort"],
                        widgetOptions : {
                            saveSort : true
                        }
                    })
                    .tablesorterPager({
                        container: pagerEl,
                        updateArrows: true,
                        page: (savedTableStatus==="Unhidden"? savedUnhiddenTablePage:savedHiddenTablePage),
                        savePages: true,
                        size: 8,
                        pageReset: false,
                        removeRows: true,
                        cssNext: '.next',
                        cssPrev: '.prev',
                        cssFirst: '.first',
                        cssLast: '.last',
                        cssGoto: '.pagenum',
                        cssPageDisplay: '.pagedisplay'
                    })
                    .delegate('button.hide-anime', 'click' , async(e) => {
                        var hiddenRow = await $(e.currentTarget).closest('tr') || $(e.target).closest('tr')
                        var hiddenAnimeID = hiddenRow.children("td.animeTitle").children("a").attr("data-value")
                        savedHiddenAnimeIDs[hiddenAnimeID] = await true
                        await saveJSON(savedHiddenAnimeIDs,"savedHiddenAnimeIDs")
                        hiddenRow.addClass("remove-me")
                        animeTableEl.trigger("pagerUpdate")
                        if(animeTableEl[0]?.config?.rowsCopy?.length===0){
                            await animeRecommendationListEl.empty()
                            await animeRecommendationListEl.append(`
                                <tr class="item ${savedTheme}" role="row">
                                    <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                        <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                        No Data
                                    </td>
                                </tr>
                            `)
                        }
                        // Have a Hidden Anime
                        if(await !jsonIsEmpty(savedHiddenAnimeIDs)){
                            await showAllAnimeBtnEl.show()
                        }
                        await pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                        return false
                    })
                    .delegate('button.show-anime', 'click' , async(e) => {
                        var hiddenRow = await $(e.currentTarget).closest('tr') || $(e.target).closest('tr')
                        var hiddenAnimeID = await hiddenRow.children("td.animeTitle").children("a").attr("data-value")
                        await delete savedHiddenAnimeIDs[hiddenAnimeID]
                        await saveJSON(savedHiddenAnimeIDs,"savedHiddenAnimeIDs")
                        // No Hidden Anime
                        await hiddenRow.addClass("remove-me")
                        await animeTableEl.trigger("pagerUpdate")
                        if(await jsonIsEmpty(savedHiddenAnimeIDs)||animeTableEl[0]?.config?.rowsCopy?.length===0){
                            await animeRecommendationListEl.empty()
                            await animeRecommendationListEl.append(`
                                <tr class="item ${savedTheme}" role="row">
                                    <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                        <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                        No Data
                                    </td>
                                </tr>
                            `)
                            await showAllAnimeBtnEl.hide()
                        }
                        await pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                        return false
                    })
                    .bind('pageMoved', async() => {
                        await pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                        var page = await animeTableEl[0]?.config?.pager?.page
                        ++page
                        if(savedTableStatus==="Unhidden"){
                            savedUnhiddenTablePage = await page || 1
                            await saveJSON(savedUnhiddenTablePage,"savedUnhiddenTablePage")
                        } else {
                            savedUnhiddenTablePage = await page || 1
                            await saveJSON(savedUnhiddenTablePage,"savedHiddenTablePage")
                        }
                    })
                // Flex DataList
                await $(".flexdatalist").flexdatalist({})
                await $(".flexdatalistWarnAnime").flexdatalist({})
                await $(".flexdatalistFilterAlgo").flexdatalist({})
                resolve()
            })
        }).then(async()=>{
            // Init Backup Data
            return await new Promise(async(resolve)=>{
                if(savedBackUpVersion<backUpVersion){
                    if(typeof savedAnalyzeVariableTime==="number"){
                        savedAnalyzeVariableTime = await [savedAnalyzeVariableTime||90]
                        await saveJSON(savedAnalyzeVariableTime,"savedAnalyzeVariableTime")
                    } else {
                        savedAnalyzeVariableTime = await [90]
                        await saveJSON(savedAnalyzeVariableTime,"savedAnalyzeVariableTime")
                    }
                    if(typeof savedUpdateAnalyzeAnimeTime==="number"){
                        savedUpdateAnalyzeAnimeTime = await [savedUpdateAnalyzeAnimeTime||3]
                        await saveJSON(savedUpdateAnalyzeAnimeTime,"savedUpdateAnalyzeAnimeTime")
                    } else {
                        savedUpdateAnalyzeAnimeTime = await [3]
                        await saveJSON(savedUpdateAnalyzeAnimeTime,"savedUpdateAnalyzeAnimeTime")
                    }
                    if(typeof savedDeepUpdateTime==="number"){
                        savedDeepUpdateTime = await [savedDeepUpdateTime||320]
                        await saveJSON(savedDeepUpdateTime,"savedDeepUpdateTime")
                    } else {
                        savedDeepUpdateTime = await [320]
                        await saveJSON(savedDeepUpdateTime,"savedDeepUpdateTime")
                    }
                    resolve()
                } else {
                    resolve()
                }
            }).then(async()=>{
                if(savedAnimeEntries.length<1||lastSavedUpdateTime===0||savedBackUpVersion<backUpVersion){
                    var worker0 = await new Worker(`./js-css/worker/getAnimeEntries-${version}.js`)
                    await worker0.postMessage("")
                    worker0.onmessage = async (message) => {
                        await worker0.terminate()
                        const data = await message.data
                        savedAnimeEntries = await data.savedAnimeEntries || []
                        await saveJSON(savedAnimeEntries,"savedAnimeEntries")
                        lastSavedUpdateTime = await data.lastSavedUpdateTime || 0
                        await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                        if(savedUsername){
                            versionUpdate = await true
                            await saveJSON(versionUpdate,"versionUpdate")
                            if(usernameEl.val()){
                                Update(true)
                            }
                        }
                        return
                    }
                    worker0.onerror = () => {
                        return
                    }
                } else {
                    return
                }
            }).then(async()=>{
                if(await savedFilterOptionsJson.length<1||savedBackUpVersion<backUpVersion){
                    var worker1 = await new Worker(`./js-css/worker/getOptions-${version}.js`)
                    await worker1.postMessage("")
                    worker1.onmessage = async (message) => {
                        await worker1.terminate()
                        const data = await message.data
                        savedFilterOptionsJson = await data.savedFilterOptionsJson || []
                        await saveJSON(savedFilterOptionsJson,"savedFilterOptionsJson")
                        allFilterInfo = await data.allFilterInfo || {}
                        await saveJSON(allFilterInfo,"allFilterInfo")
                        await $(".flexdatalist").flexdatalist({
                            minLength: 0,
                            searchIn: 'info',
                            data: savedFilterOptionsJson
                        })
                        return
                    }
                    worker1.onerror = async (message) => {
                        return
                    }
                } else {
                    await $(".flexdatalist").flexdatalist({
                        minLength: 0,
                        searchIn: 'info',
                        data: savedFilterOptionsJson
                    })
                    return
                }
            }).then(async()=>{
                if(await savedAnimeFranchises.length<1||savedBackUpVersion<backUpVersion){
                    var worker8 = await new Worker(`./js-css/worker/getAnimeFranchises-${version}.js`)
                    await worker8.postMessage("")
                    worker8.onmessage = async (message) => {
                        await worker8.terminate()
                        const data = await message.data
                        savedAnimeFranchises = await data.savedAnimeFranchises || []
                        await saveJSON(savedAnimeFranchises,"savedAnimeFranchises")
                        return
                    }
                    worker8.onerror = async (message) => {
                        return
                    }
                }
            })
        }).then(async()=>{
            // Apply Saved Data
            return await new Promise(async(resolve) => {
                // Reload Name
                if(savedUsername){
                    await usernameEl.val(savedUsername)
                    await updateIntervalBtnEl.show()
                } else {
                    savedUserList = await {}
                    await saveJSON(savedUserList,"savedUserList")
                }
                // Reload Table Filters/Identifiers
                    // Table Filters
                if(savedUsername){
                    var filterInput
                    for(let i=0; i<savedFilters.length; i++) {
                        filterInput = await $("#filters .flexdatalist-multiple-value > .flexdatalist-alias")
                        await filterInput.val(savedFilters[i])
                        var e = await $.Event("keyup",{keyCode:13})
                        await filterInput.trigger(e)
                        await filterInput.val("")
                    }
                }
                    // Algorithm Filters
                var filterAlgoInput
                for(let i=0; i<savedFilterAlgo.length; i++) {
                    filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                    await filterAlgoInput.val(savedFilterAlgo[i])
                    var e = await $.Event("keyup",{keyCode:13})
                    await filterAlgoInput.trigger(e)
                    await filterAlgoInput.val("")
                }
                await filterAlgoContainerEl.css({visibility:"visible"}).hide()
                    // Warn Content Identifier
                var warnAnimeInput
                for(let i=0; i<savedWarnAnime.length; i++) {
                    warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                    await warnAnimeInput.val(savedWarnAnime[i])
                    var e = await $.Event("keyup",{keyCode:13})
                    await warnAnimeInput.trigger(e)
                    await warnAnimeInput.val("")
                }
                await warnAnimeContainerEl.css({visibility:"visible"}).hide()

                // Menu Filters
                if(await kidsAnimeIsHidden){
                    await hideKidsAnimeBtnEl.addClass("selected")
                }
                if(await hideUnwatchedSequels){
                    await hideUnwatchedSequelsBtnEl.addClass("selected")
                }
                if(await savedTheme==="darkMode"){
                    await themeBtnEl.addClass("selected")
                }
                if(await updateIntervalIsActive){
                    await updateIntervalBtnEl.addClass("selected")
                }
                if(await exportIntervalIsActive){
                    await exportIntervalBtnEl.addClass("selected")
                }

                // Init Last List (Unhidden/Hidden)
                var filters = await $("#filters .flexdatalist-multiple").children("li.value")
                for(let i=0; i<filters.length; i++) {
                    var filterName = await filters.eq(i).children(".text")[0]?.innerText
                    if(await filterName.toLowerCase()==="hidden"){
                        await hiddenUnhiddenBtnEl.text("Hidden")
                    }
                }

                // Load Last Saved Update
                dataStatusSpinnerHomeEl.hide()
                dataStatusEl
                    .empty()
                    .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)

                // Load Table
                if(await Object.keys(savedRecScheme).length>0){
                    await updateBtnEl.show()
                    await LoadData(savedRecScheme)
                    if(await !jsonIsEmpty(savedHiddenAnimeIDs)){
                        await showAllAnimeBtnEl.show()
                    }
                    resolve()
                } else {
                    animeData = `
                        <tr class="item ${savedTheme}" role="row">
                            <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                No Data
                            </td>
                        </tr>
                    `
                    await animeRecommendationListEl.empty()
                    await animeRecommendationListEl.append(animeData)
                    await animeTableEl.trigger("update")
                    // Android
                    // Export Path is Available
                    if(await exportPathIsAvailable){
                        await $("#chooseExportPathBtn").show()
                    }
                    // Android
                    resolve()
                }
            })
        }).then(async()=>{
            // Update Saved DOM State
            return await new Promise(async(resolve)=>{
                await $.tablesorter.sortOn(animeTableEl[0]?.config, [savedSort])
                await pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                await bodyEl.animate({scrollTop: savedYscroll},1)
                var flex0El = await $("ul.flex0")
                var flex1El = await $("ul.flex1")
                var flex2El = await $("ul.flex2")
                flex0El.animate({scrollTop: Number.MAX_SAFE_INTEGER},1)
                flex1El.animate({scrollTop: -Number.MAX_SAFE_INTEGER},1)
                flex2El.animate({scrollTop: -Number.MAX_SAFE_INTEGER},1)
                // Only Works with SetTimeout >=1 in firefox idk why
                setTimeout(()=>{
                    flex0El[0]?.scroll(0, flex0El.outerHeight())
                },1)
                flex1El[0]?.scroll(0, -Number.MAX_SAFE_INTEGER)
                flex2El[0]?.scroll(0, -Number.MAX_SAFE_INTEGER)
                resolve()
            })
        }).then(async()=>{
            // Auto Intervals
            return await new Promise(async(resolve) => {
                // Auto Update
                if(await updateIntervalIsActive){
                    await updateIntervalBtnEl.css({background: "white",color:"black"})
                    updateIntervalStartDate = await updateIntervalStartDate || new Date()
                    await saveJSON(updateIntervalStartDate,"updateIntervalStartDate")
                    if(await (new Date).getTime()-(updateIntervalStartDate.getTime())>3600000){// 1hr
                        if(!requestIsRunning&&usernameEl.val()){
                            if(await usernameEl.val()!==savedUsername) await usernameEl.val(savedUsername)
                            willAutoUpdate = true
                            Update(false)
                        }
                        // Interval
                        if(!updateIntervalTimeout.length){
                            var saveUpdateIntervalTimeout = setInterval(async()=>{
                                if(!requestIsRunning){
                                    if(await usernameEl.val()!==savedUsername) await usernameEl.val(savedUsername)
                                    willAutoUpdate = true
                                    Update(false)
                                }
                            },3600000)
                            updateIntervalTimeout.push(saveUpdateIntervalTimeout)
                        }
                        resolve()
                    } else {
                        // Timeout
                        setTimeout(async()=>{
                            if(!requestIsRunning&&usernameEl.val()){
                                if(await usernameEl.val()!==savedUsername) await usernameEl.val(savedUsername)
                                willAutoUpdate = true
                                Update(false)
                            }
                            // Interval
                            if(!updateIntervalTimeout.length){
                                var saveUpdateIntervalTimeout = setInterval(async()=>{
                                    if(!requestIsRunning){
                                        if(await usernameEl.val()!==savedUsername) await usernameEl.val(savedUsername)
                                        willAutoUpdate = true
                                        Update(false)
                                    }
                                },3600000)
                                updateIntervalTimeout.push(saveUpdateIntervalTimeout)
                            }
                        },3600000-((new Date).getTime()-(updateIntervalStartDate.getTime())))
                        resolve()
                    }
                } else {
                    resolve()
                }
            }).then(async()=>{
                // Auto Export
                if(exportIntervalIsActive){
                    await exportIntervalBtnEl.css({background: "white",color:"black"})
                    exportIntervalStartDate = await exportIntervalStartDate || new Date()
                    await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                    if(await ((new Date).getTime()-(exportIntervalStartDate.getTime())>3600000)){// 1hr
                        if(!willAutoUpdate){
                            dataStatusSpinnerHomeEl.show()
                            dataStatusEl
                                .empty()
                                .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                            backUpData()
                        }
                        // Interval
                        if(!exportIntervalTimeout.length){
                            var saveExportIntervalTimeout = await setInterval(async()=>{
                                setTimeout(async()=>{
                                    if(!willAutoUpdate){
                                        dataStatusSpinnerHomeEl.show()
                                        dataStatusEl
                                            .empty()
                                            .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                        backUpData()
                                    }
                                },1000)
                            },3600000)
                            await exportIntervalTimeout.push(saveExportIntervalTimeout)
                        }
                        return
                    } else {
                        // Timeout
                        setTimeout(async()=>{
                            setTimeout(async()=>{
                                if(!willAutoUpdate){
                                    dataStatusSpinnerHomeEl.show()
                                    dataStatusEl
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                    backUpData()
                                }
                                // Interval
                                if(!exportIntervalTimeout.length){
                                    var saveExportIntervalTimeout = await setInterval(async()=>{
                                        setTimeout(async()=>{
                                            if(!willAutoUpdate){
                                                dataStatusSpinnerHomeEl.show()
                                                dataStatusEl
                                                    .empty()
                                                    .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                                backUpData()
                                            }
                                        },1000)
                                    },3600000)
                                    await exportIntervalTimeout.push(saveExportIntervalTimeout)   
                                }
                            },1000)
                        },3600000-((new Date).getTime()-(exportIntervalStartDate.getTime())))
                        return
                    }
                } else {
                    return
                }
            })
        }).then(async()=>{
            // Check if User Data is Updated
            if(versionUpdate&&savedUsername&&usernameEl.val()){
                Update(true)
            }
            // Save Back-Up Data Version Updates
            if(savedBackUpVersion<backUpVersion){
                await saveJSON(backUpVersion,"backUpVersion")
                return
            } else {
                return
            }
            return
        }).then(async()=>{
            // Init New User
            if(!savedUsername){
                initUsernameData()
                return
            } else {
                return
            }
        }).then(async()=>{
            // Load Saved Theme
            return await new Promise(async(resolve)=>{
                await loadTheme(savedTheme)
                resolve()
            })
        }).then(async()=>{
            // Re-moval if fadeout failed
            setTimeout(async()=>{
                var loader = await $("#loader")
                if(loader.css("display")!=="none"){
                    loader.fadeOut(500)
                    pageInits = false
                }
            },5000)
            // Limit Page Load to 3s
            const minimumLoadTime = 3000//ms
            const splitMS = Math.max((minimumLoadTime-((new Date().getTime())-pageLoadStartDate))/2,0)
            return await setTimeout(async()=>{
                await $("#loader").fadeOut(splitMS)
                pageInits = false
            },splitMS)
        })
    }

    // Main Functions
    function Update(notAnUpdate, filterAlgo, doHideUnwatchedSeq){
        updateStartTime = new Date
        var filterInput = $("#filters > ul > .flexdatalist-multiple-value > input")
        var username = usernameEl.val()
        var filter = filterInput.val()
        // Check Input Validity
        if(!username){
            usernameEl[0]?.setCustomValidity("Anilist Username is Required!")
            usernameEl[0]?.reportValidity()
        } else {
            // Start Update Request
            if(!requestIsRunning){
                requestIsRunning = true
            }
            var updateID = Math.random()
            while(updateIDs.includes(updateID)){
                updateID = Math.random()
            }
            updateIDs.push(updateID)
            if(updateIDs.length>1){
                setTimeout(()=>{
                    analyzeVariables(updateID, username, notAnUpdate, filterAlgo, doHideUnwatchedSeq)
                },requestIntervalMS)
            } else {
                analyzeVariables(updateID, username, notAnUpdate, filterAlgo, doHideUnwatchedSeq)
            }
        }
    }

    async function analyzeVariables(updateID, username, notAnUpdate, filterAlgo, doHideUnwatchedSeq) {
        var analyzeVariableTime = Math.ceil(arrayMean(savedAnalyzeVariableTime))
        savedFilterAlgo = await (filterAlgo || savedFilterAlgo || [])
        //
        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
        for(let i=analyzeVariableTime; i>=0; i--){
            var timeout = setTimeout(()=>{
                dataStatusSpinnerHomeEl.show()
                if(i<1){
                    dataStatusEl
                        .empty()
                        .append(`<span style="white-space:nowrap;">Analyzing your List... Please Wait a Moment...`)
                } else {
                    dataStatusEl
                        .empty()
                        .append(`<span style="white-space:nowrap;">Analyzing your List...⠀</span><span style="white-space:nowrap;">Estimated Time: ${msToTime(i*1000)}</span>`)
                }
            },(analyzeVariableTime-i)*1000)
            updateStateText.push(timeout)
        }
        var savedIncluded = []
        var savedExcluded = []
        var filterName
        for(let i=0; i<savedFilterAlgo.length; i++){
            filterName = savedFilterAlgo[i].trim().toLowerCase()
            if(filterName.charAt(0)==="!") {
                filterName = filterName.slice(1)
                filterName = typeof filterName==="string"? filterName.split(":") : []
                // Only Allow Specific (non-specified removes almost all predictors)
                if(filterName.length>1){
                    filterName = [filterName.shift(),filterName.join()]
                    var type = filterName[0]
                    var cinfo = filterName[1].trim().toLowerCase()
                    if(cinfo.charAt(0)==="!"){
                        cinfo = cinfo.slice(1)
                        savedExcluded.push(type+":"+cinfo)
                    } else {
                        savedExcluded.push(type+":"+cinfo)
                    }
                } else if(filterName.length===1){
                    savedExcluded.push(filterName[0])
                }
            }
            else savedIncluded.push(filterName)
        }
        if(!notAnUpdate){
            var AnalyzeVariableStartTime = new Date()
            if(lastSavedUpdateTime===0){
                deepUpdateStartTime = new Date()
                isDeepUpdate = true
            }
            // Check Parameters
            if(username.length>0) {
                var maxAnimePerChunk = 500
                var userEntries = []
                async function recallAV(chunk){
                    // Allow Single Instance of Update
                    if(updateIDs.length>1&&updateID!==updateIDs.at(-1)){
                        updateIDs = updateIDs.filter((id)=>id!==updateID) // one line
                        return
                    }
                    // Initialize Anilist Graphql Data
                    var query = `
                    {
                        MediaListCollection(userName: "${username}",
                        chunk:${chunk},
                        perChunk:${maxAnimePerChunk},
                        forceSingleCompletedList: true,
                        type: ANIME) {
                            hasNextChunk
                            lists {
                                entries {
                                    status
                                    media {
                                        id
                                        title {
                                            userPreferred
                                        }
                                        relations {
                                            edges {
                                                relationType
                                                node{
                                                    id
                                                }
                                            }
                                        }
                                        averageScore
                                        episodes
                                        duration
                                        trending
                                        popularity
                                        favourites
                                        format
                                        genres
                                        tags {
                                            name
                                            rank
                                            category
                                        }
                                        studios {
                                            nodes {
                                                name
                                                isAnimationStudio
                                            }
                                        }
                                        seasonYear
                                        season
                                        staff {
                                            edges {
                                                node {
                                                    name {
                                                        userPreferred
                                                    }
                                                }
                                                role
                                            }
                                        }
                                    }
                                    score
                                }
                            }
                        }
                    }
                    `;
                    // Request API
                    $.ajax({
                        type: 'POST',
                        url: 'https://graphql.anilist.co',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json',
                            'Cache-Control': 'max-age=31536000, immutable'
                        },
                        dataType: 'json',
                        data: JSON.stringify({
                            query: query
                        }),
                        success: (result)=> {
                            var userList = result.data.MediaListCollection.lists
                            var hasNextChunk = result.data.MediaListCollection.hasNextChunk || userList.length>0
                            for(let i=0; i<userList.length; i++){
                                userEntries = userEntries.concat(userList[i].entries)
                            }
                            if(hasNextChunk){
                                return recallAV(++chunk)
                            } else {
                                // Reset User List
                                if(isDeepUpdate){
                                    (async()=>{
                                        savedUserList = await {}
                                        await saveJSON(savedUserList,"savedUserList")
                                    })();
                                }
                                var worker2 = new Worker(`./js-css/worker/analyzeVariable-${version}.js`)
                                worker2.postMessage({savedUserList: savedUserList, userEntries: userEntries, savedAnimeFranchises: savedAnimeFranchises, savedIncluded: savedIncluded, savedExcluded: savedExcluded})
                                worker2.onmessage = (message) => {
                                    worker2.terminate()
                                    const data = message.data
                                    // Alert user if Scored List is 0
                                    // to have a better recommendation
                                    var userListCount = data.userListCount
                                    if(userListCount===0){
                                        Swal.fire({
                                            heightAuto: false,
                                            title: "Let us know you've liked...",
                                            text: `To make your recommendations better, rate the anime you've already watched in your Anilist account for us to make an Analysis, you can also transfer your MAL List to Anilist.`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Go to Anilist",
                                            showDenyButton: true,
                                            denyButtonText: "Import my MAL",
                                            showCancelButton: true,
                                            cancelButtonText: "Later",
                                            confirmButtonColor: '#000',
                                            denyButtonColor: '#2E51A2',
                                            cancelButtonColor: '#e27d81',
                                            icon: "info",
                                            reverseButtons: true
                                        })
                                        .then(async(value) => {
                                            if(value.isConfirmed){
                                                window.open('https://anilist.co/search/anime', '_blank')
                                                Swal.fire({
                                                    heightAuto: false,
                                                    title: "Let us know you've liked...",
                                                    text: `If you're done rating an Anime, click update below or in the settings.`,
                                                    showConfirmButton: true,
                                                    confirmButtonText: "Update",
                                                    showDenyButton: true,
                                                    denyButtonText: "Cancel",
                                                    confirmButtonColor: '#000',
                                                    denyButtonColor: '#e27d81',
                                                    icon: "info",
                                                    reverseButtons: true
                                                })
                                                .then(async(value)=>{
                                                    if(value.isConfirmed){
                                                        Update(false)
                                                    }
                                                })
                                            } else if(value.isDenied) {
                                                malanilistImportExport()
                                            }
                                        })
                                    } else if(userListCount>0&&userListCount<100) {
                                        Swal.fire({
                                            heightAuto: false,
                                            title: "Let us know you've liked...",
                                            text: `You currently rated ≤${userListCount} unique anime in your Anilist account, a minimum of 30-100 will suffice the recommendation analysis.`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Sure, Later",
                                            showDenyButton: true,
                                            denyButtonText: "Go to Anilist",
                                            confirmButtonColor: '#e27d81',
                                            denyButtonColor: '#000',
                                            icon: "info",
                                            reverseButtons: true
                                        })
                                        .then(async(value) => {
                                            if(value.isDenied){
                                                window.open('https://anilist.co/search/anime', '_blank');
                                                Swal.fire({
                                                    heightAuto: false,
                                                    title: "Let us know you've liked...",
                                                    text: `If you're done rating an Anime, click update below or in the settings.`,
                                                    showConfirmButton: true,
                                                    confirmButtonText: "Update",
                                                    showDenyButton: true,
                                                    denyButtonText: "Cancel",
                                                    confirmButtonColor: '#000',
                                                    denyButtonColor: '#e27d81',
                                                    icon: "info",
                                                    reverseButtons: true
                                                })
                                                .then(async(value)=>{
                                                    if(value.isConfirmed){
                                                        Update(false)
                                                    }
                                                })
                                            }
                                        })
                                    }
                                    (async()=>{
                                        savedUserList = data.savedUserList
                                        const varScheme = data.varScheme
                                        const userListStatus = data.userListStatus
                                        const alteredVariables = data.alteredVariables
                                        var timeInterval = await (new Date).getTime()-AnalyzeVariableStartTime.getTime()
                                        if(savedAnalyzeVariableTime.length<33){
                                            await savedAnalyzeVariableTime.push(Math.ceil(timeInterval/1000))
                                            await saveJSON(savedAnalyzeVariableTime, "savedAnalyzeVariableTime")
                                        } else {
                                            await savedAnalyzeVariableTime.shift()
                                            await savedAnalyzeVariableTime.push(Math.ceil(timeInterval/1000))
                                            await saveJSON(savedAnalyzeVariableTime, "savedAnalyzeVariableTime")
                                        }
                                        if(savedAnimeEntries.length>0){
                                            savedUserList = await savedUserList || {}
                                            await saveJSON(savedUserList,"savedUserList")
                                            await analyzeAnime(updateID, savedAnimeEntries, varScheme, userListStatus, alteredVariables, username, true)
                                        } else {
                                            await updateAllAnimeList(updateID, username, varScheme, userListStatus, alteredVariables, savedUserList)
                                        }
                                    })();
                                }
                            }
                        },
                        error: function(xhr) {
                            var err = xhr?.responseJSON?.errors?.[0]?.message || xhr
                            try {
                                if(!window.navigator.onLine){
                                    throw "Unable to connect to the Internet!"
                                } else if(err==='Not Found.'){
                                    (async()=>{
                                        for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
                                        dataStatusSpinnerHomeEl.hide()
                                        dataStatusEl
                                            .empty()
                                            .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                                    })();
                                    requestIsRunning = false
                                    Swal.fire({
                                        heightAuto: false,
                                        text: `Username '${username}' was not found in Anilist. Do you want to create another Anilist account?`,
                                        showConfirmButton: true,
                                        confirmButtonText: "Yes, Signup",
                                        showDenyButton: true,
                                        denyButtonText: "No, Change it Back",
                                        confirmButtonColor: '#000',
                                        denyButtonColor: '#e27d81',
                                        icon: "question",
                                        reverseButtons: true
                                    }).then(async(value)=>{
                                        if(value.isConfirmed){
                                            await window.open('https://anilist.co/signup', '_blank');
                                            if(!requestIsRunning){
                                                const { value: xusername} = await Swal.fire({
                                                    heightAuto: false,
                                                    text: "Done signing-up your new account with Anilist? Update with your new username or Return to the old username.",
                                                    input: 'text',
                                                    inputLabel: 'Enter your Anilist Username:',
                                                    inputValue: username,
                                                    customClass: {
                                                        icon: 'no-border'
                                                    },
                                                    allowOutsideClick: false,
                                                    allowEscapeKey: false,
                                                    showConfirmButton: true,
                                                    confirmButtonText: "Update",
                                                    confirmButtonColor: '#000',
                                                    showDenyButton: true,
                                                    denyButtonColor: '#e27d81',
                                                    denyButtonText: "Change it Back",
                                                    reverseButtons: true,
                                                    inputValidator: async(value) => {
                                                        return await new Promise(async(resolve) => {
                                                            var UsernameValidationEl = await $("#UsernameValidation")
                                                            if(savedTheme==="darkMode"){
                                                                $(".swal2-validation-message").addClass('darkMode')
                                                            }
                                                            if(!value) {
                                                                resolve("You need to write Something...")
                                                            } else {
                                                                $.ajax({
                                                                    type: 'POST',
                                                                    url: 'https://graphql.anilist.co',
                                                                    headers: {
                                                                        'Content-Type': 'application/json',
                                                                        'Accept': 'application/json',
                                                                        'Cache-Control': 'max-age=31536000, immutable'
                                                                    },
                                                                    dataType: 'json',
                                                                    data: JSON.stringify({
                                                                        query: `{User(name:"${value}"){name}}`
                                                                    }),
                                                                    beforeSend: () => {
                                                                        $(".swal2-validation-message")
                                                                            .addClass("no-before")
                                                                            .css({display:"flex"})
                                                                            .html(
                                                                                `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                                                                    <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                                                                    <div>Checking Username...</div>
                                                                                </div>`
                                                                            )
                                                                    },
                                                                    success: (data) => {
                                                                        (async()=>{
                                                                            initStartTime = await undefined
                                                                            await saveJSON(initStartTime,"initStartTime")
                                                                            UsernameValidationEl.fadeOut(1000,()=>{
                                                                                UsernameValidationEl.remove()
                                                                                $(".swal2-validation-message")
                                                                                    .addClass("no-before").removeClass("no-before")
                                                                                    .addClass("success-before")
                                                                                    .html("Username Found")
                                                                                setTimeout(()=>{
                                                                                    // Reset Custom Validation
                                                                                    filterAlgoValidationEl.html("").hide()
                                                                                    resolve()
                                                                                },1000)
                                                                            })
                                                                        })();
                                                                    },
                                                                    error: (xhr) =>{
                                                                        if(!window.navigator.onLine){
                                                                            if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                                                                (async()=>{
                                                                                    initStartTime = await new Date()
                                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                                })();
                                                                            }
                                                                            UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                                                            resolve("Unable to connect to the Internet")
                                                                        } else if(xhr?.responseJSON?.errors?.[0]?.message==='Not Found.'){
                                                                            (async()=>{
                                                                                initStartTime = await undefined
                                                                                await saveJSON(initStartTime,"initStartTime")
                                                                                UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                                                                resolve("Username not Found, Please Try Again...")
                                                                            })();
                                                                        } else {
                                                                            if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                                                                (async()=>{
                                                                                    initStartTime = await new Date()
                                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                                })();
                                                                            }
                                                                            UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                                                            resolve(`An Error Occured, Please Try Again in ${msToTime(Math.max(60000-(new Date()-initStartTime),1000))}`)
                                                                        }
                                                                    }
                                                                })
                                                            }
                                                        })
                                                    }
                                                })
                                                if(xusername){
                                                    await usernameEl.val(xusername)
                                                    Update(false)
                                                } else {
                                                    usernameEl.val(savedUsername)
                                                }
                                            }
                                        } else if(value.isDenied){
                                            usernameEl.val(savedUsername)
                                        }
                                    })
                                } else {
                                    for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                                    for(let i=60; i>=0; i--){
                                        var timeout = setTimeout(()=>{
                                            dataStatusSpinnerHomeEl.show()
                                            if(i<1){
                                                dataStatusEl
                                                    .empty()
                                                    .append(`<span style="white-space:nowrap;">Rate Limit, Please Wait a Moment...`)
                                            } else {
                                                dataStatusEl
                                                    .empty()
                                                    .append(`<span style="white-space:nowrap;">Rate Limit, Continuing in ${msToTime(i*1000)}`)
                                            }
                                        },(60-i)*1000)
                                        updateStateText.push(timeout)
                                    }
                                    setTimeout(()=>{
                                        var analyzeVariableTime = Math.ceil(Math.max(analyzeVariableTime-Math.ceil(((new Date).getTime()-AnalyzeVariableStartTime.getTime())/1000),1))
                                        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                                        for(let i=analyzeVariableTime; i>=0; i--){
                                            var timeout = setTimeout(()=>{
                                                dataStatusSpinnerHomeEl.show()
                                                if(i<1){
                                                    dataStatusEl
                                                        .empty()
                                                        .append(`<span style="white-space:nowrap;">Analyzing your List... Please Wait a Moment...`)
                                                } else {
                                                    dataStatusEl
                                                        .empty()
                                                        .append(`<span style="white-space:nowrap;">Analyzing your List...⠀</span><span style="white-space:nowrap;">Estimated Time: ${msToTime(i*1000)}</span>`)
                                                }
                                            },(analyzeVariableTime-i)*1000)
                                            updateStateText.push(timeout)
                                        }
                                        return recallAV(chunk)
                                    },60000)
                                }
                            } catch(ex) {
                                requestIsRunning = false;
                                (async()=>{
                                    for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
                                    dataStatusSpinnerHomeEl.hide()
                                    dataStatusEl
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                                })();
                                console.error("Error 101: ",ex)
                                Swal.fire({
                                    heightAuto: false,
                                    text: "Error 101: "+ ex || "Oops...Something went wrong! Please try again...",
                                    icon: "error",
                                    confirmButtonColor: "#000"
                                });
                                (async()=>{
                                    await LoadData(savedRecScheme)
                                })();
                                console.log("WebtoApp: Update Error")
                                if(Object.keys(savedRecScheme).length===0){
                                    animeRecommendationListEl.empty()
                                    animeRecommendationListEl.append(`
                                        <tr class="item ${savedTheme}" role="row">
                                            <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                                <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                                No Data
                                            </td>
                                        </tr>
                                    `)
                                }
                            }
                        }
                    })
                }
                recallAV(1) // first chunk
            }
        } else {
            var savedUserListValues = Object.values(savedUserList)
            if(isJson(savedUserList)&&isJson(savedUserListValues[0])&&!jsonIsEmpty(savedUserList)){
                var worker7 = new Worker(`./js-css/worker/analyzeVariable-${version}.js`)
                worker7.postMessage({savedUserList: savedUserList, savedAnimeFranchises: savedAnimeFranchises, notAnUpdate: notAnUpdate, savedIncluded: savedIncluded, savedExcluded: savedExcluded})
                worker7.onmessage = (message) => {
                    worker7.terminate()
                    const data = message.data
                    const varScheme = data.varScheme
                    const userListStatus = data.userListStatus
                    const alteredVariables = data.alteredVariables
                    analyzeAnime(updateID, savedAnimeEntries, varScheme, userListStatus, alteredVariables, username, false, notAnUpdate, filterAlgo, doHideUnwatchedSeq)
                }
                worker7.onerror = async (message) => {
                    return
                }
            } else {
                for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
                dataStatusSpinnerHomeEl.hide()
                dataStatusEl
                    .empty()
                    .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                requestIsRunning = false
                filterAlgoValidationEl.hide()
            }
        }
    }

    async function updateAllAnimeList(updateID, username, varScheme, userListStatus, alteredVariables, savedUserList){
        var tempLastSavedUpdateTime = lastSavedUpdateTime
        var maxAnimePerPage = 50
        var animeEntries = []
        async function recalluAAL(page){
            // Allow Single Instance of Update
            if(updateIDs.length>1&&updateID!==updateIDs.at(-1)){
                updateIDs = [updateIDs.at(-1)] // one line
                return
            }
            $.ajax({
                type: 'POST',
                url: 'https://graphql.anilist.co',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'Cache-Control': 'max-age=31536000, immutable'
                },
                dataType: 'json',
                data: JSON.stringify({
                    query: `
                    {
                        Page(page: ${page}, perPage: ${maxAnimePerPage}) {
                            pageInfo{
                                hasNextPage
                            }
                            media(
                                type: ANIME,
                                genre_not_in: ["Hentai"],
                                format_not_in:[MUSIC,MANGA,NOVEL,ONE_SHOT],
                                sort: [UPDATED_AT_DESC]) {
                                id
                                ${page===1?'updatedAt':''}
                                title {
                                    userPreferred
                                }
                                relations {
                                    edges {
                                        relationType
                                        node{
                                            id
                                            popularity
                                        }
                                    }
                                }
                                siteUrl
                                averageScore
                                episodes
                                duration
                                trending
                                popularity
                                favourites
                                format
                                genres
                                status
                                tags {
                                    name
                                    rank
                                    category
                                }
                                studios {
                                    nodes {
                                        name
                                        siteUrl
                                        isAnimationStudio
                                    }
                                }
                                seasonYear
                                season
                                staff {
                                    edges {
                                        node {
                                            name {
                                                userPreferred
                                            }
                                            siteUrl
                                        }
                                        role
                                    }
                                }
                            }
                        }
                    }
                    `
                }),
                beforeSend: ()=> {
                    for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                    dataStatusEl
                        .empty()
                        .append(`<span style="white-space:nowrap;">Getting Anime from Anilist:⠀</span><span style="white-space:nowrap;"><progress style="vertical-align:revert;" value="${page}" max="${lastAnilistPage>page?lastAnilistPage:page+1}"></progress>⠀${(page/(lastAnilistPage>page?lastAnilistPage:page+1)*100).toFixed(2)}%</span>`);
                    if(dataStatusSpinnerHomeEl.css("display")!=="none") {
                        dataStatusSpinnerHomeEl.hide()
                    }
                },
                success: (result)=>{
                    var tempAnimeEntries = result.data.Page.media
                    var hasNextPage = result.data.Page.hasNextPage || tempAnimeEntries.length>0
                    animeEntries = animeEntries.concat(tempAnimeEntries)
                    if(tempAnimeEntries.length>0){
                        if(tempAnimeEntries[0]?.updatedAt){
                            if(tempAnimeEntries[0].updatedAt>tempLastSavedUpdateTime){
                                tempLastSavedUpdateTime = tempAnimeEntries[0].updatedAt
                            }
                        }
                    }
                    if(hasNextPage){
                        return recalluAAL(++page)
                    } else {
                        dataStatusEl
                            .empty()
                            .append(`<span style="white-space:nowrap;">Getting Anime from Anilist:⠀</span><span style="white-space:nowrap;"><progress style="vertical-align:revert;" value="100" max="100"></progress>⠀100%</span>`);
                        (async()=>{
                            savedAnimeEntries = await animeEntries || []
                            await saveJSON(savedAnimeEntries,"savedAnimeEntries")
                            lastSavedUpdateTime = await tempLastSavedUpdateTime || 0
                            await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                            lastAnilistPage = await page || 284
                            await saveJSON(lastAnilistPage, "lastAnilistPage")
                            if(savedUserList){
                                savedUserList = await savedUserList || {}
                                await saveJSON(savedUserList,"savedUserList")
                            }
                            analyzeAnime(updateID, animeEntries, varScheme, userListStatus, alteredVariables, username, false)
                        })();
                    }
                },
                error: function(xhr) {
                    var err = xhr
                    try {
                        if(!window.navigator.onLine){
                            throw "Unable to connect to the Internet!"
                        }
                        err = xhr?.responseText?.errors?.[0]?.message || xhr
                        console.error(err)
                        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                        for(let i=60; i>=0; i--){
                            var timeout = setTimeout(()=>{
                                dataStatusSpinnerHomeEl.hide()
                                if(i<1){
                                    dataStatusEl
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Rate Limit, Please Wait a Moment:⠀</span><span style="white-space:nowrap;"><progress style="vertical-align:revert;" value="${page}" max="${lastAnilistPage>page?lastAnilistPage:page+1}"></progress>⠀${(page/(lastAnilistPage>page?lastAnilistPage:page+1)*100).toFixed(2)}%</span>`)
                                } else {
                                    dataStatusEl
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Rate Limit, Continuing in ${msToTime(i*1000)}:⠀</span><span style="white-space:nowrap;"><progress style="vertical-align:revert;" value="${page}" max="${lastAnilistPage>page?lastAnilistPage:page+1}"></progress>⠀${(page/(lastAnilistPage>page?lastAnilistPage:page+1)*100).toFixed(2)}%</span>`)
                                }
                            },(60-i)*1000)
                            updateStateText.push(timeout)
                        }
                        setTimeout(()=>{
                            return recalluAAL(page)
                        },60000)
                    } catch(ex) {
                        requestIsRunning = false
                        console.error("Error 102: ",ex)
                        Swal.fire({
                            heightAuto: false,
                            text: "Error 102: "+ ex || "Oops...Something went wrong! Please try again...",
                            icon: "error",
                            confirmButtonColor: "#000"
                        });
                        (async()=>{
                            await LoadData(savedRecScheme)
                        })();
                        (async()=>{
                            for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
                            dataStatusSpinnerHomeEl.hide()
                            dataStatusEl
                                .empty()
                                .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                        })();
                        console.log("WebtoApp: Update Error")
                        if(Object.keys(savedRecScheme).length===0){
                            animeRecommendationListEl.empty()
                            animeRecommendationListEl.append(`
                                <tr class="item ${savedTheme}" role="row">
                                    <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                        <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                        No Data
                                    </td>
                                </tr>
                            `)
                        }
                    }
                }
            })
        }
        recalluAAL(1) // First Page
    }

    async function updateAnimeList(updateID, username, varScheme, userListStatus, alteredVariables){
        var tempLastSavedUpdateTime = lastSavedUpdateTime
        if(lastSavedUpdateTime!==0&&savedAnimeEntries.length>0&&!isDeepUpdate){
            var maxAnimePerPage = 50
            var updatedAnimeEntries = []
            async function recalluAL(page){
                // Allow Single Instance of Update
                if(updateIDs.length>1&&updateID!==updateIDs.at(-1)){
                    updateIDs = updateIDs.filter((id)=>id!==updateID) // one line
                    return
                }
                $.ajax({
                    type: 'POST',
                    url: 'https://graphql.anilist.co',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Cache-Control': 'max-age=31536000, immutable'
                    },
                    dataType: 'json',
                    data: JSON.stringify({
                        query: `
                        {
                            Page(page: ${page}, perPage: ${maxAnimePerPage}) {
                                pageInfo{
                                    hasNextPage
                                }
                                media(
                                    type: ANIME,
                                    genre_not_in: ["Hentai"],
                                    format_not_in:[MUSIC,MANGA,NOVEL,ONE_SHOT],
                                    sort: [UPDATED_AT_DESC]) {
                                    id
                                    updatedAt
                                    title {
                                        userPreferred
                                    }
                                    relations {
                                        edges {
                                            relationType
                                            node{
                                                id
                                                popularity
                                            }
                                        }
                                    }
                                    siteUrl
                                    averageScore
                                    episodes
                                    duration
                                    trending
                                    popularity
                                    favourites
                                    format
                                    genres
                                    status
                                    tags {
                                        name
                                        rank
                                        category
                                    }
                                    studios {
                                        nodes {
                                            name
                                            siteUrl
                                            isAnimationStudio
                                        }
                                    }
                                    seasonYear
                                    season
                                    staff {
                                        edges {
                                            node {
                                                name {
                                                    userPreferred
                                                }
                                                siteUrl
                                            }
                                            role
                                        }
                                    }
                                }
                            }
                        }
                        `
                    }),
                    beforeSend: ()=> {
                        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                        dataStatusEl
                            .empty()
                            .append(`<span style="white-space:nowrap;">Updating Anime from Anilist:⠀</span><span style="white-space:nowrap;"><progress value="${updatedAnimeEntries.length}" max="${savedAnimeEntries.length}"></progress>⠀${(updatedAnimeEntries.length/savedAnimeEntries.length*100).toFixed(2)}%</span>`);
                        if(dataStatusSpinnerHomeEl.css("display")!=="none") {
                            dataStatusSpinnerHomeEl.hide()
                        }
                    },
                    success: (result)=>{
                        var tempUpdatedAnimeEntries = result.data.Page.media
                        var hasNextPage = result.data.Page.hasNextPage || tempUpdatedAnimeEntries.length>0
                        for(let i=0;i<tempUpdatedAnimeEntries.length;i++){
                            if(tempUpdatedAnimeEntries[i].updatedAt>lastSavedUpdateTime){
                                updatedAnimeEntries.push(tempUpdatedAnimeEntries[i].id)
                            }
                        }
                        if(tempUpdatedAnimeEntries.length>0){
                            if(tempUpdatedAnimeEntries[0]?.updatedAt>tempLastSavedUpdateTime){
                                tempLastSavedUpdateTime = tempUpdatedAnimeEntries[0].updatedAt || 0
                            }
                        }
                        if(hasNextPage&&tempUpdatedAnimeEntries.at(-1).updatedAt>lastSavedUpdateTime){
                            return recalluAL(++page)
                        } else {
                            var worker3 = new Worker(`./js-css/worker/updateAnime-${version}.js`)
                            worker3.postMessage({
                                updatedAnimeEntries: updatedAnimeEntries,
                                savedAnimeEntries: savedAnimeEntries
                            })
                            worker3.onmessage = (message) => {
                                worker3.terminate()
                                dataStatusEl
                                    .empty()
                                    .append(`<span style="white-space:nowrap;">Updating Anime from Anilist:⠀</span><span style="white-space:nowrap;"><progress value="100" max="100"></progress>⠀100%</span>`)
                                const data = message.data
                                animeEntries = data.animeEntries;
                                (async()=>{
                                    savedAnimeEntries = await animeEntries || []
                                    await saveJSON(savedAnimeEntries,"savedAnimeEntries")
                                    lastSavedUpdateTime = tempLastSavedUpdateTime || 0
                                    await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                                    analyzeAnime(updateID, animeEntries, varScheme, userListStatus, alteredVariables, username, false)
                                })();
                            }
                            worker3.onerror = async (message) => {
                                return
                            }
                        }
                    },
                    error: function(xhr) {
                        var err = xhr
                        try {
                            if(!window.navigator.onLine){
                                throw "Unable to connect to the Internet!"
                            }
                            err = xhr?.responseText?.errors?.[0]?.message || xhr
                            console.error(err)
                            for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                            for(let i=60; i>=0; i--){
                                var timeout = setTimeout(()=>{
                                    dataStatusSpinnerHomeEl.hide()
                                    if(i<1){
                                        dataStatusEl
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Rate Limit, Please Wait a Moment:⠀</span><span style="white-space:nowrap;"><progress value="${updatedAnimeEntries.length}" max="${savedAnimeEntries.length}"></progress>⠀${(updatedAnimeEntries.length/savedAnimeEntries.length*100).toFixed(2)}%</span>`)
                                    } else {
                                        dataStatusEl
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Rate Limit, Continuing in ${msToTime(i*1000)}:⠀</span><span style="white-space:nowrap;"><progress value="${updatedAnimeEntries.length}" max="${savedAnimeEntries.length}"></progress>⠀${(updatedAnimeEntries.length/savedAnimeEntries.length*100).toFixed(2)}%</span>`)
                                    }
                                },(60-i)*1000)
                                updateStateText.push(timeout)
                            }
                            setTimeout(()=>{
                                return recalluAL(page)
                            },60000)
                        } catch(ex) {
                            requestIsRunning = false
                            console.error("Error 106: ",ex)
                            Swal.fire({
                                heightAuto: false,
                                text: "Error 106: "+ ex || "Oops...Something went wrong! Please try again...",
                                icon: "error",
                                confirmButtonColor: "#000"
                            });
                            (async()=>{
                                await LoadData(savedRecScheme)
                            })();
                            (async()=>{
                                for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
                                dataStatusSpinnerHomeEl.hide()
                                dataStatusEl
                                    .empty()
                                    .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                            })();
                            console.log("WebtoApp: Update Error")
                            if(Object.keys(savedRecScheme).length===0){
                                animeRecommendationListEl.empty()
                                animeRecommendationListEl.append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="11">
                                            <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                            No Data
                                        </td>
                                    </tr>
                                `)
                            }
                        }
                    }
                })
            }
            recalluAL(1) // First Page
        } else {
            updateAllAnimeList(updateID, username, varScheme, userListStatus, alteredVariables)
        }
    }

    async function analyzeAnime(updateID, animeEntries, varScheme, userListStatus, alteredVariables, username, alertUser=false, notAnUpdate, filterAlgo, doHideUnwatchedSeq){
        return await new Promise(async(resolve)=>{
            var UpdateAnalyzeAnimeStartTime = await new Date()
            var updateAnalyzeAnimeTime = await Math.ceil(arrayMean(savedUpdateAnalyzeAnimeTime))
            if(doHideUnwatchedSeq){
                hideUnwatchedSequels = await doHideUnwatchedSeq
            }
            if(notAnUpdate){
                await filterAlgoValidationEl
                    .removeClass("success-before")
                    .addClass("no-before")
                    .css({display:"flex"})
                    .html(
                        `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                            <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                            <div>Updating Recommendations List...</div>
                        </div>`
                    )
            }
            for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
            await dataStatusSpinnerHomeEl.show()
            for(let i=updateAnalyzeAnimeTime; i>=0; i--){
                var timeout = await setTimeout(async()=>{
                    if(i<1){
                        await dataStatusSpinnerHomeEl.show()
                        await dataStatusEl
                            .empty()
                            .append(`<span style="white-space:nowrap;">Updating Recommendations List, Please Wait a Moment...`)
                    } else {
                        await dataStatusEl
                            .empty()
                            .append(`<span style="white-space:nowrap;">Updating Recommendations List,⠀</span><span style="white-space:nowrap;">Estimated Time: ${msToTime(i*1000)}</span>`)
                    }
                },(updateAnalyzeAnimeTime-i)*1000)
                await updateStateText.push(timeout)
            }
            // Normal Update
            if(animeEntries.length===0) {
                animeEntries = await savedAnimeEntries || []
            }
            // Reset if Username Changed || isDeepUpdate
            if(username!==savedUsername||isDeepUpdate||versionUpdate){
                savedRecScheme = await {}
            // Normal Update
            }
            var worker4 = new Worker(`./js-css/worker/analyzeAnime-${version}.js`)
            worker4.postMessage({
                animeEntries: animeEntries,
                savedRecScheme: savedRecScheme,
                userListStatus: userListStatus,
                varScheme: varScheme,
                allFilterInfo: allFilterInfo,
                alteredVariables: alteredVariables,
                hideUnwatchedSequels: hideUnwatchedSequels
            })
            worker4.onmessage = async(message) => {
                worker4.terminate()
                const data = message.data
                if(!notAnUpdate||versionUpdate){
                    // Save New Filter Options
                    allFilterInfo = await data.allFilterInfo || {}
                    await saveJSON(allFilterInfo,"allFilterInfo")
                    // Save New anime Franchises
                    if(!alertUser){
                        savedAnimeFranchises = await data.animeFranchises || []
                        saveJSON(savedAnimeFranchises,"savedAnimeFranchises")
                    }
                }
                // Save Filtered Algorithm Contents
                if(notAnUpdate&&filterAlgo){
                    savedFilterAlgo = await filterAlgo || []
                    await saveJSON(savedFilterAlgo,"savedFilterAlgo")
                }
                // Save Table Filters
                var filterInputs = $("#filters .flexdatalist-multiple > .value").children(".text")
                var filters = []
                var filterName
                for(let i=0; i<filterInputs.length; i++){
                    filterName = filterInputs[i].textContent
                    filters.push(filterName)
                }
                savedFilters = await filters || []
                await saveJSON(savedFilters, "savedFilters")
                // Save Username
                savedUsername = await username || ""
                await saveJSON(savedUsername,"savedUsername")
                // Save new Recommendation List
                savedRecScheme = await data.savedRecScheme || {}
                await saveJSON(savedRecScheme, "savedRecScheme")
                if(versionUpdate){
                    versionUpdate = await false
                    await saveJSON(versionUpdate,"versionUpdate")
                }
                if(Object.keys(savedRecScheme).length>1){
                    updateBtnEl.show()
                    updateIntervalBtnEl.show()
                }
                if(typeof doHideUnwatchedSeq==="boolean"){
                    hideUnwatchedSequels = await doHideUnwatchedSeq
                    await saveJSON(hideUnwatchedSequels,"hideUnwatchedSequels")
                }
                var worker5 = new Worker(`./js-css/worker/updateOptions-${version}.js`)
                worker5.postMessage({
                    allFilterInfo: allFilterInfo
                })
                worker5.onmessage = async(message) => {
                    worker5.terminate()
                    const data = message.data
                    var filtersHasFocus = await false
                    if(!notAnUpdate||versionUpdate){
                        // Save and Reload Filters
                        savedFilterOptionsJson = await data.savedFilterOptionsJson || []
                        await saveJSON(savedFilterOptionsJson,"savedFilterOptionsJson")
                        // Check input Focus before updating
                        if( $("#flex0").is(":focus")
                            ||$("#flex1").is(":focus")
                            ||$("#flex2").is(":focus")
                            ||warnAnimeContainerEl.css("display")!=="none"
                            ||filterAlgoContainerEl.css("display")!=="none"
                        ){
                            filtersHasFocus = await true
                        }
                        // This Remove Current Filters in DOM so Check First
                        for(let i=0;i<checkFiltersFocus.length;i++) clearInterval(checkFiltersFocus[i])
                        var updateFiltersValid = setInterval(async()=>{
                            if( !$("#flex0").is(":focus")
                                &&!$("#flex1").is(":focus")
                                &&!$("#flex2").is(":focus")
                                &&warnAnimeContainerEl.css("display")==="none"
                                &&filterAlgoContainerEl.css("display")==="none"
                            ){
                                await clearInterval(updateFiltersValid)
                                // Get Current Value
                                var currentInputValue = await $("#filters .flexdatalist-multiple-value > .flexdatalist-alias").val()
                                checkFiltersFocus = await []
                                // Update
                                await $(".flexdatalist").flexdatalist({
                                    data: savedFilterOptionsJson
                                })
                                // Reload Saved Table Filters
                                var filters
                                await new Promise(async(resolve)=>{
                                    filters = await $("#filters .flexdatalist-multiple").children("li.value")
                                    for(let i=0; i<filters.length; i++) {
                                        var filterName = await filters.eq(i).children(".text")[0]?.innerText
                                        if(filterName.toLowerCase()==="hidden"){
                                            await filters.eq(i).children(".fdl-remove").trigger("click")
                                            await $("#filters .flexdatalist-alias").blur()
                                        }
                                    }
                                    resolve()
                                }).then(async()=>{
                                    var filterInput
                                    for(let i=0; i<savedFilters.length; i++) {
                                        filterInput = await $("#filters .flexdatalist-multiple-value > .flexdatalist-alias")
                                        await filterInput.val(savedFilters[i])
                                        var e = await $.Event("keyup",{keyCode:13})
                                        await filterInput.trigger(e)
                                        await filterInput.val("")
                                    }
                                    if(typeof currentInputValue==="string"){
                                        await $("#filters .flexdatalist-multiple-value > .flexdatalist-alias").val(currentInputValue)
                                    }
                                    var flex0El = await $("ul.flex0")
                                    await flex0El.animate({scrollTop: Number.MAX_SAFE_INTEGER},1)
                                    await flex0El[0]?.scroll(0, flex0El.outerHeight())
                                    return
                                })
                                // Reload Saved Algorithm Filters
                                if(filterAlgoContainerEl.css("display")!=="none"){
                                    await filterAlgoContainerEl.css({visibility:"hidden"}).show()
                                }
                                await new Promise(async(resolve)=>{
                                    var filterInfo = await $("#filterAlgoModal .flexdatalist-multiple").children("li.value")
                                    for(let i=0; i<filterInfo.length; i++) {
                                        await filterInfo.eq(i).children(".fdl-remove").trigger("click")
                                        await $("#filterAlgoModal .flexdatalist-alias").blur()
                                    }
                                    resolve()
                                }).then(async()=>{
                                    var filterAlgoInput
                                    for(let i=0; i<savedFilterAlgo.length; i++) {
                                        filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                        await filterAlgoInput.val(savedFilterAlgo[i])
                                        var e = await $.Event("keyup",{keyCode:13})
                                        await filterAlgoInput.trigger(e)
                                        await filterAlgoInput.val("")
                                    }
                                    await filterAlgoContainerEl.css({visibility:"visible"}).hide()
                                    var flex2El = await $("ul.flex2")
                                    await flex2El.animate({scrollTop: -Number.MAX_SAFE_INTEGER},1)
                                    await flex2El[0]?.scroll(0, -Number.MAX_SAFE_INTEGER)
                                    return
                                })
                                // Reload Warn Anime Contents
                                if(warnAnimeContainerEl.css("display")!=="none"){
                                    await warnAnimeContainerEl.css({visibility:"hidden"}).show()
                                }
                                await new Promise(async(resolve)=>{
                                    var warnInfo = await $("#warnAnimeModal .flexdatalist-multiple").children("li.value")
                                    for(let i=0; i<warnInfo.length; i++) {
                                        await warnInfo.eq(i).children(".fdl-remove").trigger("click")
                                        await $("#warnAnimeModal .flexdatalist-alias").blur()
                                    }
                                    resolve()
                                }).then(async()=>{
                                    var warnAnimeInput
                                    for(let i=0; i<savedWarnAnime.length; i++) {
                                        warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                        await warnAnimeInput.val(savedWarnAnime[i])
                                        var e = await $.Event("keyup",{keyCode:13})
                                        await warnAnimeInput.trigger(e)
                                        await warnAnimeInput.val("")
                                    }
                                    await warnAnimeContainerEl.css({visibility:"visible"}).hide()
                                    var flex1El = await $("ul.flex1")
                                    await flex1El.animate({scrollTop: -Number.MAX_SAFE_INTEGER},1)
                                    await flex1El[0]?.scroll(0, -Number.MAX_SAFE_INTEGER)
                                    return
                                })
                                // Double Check
                                for(let i=0;i<checkFiltersFocus.length;i++) clearInterval(checkFiltersFocus[i])
                            }
                        },250)
                        checkFiltersFocus.push(updateFiltersValid)
                    }
                    // Lastly Update Update Time
                    var timeInterval = (new Date).getTime()-UpdateAnalyzeAnimeStartTime.getTime()
                    if(savedUpdateAnalyzeAnimeTime.length<33){
                        await savedUpdateAnalyzeAnimeTime.push(Math.ceil(timeInterval/1000))
                        await saveJSON(savedUpdateAnalyzeAnimeTime, "savedUpdateAnalyzeAnimeTime")
                    } else {
                        await savedUpdateAnalyzeAnimeTime.shift()
                        await savedUpdateAnalyzeAnimeTime.push(Math.ceil(timeInterval/1000))
                        await saveJSON(savedUpdateAnalyzeAnimeTime, "savedUpdateAnalyzeAnimeTime")
                    }
                    // Reload New Recommendation Data
                    await LoadData(savedRecScheme)
                    if(notAnUpdate){
                        await new Promise(async(resolve)=>{
                            var filterInfo = await $("#filterAlgoModal .flexdatalist-multiple").children("li.value")
                            for(let i=0; i<filterInfo.length; i++) {
                                await filterInfo.eq(i).children(".fdl-remove").trigger("click")
                                await $("#filterAlgoModal .flexdatalist-alias").blur()
                            }
                            resolve()
                        }).then(async()=>{
                            var filterAlgoInput
                            for(let i=0; i<savedFilterAlgo.length; i++) {
                                filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                await filterAlgoInput.val(savedFilterAlgo[i])
                                var e = await $.Event("keyup",{keyCode:13})
                                await filterAlgoInput.trigger(e)
                                await filterAlgoInput.val("")
                            }
                        })
                        filterAlgoValidationEl
                            .addClass("no-before").removeClass("no-before")
                            .addClass("success-before")
                            .html("Filters have been applied")
                        setTimeout(()=>{
                            filterAlgoValidationEl.fadeOut(1000)
                        },1000)
                        for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
                        dataStatusSpinnerHomeEl.hide()
                        dataStatusEl
                            .empty()
                            .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                    } else if(alertUser){
                        console.log("WebtoApp: List is Updated")
                        if(!swal.isVisible()
                            &&!usernameEl.is(":focus")
                            &&!filtersHasFocus
                        ){
                            Swal.fire({
                                heightAuto: false,
                                text: "List has been updated!",
                                icon: "success",
                                confirmButtonColor: "#000"
                            })
                        }
                        // Continue Extra Updates
                        updateAnimeList(updateID, username, varScheme, userListStatus, alteredVariables)
                    } else {
                        if(willAutoUpdate){
                            (async()=>{
                                updateIntervalStartDate = await new Date()
                                await saveJSON(updateIntervalStartDate,"updateIntervalStartDate")
                                willAutoUpdate = false
                            })();
                        }
                        if(isDeepUpdate){
                            (async()=>{
                                isDeepUpdate = false
                                var timeInterval = (new Date).getTime()-deepUpdateStartTime.getTime()
                                if(savedDeepUpdateTime.length<33){
                                    await savedDeepUpdateTime.push(Math.ceil(timeInterval/1000))
                                    await saveJSON(savedDeepUpdateTime,"savedDeepUpdateTime")
                                } else {
                                    await savedDeepUpdateTime.shift()
                                    await savedDeepUpdateTime.push(Math.ceil(timeInterval/1000))
                                    await saveJSON(savedDeepUpdateTime,"savedDeepUpdateTime")
                                }
                            })();
                        }
                        for(let i=0;i<updateStateText.length;i++) await clearTimeout(updateStateText[i])
                        dataStatusSpinnerHomeEl.hide()
                        dataStatusEl
                            .empty()
                            .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                    }
                    // Check Auto Export After Update
                    if(exportIntervalIsActive){
                        await exportIntervalBtnEl.css({background: "white",color:"black"})
                        exportIntervalStartDate = await exportIntervalStartDate || new Date()
                        await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                        if(await ((new Date).getTime()-(exportIntervalStartDate.getTime())>3600000)){// 1hr
                            dataStatusSpinnerHomeEl.show()
                            dataStatusEl
                                .empty()
                                .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                            await backUpData()
                        }
                    }
                    if(!alertUser){
                        requestIsRunning = false
                        resolve()
                    }
                }
                worker5.onerror = async (message) => {
                    return
                }
            }
            worker4.onerror = async (message) => {
                requestIsRunning = false
                dataStatusEl
                    .empty()
                    .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                resolve()
            }
        })
    }

    async function LoadData(savedRecScheme){
        if(!isLoading) isLoading = true
        return await new Promise(async(resolve) => {
            var recList = Object.values(savedRecScheme)
            if((recList.length>0)) {
                var filterInputs = $("#filters .flexdatalist-multiple > .value").children(".text")
                var filters = []
                var includes = []
                var excludes = kidsAnimeIsHidden? ["tag: kids"] : []
                var filterName
                for(let i=0; i<filterInputs.length; i++){
                    filterName = filterInputs[i].textContent.trim().toLowerCase()
                    filters.push(filterName)
                    if(filterName.charAt(0)==="!") {
                        filterName = filterName.slice(1)
                        filterName = typeof filterName==="string"? filterName.split(":") : []
                        if(filterName.length>1){
                            filterName = [filterName.shift(),filterName.join()]
                            var type = filterName[0]
                            var cinfo = filterName[1].trim().toLowerCase()
                            if(cinfo.charAt(0)==="!"){
                                cinfo = cinfo.slice(1)
                                excludes.push(type+":"+cinfo)
                            } else {
                                excludes.push(type+":"+cinfo)
                            }
                        } else if(filterName.length===1){
                            excludes.push(filterName[0])
                        }
                    }
                    else includes.push(filterName)
                }
                hiddenUnhiddenBtnEl.text("Unhidden")
                for(let i=0; i<includes.length; i++){
                    if(equalsNCS(includes[i],"hidden")){
                        hiddenUnhiddenBtnEl.text("Hidden")
                        break;
                    }
                }
                savedFilters = await filters || []
                await saveJSON(savedFilters, "savedFilters")
                var savedWarnR = []
                var savedWarnY = []
                for(let i=0; i<savedWarnAnime.length; i++){
                    var warnName = savedWarnAnime[i].trim().toLowerCase()
                    if(warnName.charAt(0)==="!") {
                        warnName = warnName.slice(1)
                        warnName = typeof warnName==="string"? warnName.split(":") : []
                        if(warnName.length>1){
                            warnName = [warnName.shift(),warnName.join()]
                            var type = warnName[0]
                            var cinfo = warnName[1].trim().toLowerCase()
                            if(cinfo.charAt(0)==="!"){
                                cinfo = cinfo.slice(1)
                                savedWarnR.push(type+": "+cinfo)
                            } else {
                                savedWarnR.push(type+": "+cinfo)
                            }
                        } else if(warnName.length===1){
                            savedWarnR.push(warnName)
                        }
                    }
                    else savedWarnY.push(warnName)
                }
                var worker6 = new Worker(`./js-css/worker/loadData-${version}.js`)
                worker6.postMessage({
                    recList: recList,
                    savedHiddenAnimeIDs: savedHiddenAnimeIDs,
                    includes: includes,
                    excludes: excludes,
                    savedWarnR: savedWarnR,
                    savedWarnY: savedWarnY,
                    savedTheme: savedTheme
                })
                worker6.onmessage = async (message) => {
                    worker6.terminate()
                    const data = message.data
                    const animeData = data.animeData
                    await animeRecommendationListEl.empty()
                    await animeRecommendationListEl.css({
                        "display":"none"
                    }).append(animeData)
                    await animeTableEl.trigger("update")
                    // await animeTableEl.trigger("pagerUpdate")
                    await animeRecommendationListEl.css({
                        "display":""
                    })
                    // idk why savedUnhiddenTable Page sets to (page - 1) in SecondTolast and Last
                    await animeTableEl.trigger("pageSet",(savedTableStatus==="Unhidden"? savedUnhiddenTablePage:savedHiddenTablePage))
                    // Rename Pager Options Text
                    pageNumberOptionsEl.find("option:selected").text(`${pageNumberOptionsEl.val()} of ${animeTableEl[0]?.config?.pager?.totalPages||1}`).prop('selected', true)
                    isLoading = false
                    resolve()
                }
                worker6.onerror = () => {
                    isLoading = false
                    resolve()
                }
            }
        })
    }

    async function backUpData(){
        return await new Promise(async(resolve)=>{
            if(exportWorker){
                exportWorker.terminate()
            }
            exportWorker = new Worker(`./js-css/worker/export-${version}.js`)
            exportWorker.postMessage({
                savedUsername: savedUsername,
                savedWarnAnime: savedWarnAnime,
                savedFilterAlgo: savedFilterAlgo,
                savedHiddenAnimeIDs: savedHiddenAnimeIDs,
                savedRecScheme: savedRecScheme,
                savedAnimeEntries: savedAnimeEntries,
                savedUserList: savedUserList,
                savedAnimeFranchises: savedAnimeFranchises,
                savedAnalyzeVariableTime: savedAnalyzeVariableTime,
                savedUpdateAnalyzeAnimeTime: savedUpdateAnalyzeAnimeTime,
                savedDeepUpdateTime: savedDeepUpdateTime,
                lastAnilistPage: lastAnilistPage,
                lastSavedUpdateTime: lastSavedUpdateTime,
                backUpVersion: await retrieveJSON("backUpVersion"),
            })
            exportWorker.onmessage = async(message) => {
                exportWorker.terminate()
                // Android
                await exportJsonData(message.data.backupStr, `Kanshi.${savedUsername?.trim()?.toLowerCase()||"Backup"}.json`)
                // Android
                exportIntervalStartDate = await new Date()
                await saveJSON(exportIntervalStartDate, "exportIntervalStartDate")
                if(!requestIsRunning){
                    dataStatusSpinnerHomeEl.hide()
                    dataStatusEl
                        .empty()
                        .append(`<span style="white-space:nowrap;">${lastSavedUpdateTime?'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: '+new Date(lastSavedUpdateTime*1000).toLocaleString():'<b style="color: #6eb9ff;font-size: 1rem;font-weight: bolder;">⟳</b> Latest Anilist Update: N/A'}</span>`)
                }
                if(!swal.isVisible()
                 &&!usernameEl.is(":focus")
                 &&!$("#flex0").is(":focus")
                 &&!$("#flex1").is(":focus")
                 &&!$("#flex2").is(":focus")
                 &&warnAnimeContainerEl.css("display")==="none"
                 &&filterAlgoContainerEl.css("display")==="none"){
                    await Swal.fire({
                        heightAuto: false,
                        text: "Data has been exported!",
                        icon: "success",
                        confirmButtonColor: "#000"
                    })
                }
                resolve()
            }
        })
    }

    async function initUsernameData(){
        const { value: username } = await Swal.fire({
            heightAuto: false,
            title: "Starting Up",
            input: 'text',
            inputLabel: 'Enter your Anilist Username:',
            iconHtml: '<img src="./public/logo.png">',
            customClass: {
                icon: 'no-border'
            },
            allowOutsideClick: false,
            allowEscapeKey: false,
            showConfirmButton: true,
            confirmButtonText: "Search",
            confirmButtonColor: '#000',
            denyButtonColor: '#e27d81',
            reverseButtons: true,
            footer: `
                <a target="_blank" rel="noopener noreferrer" href="https://anilist.co/signup">Create an Anilist Account</a>
                <a href="javascript:;" onclick="$('#importBtn').click()">Import Backup</a>
            `,
            inputValidator: async(value) => {
                return await new Promise(async(resolve) => {
                    if(savedTheme==="darkMode"){
                        $(".swal2-validation-message").addClass('darkMode')
                    }
                    if(!value) {
                        resolve("You need to write Something...")
                    } else {
                        var UsernameValidationEl = await $("#UsernameValidation")
                        $.ajax({
                            type: 'POST',
                            url: 'https://graphql.anilist.co',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json',
                                'Cache-Control': 'max-age=31536000, immutable'
                            },
                            dataType: 'json',
                            data: JSON.stringify({
                                query: `{User(name:"${value}"){name}}`
                            }),
                            beforeSend: () => {
                                $(".swal2-validation-message")
                                    .addClass("no-before")
                                    .css({display:"flex"})
                                    .html(
                                        `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                            <div><div style="margin-right:0.5ch;" class="dataStatusSpinner spinner ${savedTheme}"></div></div>
                                            <div>Checking Username...</div>
                                        </div>`
                                    )
                            },
                            success: (data) => {
                                (async()=>{
                                    initStartTime = await undefined
                                    await saveJSON(initStartTime,"initStartTime")
                                    UsernameValidationEl.fadeOut(1000,()=>{
                                        UsernameValidationEl.remove()
                                        $(".swal2-validation-message")
                                            .addClass("no-before").removeClass("no-before")
                                            .addClass("success-before")
                                            .html("User has been Found")
                                        setTimeout(()=>{
                                            // Reset Custom Validation
                                            filterAlgoValidationEl.html("").hide()
                                            resolve()
                                        },1000)
                                    })
                                })();
                            },
                            error: (xhr) =>{
                                if(!window.navigator.onLine){
                                    if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                        (async()=>{
                                            initStartTime = await new Date()
                                            await saveJSON(initStartTime,"initStartTime")
                                        })();
                                    }
                                    UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                    resolve("Unable to connect to the Internet")
                                } else if(xhr?.responseJSON?.errors?.[0]?.message==='Not Found.'){
                                    (async()=>{
                                        initStartTime = await undefined
                                        await saveJSON(initStartTime,"initStartTime")
                                        UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                        resolve("Username not Found, Please Try Again...")
                                    })();
                                } else {
                                    if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                        (async()=>{
                                            initStartTime = await new Date()
                                            await saveJSON(initStartTime,"initStartTime")
                                        })();
                                    }
                                    UsernameValidationEl.fadeOut(1000,()=>$(this).remove())
                                    resolve(`An Error Occured, Please Try Again in ${msToTime(Math.max(60000-(new Date()-initStartTime),1000))}`)
                                }
                            }
                        })
                    }
                })
            }
        })
        filterAlgoValidationEl.html("").hide()
        if(username){
            await usernameEl.val(username)
            Update(false)
        }
    }

    function malanilistImportExport(){
        Swal.fire({
            heightAuto: false,
            title: "Transfer MAL to Anilist",
            icon: "info",
            text: `In order to transfer your MAL list to Anilist, you first need to export your list from MAL (e.g, xml file or extract the zip file first) and import the exported MAL file to your Anilist account, click a button below to continue.`,
            showConfirmButton: true,
            denyButtonText: "Export MAL",
            denyButtonColor: '#2E51A2',
            showDenyButton: true,
            confirmButtonText: "Import to Anilist",
            confirmButtonColor: "#000",
            showCancelButton: true,
            cancelButtonText: "Cancel",
            cancelButtonColor: "#e27d81",
            allowOutsideClick: false,
            allowEscapeKey: false,
            reverseButtons: true,
            footer: `<a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=eWooqnJ87-0">Watch this video for tutorial</a>
                        <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=rfHTiT_7a4U">Auto sync MAL and Anilist</a>`
        }).then(async(value) => {
            if(value.isConfirmed){
                await window.open('https://anilist.co/settings/import', '_blank');
                malanilistImportExport()
            } else if(value.isDenied) {
                await window.open('https://myanimelist.net/panel.php?go=export', '_blank');
                malanilistImportExport()
            }
        })
    }

    async function loadTheme(newTheme,prevTheme){
        return await new Promise(async(resolve)=>{
            // Remove default
            if(newTheme!=="dakMode"&&!prevTheme){
                await $(`
                    html
                    body,
                    .Home,
                    .searchData,
                    button,
                    .overlay,
                    #username,
                    #dataStatusHolder,
                    .flexdatalist-multiple,
                    .flexdatalist-alias,
                    .flexdatalist-results,
                    .flexdatalist-multiple li.value,
                    #animeRecommendationList td,
                    #anime-table,
                    #anime-table thead,
                    #anime-table tbody,
                    #anime-table th,
                    #anime-table tr,
                    #anime-table td,
                    .table-responsive,
                    #animeRecommendationList a,
                    .userInput,
                    .nav,
                    #pager,
                    #pageNumberOptions,
                    .swal2-popup,
                    .swal2-popup-custom,
                    .swal2-validation-message,
                    .swal2-footer a,
                    .swal2-confirm,
                    .swal2-confirm-custom,
                    .spinner
                `).removeClass("darkMode")
            }
            // Remove Previous
            if(prevTheme){
                await $(`
                    html
                    body,
                    .Home,
                    .searchData,
                    button,
                    .overlay,
                    #username,
                    #dataStatusHolder,
                    .flexdatalist-multiple,
                    .flexdatalist-alias,
                    .flexdatalist-results,
                    .flexdatalist-multiple li.value,
                    #animeRecommendationList td,
                    #anime-table,
                    #anime-table thead,
                    #anime-table tbody,
                    #anime-table th,
                    #anime-table tr,
                    #anime-table td,
                    .table-responsive,
                    #animeRecommendationList a,
                    .userInput,
                    .nav,
                    #pager,
                    #pageNumberOptions,
                    .swal2-popup,
                    .swal2-popup-custom,
                    .swal2-validation-message,
                    .swal2-footer a,
                    .swal2-confirm,
                    .swal2-confirm-custom,
                    .spinner
                `).removeClass(prevTheme)
            }
            // Apply New
            await $(`
                html,
                body,
                .Home,
                .searchData,
                button,
                .overlay,
                #username,
                .flexdatalist-multiple,
                .flexdatalist-alias,
                .flexdatalist-results,
                .flexdatalist-multiple li.value,
                #animeRecommendationList td,
                #anime-table,
                #anime-table thead,
                #anime-table tbody,
                #anime-table th,
                #anime-table tr,
                #anime-table td,
                .table-responsive,
                #animeRecommendationList a,
                .userInput,
                .nav,
                #pager,
                #pageNumberOptions,
                .swal2-popup,
                .swal2-popup-custom,
                .swal2-validation-message,
                .swal2-footer a,
                .swal2-confirm,
                .swal2-confirm-custom,
                .spinner
            `).addClass(newTheme)
            resolve()
        })
    }

    // Helper Function
    async function saveJSON(data, name) {
        return new Promise((resolve)=>{
            try {
                var write = db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").openCursor()
                write.onsuccess = (event) => {
                    const cursor = event.target.result;
                    if (cursor) {
                        if(cursor.key===name){
                            cursor.update(data)
                            resolve()
                        }
                        cursor.continue()
                    } else {
                        db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").add(data, name)
                        resolve()
                    }
                }
            } catch(ex) {
                try{
                    console.error(ex)
                    db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").add(data, name)
                    resolve()
                } catch(ex2) {
                    console.error(ex2)
                    resolve()
                }
            }
        })
    }
    async function retrieveJSON(name) {
        return new Promise((resolve)=>{
            try {
                var read = db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").get(name)
                read.onsuccess = (event) => {
                    resolve(read.result)
                }
                read.onerror = (event) => {
                    resolve()
                }
            } catch(ex){
                console.error(ex)
                resolve()
            }
        })
    }
    async function deleteJSON(name) {
        return new Promise((resolve)=>{
            try {
                var read = db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").delete(name)
                read.onsuccess = (event) => {
                    resolve()
                }
                read.onerror = (event) => {
                    resolve()
                }
            } catch(ex) {
                console.error(ex)
                resolve()
            }
        })
    }
    function equalsNCS(str1, str2) {
        var s1 = str1
        var s2 = str2
        if(typeof s1==="number") s1 = s1.toString()
        if(typeof s2==="number") s2 = s2.toString()
        if(typeof s1==="string") s1 = s1.trim().toLowerCase()
        if(typeof s2==="string") s2 = s2.trim().toLowerCase()
        return s1 === s2
    }
    function isJson(j){
        if(j instanceof Array||typeof j==="string") return false
        for(e in j) return true
        return false
    }
    function jsonIsEmpty(obj){
        if(isJson(obj)){
            for(var i in obj) return false
        }
        return true
    }
    function parseJson(obj){
        try{return JSON.parse(obj)}catch(ex){return {}}
    }
    function arraySum(obj) {
        return obj.reduce((a, b) => a + b, 0)
    }
    function arrayMean(obj) {
        return (arraySum(obj) / obj.length) || 0
    }
    function msToTime(duration) {
        var seconds = Math.floor((duration / 1000) % 60),
            minutes = Math.floor((duration / (1000*60)) % 60),
            hours = Math.floor((duration / (1000*60*60)) % 24),
            days = Math.floor((duration / (1000*60*60*24)) % 7),
            weeks = Math.floor((duration / (1000*60*60*24*7)) % 4),
            months = Math.floor((duration / (1000*60*60*24*7*4)) % 12)
            years = Math.floor((duration / (1000*60*60*24*7*4*12)) % 10)
            decades = Math.floor((duration / (1000*60*60*24*7*4*12*10)) % 10)
            century = Math.floor((duration / (1000*60*60*24*7*4*12*10*10)) % 10)
            millenium = Math.floor((duration / (1000*60*60*24*7*4*12*10*10*10)) % 10)
        var time = []
        if(millenium<=0&&century<=0&&decades<=0&&years<=0&&months<=0&&weeks<=0&&days<=0&&hours<=0&&minutes<=0&&seconds<=0) return "0s"
        if(millenium>0) time.push(millenium===1?`${millenium}mil`:`${millenium}mils`)
        if(decades>0) time.push(decades===1?`${decades}de`:`${decades}des`)
        if(years>0) time.push(`${years}y`)
        if(months>0) time.push(months===1?`${months}mo`:`${months}mos`)
        if(weeks>0) time.push(`${weeks}w`)
        if(days>0) time.push(`${days}d`)
        if(hours>0) time.push(`${hours}h`)
        if(minutes>0) time.push(`${minutes}m`)
        if(seconds>0) time.push(`${seconds}s`)
        return time.join(" ")
    }
    // Android
    function exportJsonData(objStr, fileName) {
        JSBridge.exportJSON(objStr, fileName);
    }
    // Android
    function isJsonString(str) {
        try {JSON.parse(str);}
        catch (e) {return false;}
        return true;
    }
    async function parseJsonFile(file) {
        return new Promise((resolve, reject) => {
            const fileReader = new FileReader()
            fileReader.onload = event => resolve(JSON.parse(event.target.result))
            fileReader.onerror = error => reject(error)
            fileReader.readAsText(file)
        })
    }
    </script>
</body>
</html>
