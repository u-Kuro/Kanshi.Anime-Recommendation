<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanshi. - Anime Recommendation</title>
    <link rel="shortcut icon" type="image/x-icon" href="./public/logo.png" />
    <!-- Jquery -->
    <script src="./js-css/jquery-3.6.0.js" defer></script>
    <!-- Swal 2 -->
    <script src="./js-css/swal2/sweetalert2.all.js" defer></script>
    <link rel="stylesheet" href="./js-css/swal2/sweetalert2.css">
    <!-- Table Sort -->
    <link rel="stylesheet" href="./js-css/jquery tablesorter/theme.default.min.css">
    <script type="text/javascript" src="./js-css/jquery tablesorter/jquery.tablesorter.js" defer></script>
    <script type="text/javascript" src="./js-css/jquery tablesorter/jquery.metadata.min.js" defer></script>
    <script type="text/javascript" src="./js-css/jquery tablesorter/jquery.tablesorter.pager.min.js" defer></script>
    <!-- Datalist Search Code -->
    <link rel="stylesheet" href="./js-css/flexdatalist/jquery.flex-datalist.css">
    <script src="./js-css/flexdatalist/jquery.flex-datalist-edited.js" defer></script>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="./js-css/bootstrap-3.3.6.min.css"/>
    <!-- Fontawesome -->
    <link rel="stylesheet" href="./js-css/font-awesome.min.css">
    <script src="./js-css/fontawesome-5.0.js" crossorigin="anonymous" defer></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PPMY92TJCE" defer></script>
    <script defer>
        window.onload = () => {
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-PPMY92TJCE');
        }
    </script>
    <style>
            /* Change For Text Size */
            :root{
                font-size: 0.9rem !important;
            }
            /* Change/Add to Class/Tag of desired division for Padding */
            .Home,
            .overlay{
                padding-inline: clamp(0px, 5vw, 75px) !important;
            }
            /* Default */
            html,
            body {
                height: 100%;
                width: 100%;
                overflow: auto;
            }
            :root{
                font-size: 0.9rem;
                background-color: #fff;
                font-family: sans-serif;
                z-index: 0;
                min-width: 100%;
                min-height: 100%;
                overflow:auto;
            }
            :root>*{
                background-color: #fff;
                min-width: inherit;
                min-height: inherit;
            }
            *,
            ::after,
            ::before{
                margin: 0;
                padding: 0;
                text-indent: 0;
                box-sizing: border-box;
            }
            /* Text */
            .textLogo{
                font-size: clamp(1.6rem, 2vw,1.6rem) !important;
            }
            h1{
                font-size: clamp(1.3rem, 2vw,1.3rem);
            }
            h2{
                font-size: clamp(1.05rem, 2vw,1.05rem);
            }
            h3{
                font-size: clamp(1.05rem, 2vw,1.05rem);
            }
            p,
            label,
            input[type="text"]{
                font-size: clamp(0.95rem, 2vw,0.95rem);
            }
            h4{
                font-size: clamp(1rem, 2vw,1rem);
            }
            h5{
                font-size: clamp(0.9rem, 2vw,0.9rem);
            }
            h6{
                font-size: clamp(0.8rem, 2vw,0.8rem);
            }
            h1,
            h2,
            h3,
            h4,
            h5,
            h6,
            p,
            input,
            textarea,
            .textLogo{
                cursor:default;
                -webkit-hyphens:manual;
                hyphens:manual;
                white-space:pre-wrap;
                word-break:break-word;
                overflow-wrap:break-word;
                transform-origin: left;
            }
            h1,
            h2,
            h3,
            h4,
            h5,
            h6,
            p,
            .textLogo{
                max-width: -moz-fit-content;
                min-width: -moz-fit-content;
                min-width: -webkit-fill-available;
                max-width: fit-content;
                min-width: fit-content;
            }
            /* Forms */
            input,
            textarea{
                outline: 0;
            }
            input[type=text]{
                -ms-user-select: text;
                -webkit-user-select: text;
                user-select: text;
            }
            button,
            button>*{
                cursor: pointer;
            }
            dialog{
                border: 0;
            }
            img{
                max-width: 100%;
            }
            /* Additional */
            body{
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            ::-webkit-scrollbar {
                display: none;
            }
            .example {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            button {
                background-color: black;
                color: white;
            }
            input {
                padding: 0.5em;
            }
            .userInput {
                width: min-content;
                border-color: rgb(118, 118, 118);
                border-width: 2px;
                border-style: inset;
                border-radius: 0px;
                background-color: rgb(255, 255, 255);
            }
            .loader {
                position: fixed;
                left: 0px;
                top: 0px;
                width: 100%;
                height: 100%;
                z-index: 9999;
                background: url('./public/loading.gif')
                    50% 50% no-repeat
                    rgb(0, 0, 0)
            }
            .loader > * {
                justify-content: center;
                min-height: 100%;
                align-items: center;
                display: flex;
                margin-top: 150px;
                color: wheat;
                text-align: center;
            }
            html,body,.home{
                width: 100%;
                min-height: 100%;
                height: 100%;
            }
            label{margin: 0}
            .searchData,.table-responsive{
                margin-block: 15px;
            }
            .flexdatalist-multiple > .value {
                max-width: -moz-fit-content;
                max-width: fit-content;
                cursor: pointer;
            }
            .userInputContainer,.filter-container,.btn-container{
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
                margin-block: 15px;
                gap: 0.5em;
            }
            .userInputContainer>:not(label),.filter-container>:not(label),.btn-container>:not(label){
                flex-grow: 1;
            }
            .flexdatalist-multiple{
                display: flex;
                flex-wrap: wrap-reverse;
                max-height: 120px;
                overflow-y: scroll;
            }
            .flexdatalist-multiple>.flexdatalist-multiple-value{
                flex-grow: 1;
                display: flex !important;
            }
            .flexdatalist-multiple>.flexdatalist-multiple-value>.flexdatalist-alias{
                outline: none;
                flex-grow: 1;
            }
            .tableLoadingContainer{
                display: flex;
                justify-content: center;
                align-items: center;
            }
            .show-hidden-anime-btn{
                text-align: center !important;
                min-width: 85px !important;
            }
            header {
                background: url('./public/header.png');
                text-align: left;
                width: 100%;
                height: 165px;
                background-size: contain;
                position: relative;
                overflow: hidden;
                border-radius: 0 0 50% 50% / 5%;
            }
            header .overlay{
                width: 100%;
                height: 100%;
                padding: 1.75em;
                color: #FFF;
                background-image: linear-gradient( 135deg, #39343c69 10%, #6d00006b 100%);
            }
            header .overlay>*{
                padding-right: 50%;
            }
            button {
                border: none;
                outline: none;
                padding: 10px 20px;
                border-radius: 50px;
                box-shadow: 0 3px 20px 0 #0000003b;
            }
            button:hover{
                cursor: pointer;
            }
            a,
            a:hover,
            a:focus {
                color: #864548;
            }
            #anime-table{
                border: 1px solid #ddd !important;
            }
            #animeRecommendationList{
                content-visibility: auto;
            }
            #animeRecommendationList > tr > *{
                white-space: nowrap;
            }
            #updateIntervalBtn,
            #updateBtn,
            #showAllAnime{
                display: none;
            }
            #hiddenUnhiddenBtn{
                background: black !important;
                color: white !important;
                max-width: -moz-fit-content !important;
                max-width: fit-content !important;
                cursor: pointer;
            }
            #searchBtn:hover,
            #searchBtn:focus{
                color: white;
            }
            .anime-table-headers > th{
                vertical-align: middle !important;
                padding: 1em !important;
            }
            .tablesorter-header-inner{
                margin-right: 0.5em !important;
                min-width: max-content !important;
            }
            .show-all-anime{
                background: black !important;
                color: white !important;
                border-radius: 5%;
                max-width: -moz-fit-content !important;
                max-width: fit-content !important;
            }
            .tablesorter-default{
                margin: 0 !important;
            }
            .hide-anime-column{
                padding-block: 1.5em !important;
                vertical-align: middle !important;
                text-align: center !important;
                -ms-user-select: none !important;
                -webkit-user-select: none !important;
                user-select: none !important;
            }
            .item > td {
                vertical-align: middle !important;
            }
            .anime-score{
                text-align: center !important;
                max-width: 50px !important;
                text-overflow: ellipsis !important;
                overflow: hidden !important;
                cursor: pointer;
                -ms-user-select: none !important;
                -webkit-user-select: none !important;
                user-select: none !important;
            }
            .anime-score > div {
                display: flex;
                gap: 0.5ch;
                max-width: 50px !important;
                text-overflow: ellipsis !important;
                overflow: hidden !important;
            }
            .overlay,
            .searchData,
            .flexdatalist-results{
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .spinner {
                border: 2px solid #f3f3f3;
                border-top: 2px solid #B06D70;
                border-radius: 50%;
                width: 13px;
                min-width: 13px;
                height: 13px;
                min-height: 13px;
                animation: spin 2s linear infinite;
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .data-status-container{
                display: none;
                align-items: center;
                justify-content: center;
            }
            .table-responsive{
                border: 1px solid #dddddd;
                min-height: 556px !important;
                margin-bottom: 100px !important;
            }
            .pager{
                position: fixed;
                bottom: 0;
                width: 100%;
                border-radius: 50% 50% 0 0 / 5%;
                background: rgb(0,0,0,0.925);
                color: white;
                margin: 0;
                z-index: 100;
            }
            .pager-form{
                display: flex;
                justify-content: center;
                align-items: center;
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .pager-form>*{
                flex: 1;
                min-width: -moz-fit-content;
                min-width: -webkit-fill-available;
                min-width: fit-content;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
            }
            .pager-form>*>*{
                flex: 1;
                min-width: -moz-fit-content;
                min-width: -webkit-fill-available;
                min-width: fit-content;
                cursor: pointer;
            }
            .tablesorter-pager {
                padding: 1em;
            }
            td.tablesorter-pager {
                background-color: #e6eeee;
                margin: 0;
            }
            .tablesorter-pager img {
                vertical-align: middle;
                margin-right: 2px;
                cursor: pointer;
            }
            .tablesorter-pager .pagedisplay {
                margin-block: auto;
                text-align: left;
            }
            .tablesorter-pager select {
                margin: 0;
                padding: 0;
            }
            .tablesorter-pager.disabled {
                display: none;
            }
            .tablesorter-pager .disabled {
                opacity: 0.5;
                filter: alpha(opacity=50);
                cursor: default;
            }
            .pagedisplay{
                max-width: -moz-fit-content;
                max-width: fit-content;
            }
            .pagenum{
                height: -webkit-fill-available;
                height: fit-content;
                border: transparent;
                text-align: center;
                outline: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background-color: transparent !important;
            }
            .pagenum>*{
                background-color: black;
                color: white;
            }
            .endPage{
                text-align: left;
            }
            .nav{
                z-index: 100;
                position: fixed;
                width: 100%;
                height: 50px;
                display: flex;
                color: white;
                justify-content: space-between;
                background-color: rgb(0,0,0,0.925);
                padding: 1em;
                align-items: center;
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .nav > div{
                flex: 1;
                display: flex;
            }
            .nav img{
                margin-left: auto;
                max-height: 40px;
                cursor: pointer;
            }
            .nav h1{
                cursor: pointer;
            }
            header{
                margin-top: 50px;
            }
            .menu-container {
                overflow: auto;
                top: 0px;
                right: 0;
                position: fixed;
                z-index: 99;
                height: 100%;
                width: 100%;
                background-color: rgb(0, 0, 0, 0.925);
                color: white;
                display: none;
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .menu-container>div{
                margin-bottom: 63px;
                padding: 1em;
                margin-top: 50px;
                display: flex;
                flex-wrap: wrap;
                gap: 1.5em;
                height: min-content;
            }
            .menu-container>div>button{
                -moz-box-shadow: 0 3px 20px 0 #af6e7138 !important;
                -webkit-box-shadow: 0 3px 20px 0 #af6e7138 !important;
                box-shadow: 0 3px 20px 0 #af6e7138 !important;
            }
            .no-before::before{
                content: none;
            }
            .whitespace-pre-wrap{
                white-space: pre-wrap !important;
            }
            .swal2-container{
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            .swal2-validation-message{
                color: black !important;
            }
            .swal2-validation-message.no-before::before{
                content: none;
            }
            .swal2-validation-message.error-before::before {
                content: "!";
                display: inline-block;
                width: 1.5em;
                min-width: 1.5em;
                height: 1.5em;
                margin: 0 0.625em;
                border-radius: 50%;
                background-color: #f27474;
                color: #fff;
                font-weight: 600;
                line-height: 1.5em;
                text-align: center;
            }
            .swal2-validation-message.success-before::before {
                content: "✓";
                display: inline-block;
                width: 1.5em;
                min-width: 1.5em;
                height: 1.5em;
                margin: 0 0.625em;
                border-radius: 50%;
                background-color: #78f274;
                color: #fff;
                font-weight: 600;
                line-height: 1.5em;
                text-align: center;
            }
            .swal2-actions{
                justify-content: space-evenly !important;
                width: 100% !important;
                gap: 1em !important;
                padding-inline: 1em !important;
            }
            .swal2-actions button{
                min-width: -moz-fit-content !important;
                min-width: -webkit-fill-available !important;
                min-width: fit-content !important;
                flex:1 !important;
            }
            .swal2-footer{
                justify-content: space-evenly !important;
                width: 100% !important;
                flex-wrap: wrap;
                gap: 1.5ch;
            }
            .no-border{
                border: none !important;
            }
            .swal2-footer > *{
                flex: 1 !important;
                min-width: 100% !important;
                text-align: center !important;
            }
            .swal-overlay-custom{
                display: none;
                position: fixed;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                text-align: center;
                font-size: 0;
                overflow-y: auto;
                background-color: rgba(0,0,0,.4);
                z-index: 10000;
                pointer-events: none;
                opacity: 0;
                transition: opacity .3s;
            }
            .swal-overlay--show-modal-custom{
                opacity: 1;
                pointer-events: auto;
            }
            .swal-overlay--show-modal-custom .swal-modal-custom{
                opacity: 1;
                pointer-events: auto;
                box-sizing: border-box;
                -webkit-animation: showSweetAlert .3s;
                animation: showSweetAlert .3s;
                will-change: transform;
            }
            @keyframes swal2-show-custom {
                0% {
                    transform: scale(0.7);
                }
                45% {
                    transform: scale(1.05);
                }
                80% {
                    transform: scale(0.95);
                }
                100% {
                    transform: scale(1);
                }
            }
            @keyframes swal2-hide-custom {
                0% {
                    transform: scale(1);
                    opacity: 1;
                }
                100% {
                    transform: scale(0.5);
                    opacity: 0;
                }
            }
            .swal2-show-custom {
                animation: swal2-show 0.3s;
            }
            .swal2-hide-custom {
                animation: swal2-hide 0.15s forwards;
            }
            .swal2-container-custom.swal2-top-custom, 
            .swal2-container-custom.swal2-center-custom, 
            .swal2-container-custom.swal2-bottom-custom {
                grid-template-columns: auto minmax(0, 1fr) auto;
            }
            .swal2-container-custom.swal2-backdrop-show-custom,
            .swal2-container-custom.swal2-noanimation-custom {
                background: rgba(0, 0, 0, 0.4);
            }
            [class^=swal2] {
                -webkit-tap-highlight-color: transparent;
            }
            .swal2-container-custom {
                display: grid;
                position: fixed;
                z-index: 1060;
                top: 0;
                right: 0;
                bottom: 0;
                left: 0;
                box-sizing: border-box;
                grid-template-areas:
                    "top-start top top-end"
                    "center-start center center-end"
                    "bottom-start bottom-center bottom-end";
                grid-template-rows: minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);
                height: 100%;
                padding: 0.625em;
                overflow-x: hidden;
                transition: background-color 0.1s;
                -webkit-overflow-scrolling: touch;
            }
            .swal2-container-custom.swal2-center-custom > .swal2-popup-custom {
                grid-column: 2;
                grid-row: 2;
                align-self: center;
                justify-self: center;
            }
            .swal2-show-custom {
                animation-duration: 0.3s;
                animation-timing-function: ease;
                animation-delay: 0s;
                animation-iteration-count: 1;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: swal2-show;
            }
            .swal2-show-custom {
                animation: swal2-show 0.3s;
            }
            .swal2-popup-custom {
                display: none;
                position: relative;
                box-sizing: border-box;
                grid-template-columns: minmax(0, 100%);
                width: 32em;
                max-width: 100%;
                padding: 0 0 1.25em;
                border: none;
                border-radius: 5px;
                background: #fff;
                color: #545454;
                font-family: inherit;
                font-size: 1rem;
            }
            .swal2-html-container-custom {
                z-index: 1;
                justify-content: center;
                margin: 1em 1.6em 0.3em;
                padding: 0;
                overflow: auto;
                color: inherit;
                font-size: 1.125em;
                font-weight: normal;
                line-height: normal;
                text-align: center;
                word-wrap: break-word;
                word-break: break-word;
            }
            .swal2-actions-custom {
                display: flex;
                z-index: 1;
                box-sizing: border-box;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
                width: auto;
                margin: 1.25em auto 0;
                padding: 0;
            }
            .swal2-actions-custom {
                justify-content: space-evenly !important;
                width: 100% !important;
                gap: 1em !important;
                padding-inline: 1em !important;
            }
            .swal2-styled-custom.swal2-deny-custom {
                border: 0;
                border-radius: 0.25em;
                background: initial;
                background-color: #dc3741;
                color: #fff;
                font-size: 1em;
            }
            .swal2-styled-custom.swal2-confirm-custom {
                border: 0;
                border-radius: 0.25em;
                background: initial;
                background-color: #7066e0;
                color: #fff;
                font-size: 1em;
            }
            .swal2-styled-custom:not([disabled]) {
                cursor: pointer;
            }
            .swal2-actions-custom button {
                min-width: -mozfit-content !important;
                min-width: -webkit-fill-available !important;
                min-width: fit-content !important;
                flex: 1 !important;
            }
            .swal2-styled-custom {
                margin: 0.3125em;
                padding: 0.625em 1.1em;
                transition: box-shadow 0.1s;
                box-shadow: 0 0 0 3px transparent;
                font-weight: 500;
            }
            .swal2-timer-progress-bar-container-custom {
                position: absolute;
                right: 0;
                bottom: 0;
                left: 0;
                grid-column: auto !important;
                overflow: hidden;
                border-bottom-right-radius: 5px;
                border-bottom-left-radius: 5px;
            }
            button.selected{
                background-color: white !important;
                color: black !important;
            }
            /* Dark Mode */
            html.darkMode,
            body.darkMode{
                background-color: rgb(11,22,34) !important;
                color: rgb(185, 202, 221) !important
            }
            header .overlay.darkMode{
                width: 100%;
                height: 100%;
                padding: 1.75em;
                color: #FFF;
                background-image: linear-gradient( 135deg, #39343c69 10%, #151F2E6b 100%) !important;
            }
            .overlay.darkMode{
                color: rgb(214 233 255) !important;
            }
            #searchBtn.darkMode,
            #hiddenUnhiddenBtn.darkMode,
            .hide-anime-column button.darkMode,
            .menu-container button.darkMode,
            .swal2-confirm.darkMode, .swal2-confirm-custom.darkMode{
                background-color: rgb(40 69 102) !important;
                color: rgb(185, 202, 221) !important;
            }
            .menu-container button.selected.darkMode{
                background-color: black !important;
                color: rgb(185, 202, 221) !important;
            }
            #username.darkMode,
            .flexdatalist-multiple.darkMode,
            .flexdatalist-alias.darkMode,
            .flexdatalist-results.darkMode, 
            #animeRecommendationList td.darkMode{
                background-color: rgb(21,31,46) !important;
                color: rgb(185, 202, 221) !important
            }
            .flexdatalist-results.darkMode,
            .flexdatalist-results.darkMode>li.item{
                border: 1px solid rgb(21,34,50) !important;
            }
            #anime-table thead.darkMode,
            #anime-table tbody.darkMode,
            #anime-table th.darkMode,
            #anime-table tr.darkMode,
            #anime-table td.darkMode,
            .table-responsive.darkMode,
            .userInput.darkMode, 
            .flexdatalist-multiple.darkMode{
                border: 1px solid rgb(21,34,50) !important;
            }
            #anime-table th:not(:first-child).darkMode,
            .flexdatalist-multiple li.value.darkMode{
                background-color: rgb(67,81,97) !important;
                color: rgb(185, 202, 221) !important;
            }
            #animeRecommendationList a.darkMode,
            .swal2-footer a.darkMode{
                color: rgb(110, 185, 255) !important;
            }
            .nav.darkMode, 
            #pager.darkMode,
            .pagenum.darkMode>*,
            .swal2-popup.darkMode,
            .swal2-popup-custom.darkMode{
                background-color: rgb(21,34,50) !important;
                color: rgb(185, 202, 221) !important;
            }
            .swal2-modal.darkMode{
                background-color: rgb(11,22,34) !important;
            }
            .swal2-validation-message.darkMode{
                background-color: transparent !important;
                color: rgb(185, 202, 221) !important;
            }
            .spinner.darkMode{
                border: 2px solid #f3f3f3;
                border-top: 2px solid rgb(110, 185, 255);
                border-radius: 50%;
                width: 13px;
                min-width: 13px;
                height: 13px;
                min-height: 13px;
                animation: spin 2s linear infinite;
            }
            .menu-container>div>button.darkMode{
                -moz-box-shadow: 0 3px 20px 0 #6e89af38 !important;
                -webkit-box-shadow: 0 3px 20px 0 #6e89af38 !important;
                box-shadow: 0 3px 20px 0 #6e89af38 !important;
            }
            .darkMode ::placeholder{
                opacity: 1 !important;
                color: rgb(131,144,160) !important;
            }
            .darkMode :-ms-input-placeholder,
            .darkMode ::-ms-input-placeholder{ 
                color: rgb(131,144,160) !important;
            }
            /* Dark Mode */
            .orange{
                color: rgb(255,152,0);
            }
            .red{
                color: rgb(239,48,81);
            }
            td.animeTitle>i{
                padding: 0.5ch;
            }
            #warnAnimeContainer,
            #filterAlgoContainer{
                -ms-user-select: none;
                -webkit-user-select: none;
                user-select: none;
            }
            #dataStatusContainer{
                margin-inline: 15px;
                justify-content: center;
                align-items: center;
            }
            #dataStatusWrapper{
                flex: 1;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
            }
            #dataStatusSpinner{
                flex: 1;
                display: flex;
                justify-content: end;
            }
            #dataStatus{
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }
            #dataStatus{
                text-align: center;
            }
            #dataStatus>span{
                padding-block: 0.5ch;
            }
            /* Browser */
            ::-webkit-input-placeholder {
                white-space:pre-line !important;  
                position:relative !important;
                top: 0px;
                bottom: 0px;
            }
            ::-moz-placeholder {
                white-space:pre-line !important;  
                position:relative !important;
                top: 0px;
                bottom: 0px;
            }
            :-ms-input-placeholder {
                white-space:pre-line !important;  
                position:relative !important;
                top: 0px;
                bottom: 0px;
            }
            :-moz-placeholder {
                white-space:pre-line !important;  
                position:relative !important;
                top: 0px;
                bottom: 0px;
            }
            /* Browser */
            .flexdatalist-alias{
                height: 41px !important;
            }
            /* Top of Loader */
            .topOfLoader{
                z-index: 10000 !important;
            }
        </style>
</head>
<body>
<nav class="nav">
    <div><h1 id="menuTitle" class="textLogo">Kanshi.</h1></div>
    <div><img id="menuIcon" src="./public/logo.png" alt="menubar"></div>
</nav>
<div class="menu-container">
    <div>
        <button id="updateBtn">Update</button>
        <button id="showAllAnime">Show All</button>
        <input type="file" id="importFile" style="display: none;" accept=".json"/>
        <button id="deepUpdateBtn">Deep Update</button>
        <button id="importBtn">Import</button>
        <button id="exportBtn">Export</button>
        <button id="warnAnimeBtn">Choose Content to Warn</button>
        <button id="filterAlgoBtn">Filter Algorithm Contents</button>
        <button id="themeBtn">Dark Mode</button>
        <button id="hideKidsAnimeBtn">Hide Kids Anime</button>
        <button id="updateIntervalBtn">Update Every Hour</button>
        <button id="exportIntervalBtn">Export Every Hour</button>
        <button id="sign-up">Create Another Account</button>
    </div>
</div>
<header>
    <div class="overlay">
        <h1 class="textLogo">Kanshi.</h1>
        <h3>Anime - Anilist</h3>
        <h3>Recommendations</h3>
    </div>
</header>
<div class="Home">
    <div class="searchData">
        <div class="userInputContainer">
            <input class="userInput" placeholder="Anilist Username" name="username" id="username" type="text">
        </div>
        <div id="filters" class="filter-container">
            <input type="text"
                placeholder="Filter Contents (Include: Content / Exclude: !Content / WScore>=N / etc.)"
                class="flexdatalist"
                data-search-in="info"
                multiple="multiple"
                data-min-length="1"
                data-search-by-word="true"
                data-search-contain="true"
                data-max-shown-results="7"
                name="filter">
        </div>
        <div class="btn-container">
            <button id="searchBtn" class="btn" type="submit">Search</button>
        </div>
        <div id="dataStatusContainer" class="data-status-container">
            <div id="dataStatusWrapper">
                <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner"></div></div>
                <h6 id="dataStatus"></h6>
            </div>
        </div>
    </div>
    <div class="table-responsive">
        <table id="anime-table" class="tablesorter table table-bordered table-striped">
            <thead>
            <tr class="anime-table-headers">
                <th id="hiddenUnhiddenBtn" class="trigger-btn sorter-false show-hidden-anime-btn">Unhidden</th>
                <th>WScore</th>
                <th>Title</th>
                <th>Top Similarities</th>
                <th>Score</th>
                <th>User Status</th>
                <th>Status</th>
                <th>Genres</th>
                <th>Tags</th>
                <th>Format</th>
                <th>Year</th>
                <th>Season</th>
                <th>Studios</th>
                <th>Staff</th>
            </tr>
            </thead>
            <tbody id="animeRecommendationList">
            <tr class="item" role="row">
                <td style="padding: 1.5em !important;" colspan="14">
                    <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                    No Data
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- pager -->
<div id="pager" class="pager">
    <form class="pager-form">
        <span id="first" class="first"><h5>First</h5></span>
        <span id="prev" class="prev"><h5>Prev</h5></span>
        <span id="selectPageNumber">
            <select id="pageNumberOptions" class="custom-select pagenum" title="Select page number"></select>
        </span>
        <span id="next" class="next"><h5>Next</h5></span>
        <span id="last" class="last"><h5>Last</h5></span>
    </form>
</div>

<!-- Modal -->
<div id="myModal" class="modal fade">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-header flex-column">
                <h4 class="modal-title w-100">Are you sure?</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body">
                <p>Do you really want to delete these records? This process cannot be undone.</p>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger">Delete</button>
            </div>
        </div>
    </div>
</div>
<!-- confirmation modal-->
<div id="confirm-modal" class="modal fade" >
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title">Modal title</h4>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete?&hellip;</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger">Confirm</button>
            </div>
        </div>
    </div>
</div>

<div id="warnAnimeContainer" class="swal2-container-custom swal2-center-custom swal2-backdrop-show-custom" style="display: none; overflow-y: auto;">
    <div id="warnAnimeModal" class="swal2-popup-custom swal2-modal-custom swal2-hide-custom" style="display: grid;">
        <div class="swal2-html-container-custom" style="display: block;">
            Add Custom Contents to be Warned
        </div>
        <div class="swal2-html-container-custom" style="display: block;">
            <div class="filter-container-custom">
                <input type="text"
                    placeholder="Yellow-Warning (Content) or Red-Warning (!Content)"
                    class="flexdatalistWarnAnime"
                    data-search-in="info"
                    multiple="multiple"
                    data-min-length="1"
                    data-search-by-word="true"
                    data-search-contain="true"
                    data-max-shown-results="7"
                    name="filter">
            </div>
        </div>
        <div class="swal2-actions-custom" style="display: flex;">
            <button id="cancelWarnAnime" type="button" class="swal2-deny-custom swal2-styled-custom swal2-default-outline-custom" style="display: inline-block; background-color: rgb(226, 125, 129);">Later</button>
            <button id="submitWarnAnime" type="button" class="swal2-confirm-custom swal2-styled-custom swal2-default-outline-custom" style="display: inline-block; background-color: rgb(0, 0, 0);">Submit</button>
        </div>
        <div class="swal2-timer-progress-bar-container-custom"></div>
    </div>
</div>

<div id="filterAlgoContainer" class="swal2-container-custom swal2-center-custom swal2-backdrop-show-custom" style="overflow-y: auto;">
    <div id="filterAlgoModal" class="swal2-popup-custom swal2-modal-custom" style="display: grid;"> <!--removed class swal2-hide-custom -->
        <div class="swal2-html-container-custom" style="display: block;">
            Filter Algorithm Contents
        </div>
        <div class="swal2-html-container-custom" style="display: block;">
            <div class="filter-container-custom">
                <input type="text"
                    placeholder="Filter Algorithm Contents (Include: Content / Exclude: !Content / WScore>=N / etc.)"
                    class="flexdatalistFilterAlgo"
                    data-search-in="info"
                    multiple="multiple"
                    data-min-length="1"
                    data-search-by-word="true"
                    data-search-contain="true"
                    data-max-shown-results="7"
                    name="filter">
            </div>
        </div>
        <div class="swal2-validation-message" id="filterAlgo-validation" style="display: none;">
            <div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner"></div></div>
                <div>Checking Username...</div>
            </div>
        </div>
        <div class="swal2-actions-custom" style="display: flex;">
            <button id="cancelFilterAlgo" type="button" class="swal2-deny-custom swal2-styled-custom swal2-default-outline-custom" style="display: inline-block; background-color: rgb(226, 125, 129);">Later</button>
            <button id="submitFilterAlgo" type="button" class="swal2-confirm-custom swal2-styled-custom swal2-default-outline-custom" style="display: inline-block; background-color: rgb(0, 0, 0);">Submit</button>
        </div>
        <div class="swal2-timer-progress-bar-container-custom"></div>
    </div>
</div>

<div class="loader">
    <span><h1 id="loaderText">Loading...</h1></span>
</div>

<script defer>
    // Initialize Global Variables
        // Production Version
    const version = "1.9",
          backUpVersion = 1.1
        // IndexDB
    var request, db,
        // Saved Data
    savedUsername, savedRecScheme, savedUserList, savedAnimeEntries, savedHiddenAnimeIDs, 
    savedFilters, savedWarnAnime, savedFilterAlgo, savedBackUpVersion,
    savedHiddenTablePage, savedUnhiddenTablePage, savedTableStatus, savedYscroll, savedSort, 
    savedTheme, kidsAnimeIsHidden,
    savedFilterOptionsJson, allFilterInfo, 
    exportIntervalIsActive, updateIntervalIsActive, exportIntervalStartDate, updateIntervalStartDate,
    exportIntervalTimeout = [], updateIntervalTimeout = [],
        // Load Saved API Request State
    updateIDs = [], requestIntervalMS = 0, 
    savedLastRequestDate, 
    savedAnalyzeVariableTime, savedUpdateAnalyzeAnimeTime, savedDeepUpdateTime,
    deepUpdateStartTime, updateStartTime,
    isRunning = false, requestIsRunning = false, isLoading = false,
    isDeepUpdate = false, willAutoUpdate = false, updateStateText = []
        // Browser
    ,notificationGranted = false
        // Browser
    
    // Create IndexDB
    window.onload = async () => {
        // Init Reload
        return await new Promise((resolve)=>{
            // Load IndexedDB
            request = window.indexedDB.open("MyIndexDB", 1)
            request.onerror = (event) => {
                Swal.fire({
                    heightAuto: false,
                    title: "Oops, heh",
                    text: "Your browser is not supported, to continue please update or install a recent version.",
                    imageUrl: './public/anya-smile.gif',
                    imageAlt: 'Custom image',
                    confirmButtonColor: "#000",
                    background: "#0b1622",
                    color: "#b9cadd",
                    confirmButtonColor: "#284566",
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    customClass: {
                        container: 'topOfLoader',
                    }
                }).then(()=>{
                    window.location.href = window.location.href
                })
                console.error("MyIndexDB is Not Allowed!")
            }
            request.onsuccess = (event) => {
                db = event.target.result
                resolve()
            }
            request.onupgradeneeded = (event) => {
                db = event.target.result;
                db.createObjectStore("MyObjectStore")
            }
        }).then(async()=>{
            // Load Event Listeners
            return await new Promise((resolve)=>{
                $("#username").on('keypress',async (e) =>{
                    savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                    if(e.which===13) {
                        $("#searchBtn").click()        
                    }
                })
                $("#searchBtn").on('click', async ()=>{
                    savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime") || 320
                    savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                    if(Object.keys(savedRecScheme).length>0) {
                        savedUsername = await retrieveJSON("savedUsername")
                        var newUsername = $("#username").val()
                        if(equalsNCS(newUsername,savedUsername)){
                            await $("#animeRecommendationList").empty()
                            await $("#animeRecommendationList").append(`
                                <tr class="item ${savedTheme}" role="row">
                                    <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                        <div style="display:flex; align-items:center;">
                                            <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                            <div>Loading...</div>
                                        </div>
                                    </td>
                                </tr>
                            `)
                            LoadData(savedRecScheme)
                        } else {
                            Swal.fire({
                                heightAuto: false,
                                text: `Username was changed from ${savedUsername} to ${newUsername}. This will remove your current recommendation list, do you still want to continue?`,
                                showConfirmButton: true,
                                confirmButtonText: "Yes",
                                showDenyButton: true,
                                denyButtonText: "No",
                                confirmButtonColor: '#000',
                                denyButtonColor: '#e27d81',
                                icon: "question",
                                reverseButtons: true
                            }).then(async(value)=>{
                                if(value.isConfirmed){
                                    if(requestIsRunning){
                                        Swal.fire({
                                            heightAuto: false,
                                            text: `List is already updating! Do you want to restart the update?`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Yes",
                                            showDenyButton: true,
                                            denyButtonText: "No",
                                            confirmButtonColor: '#000',
                                            denyButtonColor: '#e27d81',
                                            icon: "question",
                                            reverseButtons: true
                                        }).then(async(value)=>{
                                            if(value.isConfirmed){
                                                // Reset User List
                                                savedUserList = {}
                                                await saveJSON(savedUserList,"savedUserList")
                                                Update(false)
                                            }
                                        })
                                    } else {
                                        // Reset User List
                                        savedUserList = {}
                                        await saveJSON(savedUserList,"savedUserList")
                                        Update(false)
                                    }
                                } else {
                                    $("#username").focus()
                                }
                            })
                        }
                    } else {
                        if(requestIsRunning){
                            Swal.fire({
                                heightAuto: false,
                                text: `List is already updating! Do you want to restart the update?
                                The estimated time to finish is ${msToTime((savedDeepUpdateTime+60)*1000)}`,
                                showConfirmButton: true,
                                confirmButtonText: "Yes",
                                showDenyButton: true,
                                denyButtonText: "No",
                                confirmButtonColor: '#000',
                                denyButtonColor: '#e27d81',
                                icon: "question",
                                reverseButtons: true
                            }).then(async(value)=>{
                                if(value.isConfirmed){
                                    deepUpdateStartTime = new Date()
                                    isDeepUpdate = true
                                    Update(false)
                                }
                            })
                        } else {
                            Swal.fire({
                                heightAuto: false,
                                text: `Do you want to continue and update your recommendations list?
                                The estimated time to finish is ${msToTime(savedDeepUpdateTime*1000)}`,
                                showConfirmButton: true,
                                confirmButtonText: "Yes",
                                showDenyButton: true,
                                denyButtonText: "No",
                                confirmButtonColor: '#000',
                                denyButtonColor: '#e27d81',
                                icon: "question",
                                reverseButtons: true
                            })
                            .then((value) => {
                                if(value.isConfirmed){
                                    deepUpdateStartTime = new Date()
                                    isDeepUpdate = true
                                    Update(false)
                                }
                            })
                        }
                    }
                })
                $("#menuIcon, #menuTitle").on("click",()=>{
                    var menu = $(".menu-container")
                    if(menu.css("display")=="none"){
                        menu.fadeIn(250)
                    } else {
                        menu.fadeOut(250)
                    }
                })
                $("#updateBtn").on('click', async ()=>{
                    var savedUpdateTime = (await retrieveJSON("savedAnalyzeVariableTime") || 90) + (await retrieveJSON("savedUpdateAnalyzeAnimeTime") || 3)
                    if(requestIsRunning){
                        Swal.fire({
                            heightAuto: false,
                            text: `List is already updating! Do you want to restart the update?
                            The estimated time to finish is ${msToTime((savedUpdateTime+60)*1000)}`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                var newUsername = await $("#username").val()
                                savedUsername = await retrieveJSON("savedUsername") || ""
                                if(newUsername!==savedUsername){
                                    Swal.fire({
                                        heightAuto: false,
                                        text: `Username was changed from ${savedUsername} to ${newUsername}. This will remove your current recommendation list, do you still want to continue?`,
                                        showConfirmButton: true,
                                        confirmButtonText: "Yes",
                                        showDenyButton: true,
                                        denyButtonText: "No",
                                        confirmButtonColor: '#000',
                                        denyButtonColor: '#e27d81',
                                        icon: "question",
                                        reverseButtons: true
                                    }).then(async(value)=>{
                                        $(".menu-container").fadeOut(250)
                                        if(value.isConfirmed){
                                            // Reset User List
                                            savedUserList = {}
                                            await saveJSON(savedUserList,"savedUserList")
                                            Update(false)
                                        } else {
                                            $("#username").focus()
                                        }
                                    })
                                } else {
                                    Update(false)
                                    $(".menu-container").fadeOut(250)
                                }
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to continue and update your recommendations list?
                            This may take ${msToTime(savedUpdateTime*1000)} to finish.`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                var newUsername = await $("#username").val()
                                savedUsername = await retrieveJSON("savedUsername") || ""
                                if(newUsername!==savedUsername){
                                    Swal.fire({
                                        heightAuto: false,
                                        text: `Username was changed from ${savedUsername} to ${newUsername}. This will remove your current recommendation list, do you still want to continue?`,
                                        showConfirmButton: true,
                                        confirmButtonText: "Yes",
                                        showDenyButton: true,
                                        denyButtonText: "No",
                                        confirmButtonColor: '#000',
                                        denyButtonColor: '#e27d81',
                                        icon: "question",
                                        reverseButtons: true
                                    }).then(async(value)=>{
                                        $(".menu-container").fadeOut(250)
                                        if(value.isConfirmed){
                                            // Reset User List
                                            savedUserList = {}
                                            await saveJSON(savedUserList,"savedUserList")
                                            Update(false)
                                        } else {
                                            $("#username").focus()
                                        }
                                    })
                                } else {
                                    Update(false)
                                    $(".menu-container").fadeOut(250)
                                }
                            }
                        })
                    }
                })
                $("#deepUpdateBtn").on("click", async ()=>{
                    savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime") || 320
                    if(requestIsRunning){
                        Swal.fire({
                            heightAuto: false,
                            text: `List is already updating! Do you want to restart the update?
                            This may take ${msToTime(savedDeepUpdateTime*1000)} to finish.`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                deepUpdateStartTime = new Date()
                                isDeepUpdate = true
                                await Update(false)
                                $(".menu-container").fadeOut(250)
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to continue and update all data in your recommendations list?
                            This may take ${msToTime(savedDeepUpdateTime*1000)} to finish.`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                deepUpdateStartTime = new Date()
                                isDeepUpdate = true
                                await Update(false)
                                $(".menu-container").fadeOut(250)
                            }
                        })
                    }
                })
                $("#hiddenUnhiddenBtn").on('click', async()=>{
                    if(!isRunning){
                        isRunning = true
                        savedUsername = await retrieveJSON("savedUsername") || ""
                        savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                        if(savedUsername.length>0&&Object.keys(savedRecScheme).length>0){
                            var state = await $("#hiddenUnhiddenBtn").text()
                            if(!equalsNCS($("#username").val(),savedUsername)){
                                await $("#username").val(savedUsername)
                            }
                            if(state==="Unhidden"){
                                if($("#filters .flexdatalist-multiple-value > .flexdatalist-alias").length){
                                    var filterInput = await $("#filters .flexdatalist-multiple-value > .flexdatalist-alias")
                                    await filterInput.val("hidden")
                                    var e = await $.Event("keyup",{keyCode:13})
                                    await filterInput.trigger(e)
                                    await filterInput.val("")
                                }
                                await $("#hiddenUnhiddenBtn").text("Hidden")
                                await saveJSON("Hidden","savedTableStatus")
                                await $("#animeRecommendationList").empty()
                                await $("#animeRecommendationList").append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                            <div style="display:flex; align-items:center;">
                                                <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                                <div>Loading...</div>
                                            </div>
                                        </td>
                                    </tr>
                                `)
                                await LoadData(savedRecScheme)
                                setTimeout(()=>{
                                    let setPageInfo = setInterval(()=>{
                                        if(typeof $('#anime-table')[0].config!=="undefined"){
                                            clearInterval(setPageInfo)
                                            $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                                        }
                                    },1)
                                },0)
                                isRunning = false
                            } else {
                                if($("#filters .flexdatalist-multiple-value").length){
                                    var filters = await $("#filters .flexdatalist-multiple").children("li.value")
                                    for(let i=0; i<filters.length; i++) {
                                        var filterName = await filters.eq(i).children(".text")[0].innerText
                                        if(filterName.toLowerCase()==="hidden"){
                                            await filters.eq(i).children(".fdl-remove").trigger("click")
                                            await $("#filters .flexdatalist-alias").blur()
                                        }
                                    }
                                }
                                await $("#hiddenUnhiddenBtn").text("Unhidden")
                                await saveJSON("Unhidden","savedTableStatus")
                                await $("#animeRecommendationList").empty()
                                await $("#animeRecommendationList").append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                            <div style="display:flex; align-items:center;">
                                                <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                                <div>Loading...</div>
                                            </div>
                                        </td>
                                    </tr>
                                `)
                                await LoadData(savedRecScheme)
                                setTimeout(()=>{
                                    let setPageInfo = setInterval(()=>{
                                        if(typeof $('#anime-table')[0].config!=="undefined"){
                                            clearInterval(setPageInfo)
                                            $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                                        }
                                    },1)
                                },0)
                                isRunning = false
                            }
                        } else isRunning = false
                    }
                })
                $("#showAllAnime").on('click', ()=>{
                    Swal.fire({
                        heightAuto: false,
                        text: "Do you want to show all your hidden anime? This will remove all hidden Anime in the hidden's list!",
                        showConfirmButton: true,
                        confirmButtonText: "Yes",
                        showDenyButton: true,
                        denyButtonText: "No",
                        confirmButtonColor: '#000',
                        denyButtonColor: '#e27d81',
                        icon: "question",
                        reverseButtons: true
                    })
                    .then(async(value) => {
                        if(value.isConfirmed){
                            savedUsername = await retrieveJSON("savedUsername") || ""
                            if(!equalsNCS($("#username").val(),savedUsername)){
                                $("#username").val(savedUsername)
                            }
                            await saveJSON({}, "savedHiddenAnimeIDs")
                            if(await $("#filters .flexdatalist-multiple-value").length){
                                var filters = await $("#filters .flexdatalist-multiple").children("li.value")
                                for(let i=0; i<filters.length; i++) {
                                    var filterName = await filters.eq(i).children(".text")[0].innerText
                                    if(filterName.toLowerCase()==="hidden"){
                                        await filters.eq(i).children(".fdl-remove").trigger("click")
                                        await $("#filters .flexdatalist-alias").blur()
                                    }
                                }
                            }
                            if($("#hiddenUnhiddenBtn").text()==="Hidden"){
                                await $("#animeRecommendationList").empty()
                                await $("#animeRecommendationList").append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                            <div style="display:flex; align-items:center;">
                                                <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                                <div>Loading...</div>
                                            </div>
                                        </td>
                                    </tr>
                                `)
                            }
                            savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                            await LoadData(savedRecScheme)
                            $("#hiddenUnhiddenBtn").text("Unhidden")
                            savedUnhiddenTablePage = await retrieveJSON("savedUnhiddenTablePage") || 0
                            await $('#anime-table').trigger("pageSet",savedUnhiddenTablePage)
                            setTimeout(()=>{
                                let setPageInfo = setInterval(()=>{
                                    if(typeof $('#anime-table')[0].config!=="undefined"){
                                        clearInterval(setPageInfo)
                                        $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                                    }
                                },1)
                            },0)
                            await saveJSON("Unhidden","savedTableStatus")
                            $("#showAllAnime").hide()
                            $(".menu-container").fadeOut(250)
                            Swal.fire({
                                heightAuto: false,
                                text: "All hidden anime has now been successfully transferred to your List!",
                                icon: "success",
                                confirmButtonColor: "#000"
                            })
                        }
                    })
                })
                $("#importBtn").on("click", ()=>{
                    $("#importFile").click()
                })
                $("#importFile").on("change",(event)=>{
                    if($("#importFile")[0].value != ""){
                        const importedFile = $("#importFile")[0].files[0]
                        const reader = new FileReader()
                        reader.onload = async() => {
                            const fullPath = $("#importFile")[0].value
                            const startIndex = (fullPath.indexOf('\\') >= 0 ? fullPath.lastIndexOf('\\') : fullPath.lastIndexOf('/'));
                            var filename = fullPath.substring(startIndex);
                            if (filename.indexOf('\\') === 0 || filename.indexOf('/') === 0) {
                                filename = filename.substring(1);
                            }
                            if(savedUsername!==undefined&&savedUsername.length){
                                Swal.fire({
                                    heightAuto: false,
                                    text: `File named [${filename}] been detected, do you want to continue the import? This will remove your current data!`,
                                    showConfirmButton: true,
                                    confirmButtonText: "Yes",
                                    showDenyButton: true,
                                    denyButtonText: "No",
                                    confirmButtonColor: '#000',
                                    denyButtonColor: '#e27d81',
                                    icon: "question",
                                    reverseButtons: true
                                })
                                .then(async(value) => {
                                    if(value.isConfirmed){
                                        var fileContent
                                        await new Promise(async(resolve,reject)=>{
                                            await $("#importBtn").css({background: "black", color: "white"})
                                            try{
                                                fileContent = await JSON.parse(reader.result);
                                            } catch(ex) {
                                                $("#importFile")[0].value = null
                                                Swal.fire({
                                                    heightAuto: false,
                                                    text: "Error: Invalid Backup File",
                                                    icon: "error",
                                                    confirmButtonColor: "#000"
                                                })
                                            }
                                            if(fileContent.savedUsername===undefined||fileContent.savedUsername===null) {
                                                $("#importFile")[0].value = null
                                                Swal.fire({
                                                    heightAuto: false,
                                                    text: "Error: Backup file does not Have a Username",
                                                    icon: "error",
                                                    confirmButtonColor: "#000"
                                                })
                                                reject()
                                            } else {
                                                await $(".menu-container").fadeOut(250)
                                                $("#dataStatusContainer").fadeOut(1000)
                                                setTimeout(()=>{
                                                    $("#dataStatusSpinner").show()
                                                    $("#dataStatus")
                                                        .empty()
                                                        .append(`<span style="white-space:nowrap;">Importing data, please wait...`)
                                                    $("#dataStatusContainer").css("display","flex").fadeIn(1000)
                                                },1000)
                                                resolve()
                                            }
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                await saveJSON(importedBackUpVersion, "backUpVersion")
                                            }
                                        }).then(async()=>{
                                            savedUsername = await fileContent.savedUsername || ""
                                            await $("#username").val(savedUsername)
                                            await saveJSON(savedUsername,"savedUsername")
                                            return
                                        }).then(async()=>{
                                            savedHiddenAnimeIDs = await fileContent.savedHiddenAnimeIDs || {}
                                            await saveJSON(savedHiddenAnimeIDs,"savedHiddenAnimeIDs")
                                            if(jsonIsEmpty(savedHiddenAnimeIDs)) {
                                                $("#showAllAnime").hide()
                                            } else {
                                                $("#showAllAnime").show()
                                            }
                                            return
                                        }).then(async()=>{
                                            savedRecScheme = await fileContent.savedRecScheme || {}
                                            await saveJSON(savedRecScheme,"savedRecScheme")
                                        }).then(async()=>{
                                            var importedBackUpVersion = await fileContent.backUpVersion
                                            if(importedBackUpVersion>=backUpVersion){
                                                savedAnimeEntries = await fileContent.savedAnimeEntries || []
                                                await saveJSON(savedAnimeEntries,"savedAnimeEntries")
                                            }
                                        }).then(async()=>{
                                            lastSavedUpdateTime = await fileContent.lastSavedUpdateTime || 0
                                            await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                                        }).then(async()=>{
                                            savedUserList = await fileContent.savedUserList || {}
                                            await saveJSON(savedUserList,"savedUserList")
                                        }).then(async()=>{
                                            savedAnalyzeVariableTime = await fileContent.savedAnalyzeVariableTime || 90
                                            await saveJSON(savedAnalyzeVariableTime,"savedAnalyzeVariableTime")
                                        }).then(async()=>{
                                            savedUpdateAnalyzeAnimeTime = await fileContent.savedUpdateAnalyzeAnimeTime || 3
                                            await saveJSON(savedUpdateAnalyzeAnimeTime,"savedUpdateAnalyzeAnimeTime")
                                        }).then(async()=>{
                                            lastAnilistPage = await fileContent.lastAnilistPage || 284
                                            await saveJSON(lastAnilistPage,"lastAnilistPage")
                                        }).then(async()=>{
                                            savedWarnAnime = await fileContent.savedWarnAnime || [ "ecchi","mahou shoujo","!boys' love","cgi","!ero guro","!female harem",
                                                                                                "full cgi","kids","love triangle","!male harem","!mixed gender harem",
                                                                                                "!nudity","!slavery","!suicide","tokusatsu","!yuri","wuxia","!netorare",
                                                                                                "!rape"
                                                                                                ]
                                            await saveJSON(savedWarnAnime,"savedWarnAnime")
                                            return
                                        }).then(async()=>{
                                            savedFilterAlgo = await fileContent.savedFilterAlgo || []
                                            await saveJSON(savedFilterAlgo,"savedFilterAlgo")
                                            return
                                        }).then(async()=>{
                                            await $("#username").val(savedUsername)
                                            return
                                        }).then(async()=>{
                                            await new Promise(async(resolve)=>{
                                                await $("#warnAnimeContainer").css({visibility:"hidden"}).show()
                                                let reloadSavedData = await setInterval(async () => {
                                                    if(await $("#warnAnimeContainer .flexdatalist-multiple-value > .flexdatalist-alias").length){
                                                        await clearInterval(reloadSavedData)
                                                        await new Promise(async(resolve)=>{
                                                            // Remove Current Filters
                                                            var warnInfo = await $("#warnAnimeModal .flexdatalist-multiple").children("li.value")
                                                            for(let i=0; i<warnInfo.length; i++) {
                                                                var infoName = await warnInfo.eq(i).children(".text")[0].innerText
                                                                await warnInfo.eq(i).children(".fdl-remove").trigger("click")
                                                                await $("#warnAnimeModal .flexdatalist-alias").blur()
                                                            }
                                                            resolve()
                                                        }).then(async()=>{
                                                            // Reload Filters
                                                            var warnAnimeInput
                                                            for(let i=0; i<savedWarnAnime.length; i++) {
                                                                warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                                                await warnAnimeInput.val(savedWarnAnime[i])
                                                                var e = await $.Event("keyup",{keyCode:13})
                                                                await warnAnimeInput.trigger(e)
                                                                await warnAnimeInput.val("")
                                                            }
                                                            await $("#warnAnimeContainer").css({visibility:"visible"}).hide()
                                                            return
                                                        })
                                                        resolve()
                                                    }
                                                },1)
                                            })
                                            return
                                        }).then(async()=>{
                                            await new Promise(async(resolve)=>{
                                                await $("#filterAlgoContainer").css({visibility:"hidden"}).show()
                                                let reloadSavedData = await setInterval(async () => {
                                                    if(await $("#filterAlgoContainer .flexdatalist-multiple-value > .flexdatalist-alias").length){
                                                        await clearInterval(reloadSavedData)
                                                        await new Promise(async(resolve)=>{
                                                            // Remove Current Filters
                                                            var filterInfo = await $("#filterAlgoModal .flexdatalist-multiple").children("li.value")
                                                            for(let i=0; i<filterInfo.length; i++) {
                                                                var infoName = await filterInfo.eq(i).children(".text")[0].innerText
                                                                await filterInfo.eq(i).children(".fdl-remove").trigger("click")
                                                                await $("#filterAlgoModal .flexdatalist-alias").blur()
                                                            }
                                                            resolve()
                                                        }).then(async()=>{
                                                            // Reload Filters
                                                            var filterAlgoInput
                                                            for(let i=0; i<savedFilterAlgo.length; i++) {
                                                                filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                                                await filterAlgoInput.val(savedFilterAlgo[i])
                                                                var e = await $.Event("keyup",{keyCode:13})
                                                                await filterAlgoInput.trigger(e)
                                                                await filterAlgoInput.val("")
                                                            }
                                                            await $("#filterAlgoContainer").css({visibility:"visible"}).hide()
                                                            return
                                                        })
                                                        resolve()
                                                    }
                                                },1)
                                            })
                                            return
                                        }).then(async()=>{
                                            if(Object.keys(savedRecScheme).length) {
                                                await $("#updateBtn").show()
                                                await $("#updateIntervalBtn").show()
                                                await LoadData(savedRecScheme)
                                            } else {
                                                await $("#updateBtn").hide()
                                                await $("#updateIntervalBtn").hide()
                                                animeData = `
                                                    <tr class="item ${savedTheme}" role="row">
                                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                                            <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                                            No Data
                                                        </td>
                                                    </tr>
                                                `
                                                await $("#animeRecommendationList").empty()
                                                await $("#animeRecommendationList").append(animeData)
                                                await $("#anime-table").trigger("update")
                                            }
                                            return
                                        }).then(async()=>{
                                            $("#importFile")[0].value = null
                                            if(!requestIsRunning){
                                                $("#dataStatusContainer").fadeOut(1000) 
                                            }
                                            await Swal.fire({
                                                heightAuto: false,
                                                text: "Data has been updated!",
                                                icon: "success",
                                                confirmButtonColor: "#000"
                                            })
                                            return
                                        })
                                        .catch(()=>{
                                            return
                                        })
                                    } else {
                                        $("#importFile")[0].value = null
                                        await $("#importBtn").css({background: "black", color: "white"})
                                    }
                                })
                            } else {
                                var fileContent
                                await new Promise(async(resolve,reject)=>{
                                    await $("#importBtn").css({background: "black", color: "white"})
                                    try{
                                        fileContent = await JSON.parse(reader.result)
                                    } catch(ex) {
                                        $("#importFile")[0].value = null
                                        $(".swal2-validation-message")
                                            .addClass("no-before").removeClass("no-before")
                                            .addClass("error-before")
                                            .html(
                                                `Error: Invalid Backup File`
                                            )
                                            .css({display:"flex"})
                                        return
                                    }
                                    if(fileContent.savedUsername===undefined||fileContent.savedUsername===null) {
                                        $("#importFile")[0].value = null
                                        $(".swal2-validation-message")
                                            .addClass("no-before").removeClass("no-before")
                                            .addClass("error-before")
                                            .html(
                                                `Error: Backup file does not Have a Username`
                                            )
                                            .css({display:"flex"})
                                        reject()
                                    } else {
                                        $(".swal2-validation-message")
                                            .addClass("no-before")
                                            .css({display:"flex"})
                                            .html(
                                                `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                                    <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                                    <div>Importing Data...</div>
                                                </div>`
                                            )
                                        resolve()
                                    }
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion){
                                        await saveJSON(importedBackUpVersion, "backUpVersion")
                                    }
                                }).then(async()=>{
                                    savedUsername = await fileContent.savedUsername || ""
                                    await $("#username").val(savedUsername)
                                    await saveJSON(savedUsername,"savedUsername")
                                    return
                                }).then(async()=>{
                                    savedHiddenAnimeIDs = await fileContent.savedHiddenAnimeIDs || {}
                                    await saveJSON(savedHiddenAnimeIDs,"savedHiddenAnimeIDs")
                                    if(jsonIsEmpty(savedHiddenAnimeIDs)) {
                                        $("#showAllAnime").hide()
                                    } else {
                                        $("#showAllAnime").show()
                                    }
                                    return
                                }).then(async()=>{
                                    savedRecScheme = await fileContent.savedRecScheme || {}
                                    await saveJSON(savedRecScheme,"savedRecScheme")
                                }).then(async()=>{
                                    var importedBackUpVersion = await fileContent.backUpVersion
                                    if(importedBackUpVersion){
                                        savedAnimeEntries = await fileContent.savedAnimeEntries || []
                                        await saveJSON(savedAnimeEntries,"savedAnimeEntries")
                                    }
                                }).then(async()=>{
                                    lastSavedUpdateTime = await fileContent.lastSavedUpdateTime || 0
                                    await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                                }).then(async()=>{
                                    savedUserList = await fileContent.savedUserList || {}
                                    await saveJSON(savedUserList,"savedUserList")
                                }).then(async()=>{
                                    savedAnalyzeVariableTime = await fileContent.savedAnalyzeVariableTime || 90
                                    await saveJSON(savedAnalyzeVariableTime,"savedAnalyzeVariableTime")
                                }).then(async()=>{
                                    savedUpdateAnalyzeAnimeTime = await fileContent.savedUpdateAnalyzeAnimeTime || 3
                                    await saveJSON(savedUpdateAnalyzeAnimeTime,"savedUpdateAnalyzeAnimeTime")
                                }).then(async()=>{
                                    lastAnilistPage = await fileContent.lastAnilistPage || 284
                                    await saveJSON(lastAnilistPage,"lastAnilistPage")
                                }).then(async()=>{
                                    savedWarnAnime = await fileContent.savedWarnAnime || [ "ecchi","mahou shoujo","!boys' love","cgi","!ero guro","!female harem",
                                                                                        "full cgi","kids","love triangle","!male harem","!mixed gender harem",
                                                                                        "!nudity","!slavery","!suicide","tokusatsu","!yuri","wuxia","!netorare",
                                                                                        "!rape"
                                                                                        ]
                                    await saveJSON(savedWarnAnime,"savedWarnAnime")
                                    return
                                }).then(async()=>{
                                    savedFilterAlgo = await fileContent.savedFilterAlgo || []
                                    await saveJSON(savedFilterAlgo,"savedFilterAlgo")
                                    return
                                }).then(async()=>{
                                    await $("#username").val(savedUsername)
                                    return
                                }).then(async()=>{
                                    await new Promise(async(resolve)=>{
                                        await $("#warnAnimeContainer").css({visibility:"hidden"}).show()
                                        let reloadSavedData = await setInterval(async () => {
                                            if(await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias").length){
                                                await clearInterval(reloadSavedData)
                                                await new Promise(async(resolve)=>{
                                                    // Remove Current Filters
                                                    var warnInfo = await $("#warnAnimeModal .flexdatalist-multiple").children("li.value")
                                                    for(let i=0; i<warnInfo.length; i++) {
                                                        var infoName = await warnInfo.eq(i).children(".text")[0].innerText
                                                        await warnInfo.eq(i).children(".fdl-remove").trigger("click")
                                                        await $("#warnAnimeModal .flexdatalist-alias").blur()
                                                    }
                                                    resolve()
                                                }).then(async()=>{
                                                    // Reload Filters
                                                    var warnAnimeInput
                                                    for(let i=0; i<savedWarnAnime.length; i++) {
                                                        warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                                        await warnAnimeInput.val(savedWarnAnime[i])
                                                        var e = await $.Event("keyup",{keyCode:13})
                                                        await warnAnimeInput.trigger(e)
                                                        await warnAnimeInput.val("")
                                                    }
                                                    await $("#warnAnimeContainer").css({visibility:"visible"}).hide()
                                                    return
                                                })
                                                resolve()
                                            }
                                        },1)
                                    })
                                    return
                                }).then(async()=>{
                                    await new Promise(async(resolve)=>{
                                        await $("#filterAlgoContainer").css({visibility:"hidden"}).show()
                                        let reloadSavedData = await setInterval(async () => {
                                            if(await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias").length){
                                                await clearInterval(reloadSavedData)
                                                await new Promise(async(resolve)=>{
                                                    // Remove Current Filters
                                                    var filterInfo = await $("#filterAlgoModal .flexdatalist-multiple").children("li.value")
                                                    for(let i=0; i<filterInfo.length; i++) {
                                                        var infoName = await filterInfo.eq(i).children(".text")[0].innerText
                                                        await filterInfo.eq(i).children(".fdl-remove").trigger("click")
                                                        await $("#filterAlgoModal .flexdatalist-alias").blur()
                                                    }
                                                    resolve()
                                                }).then(async()=>{
                                                    // Reload Filters
                                                    var filterAlgoInput
                                                    for(let i=0; i<savedFilterAlgo.length; i++) {
                                                        filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                                        await filterAlgoInput.val(savedFilterAlgo[i])
                                                        var e = await $.Event("keyup",{keyCode:13})
                                                        await filterAlgoInput.trigger(e)
                                                        await filterAlgoInput.val("")
                                                    }
                                                    await $("#filterAlgoContainer").css({visibility:"visible"}).hide()
                                                    return
                                                })
                                                resolve()
                                            }
                                        },1)
                                    })
                                    return
                                }).then(async()=>{
                                    if(Object.keys(savedRecScheme).length) {
                                        await $("#updateBtn").show()
                                        await $("#updateIntervalBtn").show()
                                        await LoadData(savedRecScheme)
                                    } else {
                                        await $("#updateBtn").hide()
                                        await $("#updateIntervalBtn").hide()
                                        animeData = `
                                            <tr class="item ${savedTheme}" role="row">
                                                <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                                    <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                                    No Data
                                                </td>
                                            </tr>
                                        `
                                        await $("#animeRecommendationList").empty()
                                        await $("#animeRecommendationList").append(animeData)
                                        await $("#anime-table").trigger("update")
                                    }
                                    return
                                }).then(async()=>{
                                    $("#importFile")[0].value = null
                                    await Swal.fire({
                                        heightAuto: false,
                                        text: "Data has been updated!",
                                        icon: "success",
                                        confirmButtonColor: "#000"
                                    })
                                    // Reset Custom Validation
                                    $("#filterAlgo-validation").html("").hide()
                                    return
                                })
                                .catch(()=>{
                                    return
                                })
                            }
                        }
                        reader.readAsText(importedFile);  
                    }
                })
                $("#exportBtn").on("click", async()=>{
                    Swal.fire({
                        heightAuto: false,
                        text: `Do you want to export your data?`,
                        showConfirmButton: true,
                        confirmButtonText: "Yes",
                        showDenyButton: true,
                        denyButtonText: "No",
                        confirmButtonColor: '#000',
                        denyButtonColor: '#e27d81',
                        icon: "question",
                        reverseButtons: true
                    })
                    .then(async(value) => {
                        if(value.isConfirmed){
                            await new Promise(async(resolve)=>{
                                await $(".menu-container").fadeOut(250)
                                $("#dataStatusContainer").fadeOut(1000)
                                setTimeout(()=>{
                                    $("#dataStatusSpinner").show()
                                    $("#dataStatus")
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                    $("#dataStatusContainer").css("display","flex").fadeIn(1000)
                                },1000)
                                resolve()
                            }).then(async()=>{
                                var worker4 = new Worker(`./js-css/worker/export-${version}.js`)
                                const savedUsername = await retrieveJSON("savedUsername")
                                const savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs")
                                const savedWarnAnime = await retrieveJSON("savedWarnAnime")
                                const savedFilterAlgo = await retrieveJSON("savedFilterAlgo")
                                const savedUserList = await retrieveJSON("savedUserList")
                                const savedAnimeEntries = await retrieveJSON("savedAnimeEntries")
                                const savedRecScheme = await retrieveJSON("savedRecScheme")
                                const savedAnalyzeVariableTime = await retrieveJSON("savedAnalyzeVariableTime")
                                const savedUpdateAnalyzeAnimeTime = await retrieveJSON("savedUpdateAnalyzeAnimeTime")
                                const savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime")
                                const lastAnilistPage = await retrieveJSON("lastAnilistPage")
                                const lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
                                const backUpVersion = await retrieveJSON("backUpVersion")
                                worker4.postMessage({
                                    savedUsername: savedUsername,
                                    savedWarnAnime: savedWarnAnime,
                                    savedFilterAlgo: savedFilterAlgo,
                                    savedHiddenAnimeIDs: savedHiddenAnimeIDs,
                                    savedRecScheme: savedRecScheme,
                                    savedAnimeEntries: savedAnimeEntries,
                                    savedUserList: savedUserList,
                                    savedAnalyzeVariableTime: savedAnalyzeVariableTime,
                                    savedUpdateAnalyzeAnimeTime: savedUpdateAnalyzeAnimeTime,
                                    savedDeepUpdateTime: savedDeepUpdateTime,
                                    lastAnilistPage: lastAnilistPage,
                                    lastSavedUpdateTime: lastSavedUpdateTime,
                                    backUpVersion: backUpVersion,
                                })
                                worker4.onmessage = async(message) => {
                                    worker4.terminate()
                                    // Browser
                                    await downloadObjectAsJson(message.data.backupStr, `Kanshi.${savedUsername.toLowerCase()||"Backup"}.json`)
                                    // Browser
                                    if(!requestIsRunning){
                                        await $("#dataStatusContainer").fadeOut(1000)
                                    }
                                    await Swal.fire({
                                        heightAuto: false,
                                        text: "Data has been exported!",
                                        icon: "success",
                                        confirmButtonColor: "#000"
                                    })
                                }
                            })
                        }
                    })
                })
                $("#updateIntervalBtn").on("click",async()=>{
                    updateIntervalIsActive = await retrieveJSON("updateIntervalIsActive") || false
                    if(updateIntervalIsActive){
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to disable auto update for your recommendations list every 1 hour?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                $("#updateIntervalBtn").removeClass("selected")
                                updateIntervalIsActive = false
                                await saveJSON(updateIntervalIsActive,"updateIntervalIsActive")
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to enable auto update for your recommendations list every 1 hour?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                $("#updateIntervalBtn").addClass("selected")
                                updateIntervalIsActive = true
                                await saveJSON(updateIntervalIsActive,"updateIntervalIsActive")
                                updateIntervalStartDate = await retrieveJSON("updateIntervalStartDate") || new Date()
                                await saveJSON(updateIntervalStartDate,"updateIntervalStartDate")
                                if((new Date).getTime()-(updateIntervalStartDate.getTime())>3600000){// 1hrs
                                    if(!requestIsRunning){
                                        savedUsername = await retrieveJSON("savedUsername") || ""
                                        if(await $("#username").val()!==savedUsername) await $("#username").val(savedUsername)
                                        willAutoUpdate = true
                                        Update(false)
                                    }
                                } else {
                                    for(let i=0;i<updateIntervalTimeout.length;i++) clearTimeout(updateIntervalTimeout[i])
                                    var saveUpdateIntervalTimeout = setTimeout(async()=>{
                                        if(!requestIsRunning){
                                            savedUsername = await retrieveJSON("savedUsername") || ""
                                            if(await $("#username").val()!==savedUsername) await $("#username").val(savedUsername)
                                            willAutoUpdate = true
                                            Update(false)
                                        }
                                    },3600000-((new Date).getTime()-(updateIntervalStartDate.getTime())))
                                    updateIntervalTimeout.push(saveUpdateIntervalTimeout)
                                }
                            }
                        })
                    }
                })
                $("#exportIntervalBtn").on("click",async()=>{
                    exportIntervalIsActive = await retrieveJSON("exportIntervalIsActive") || false
                    if(exportIntervalIsActive){
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to disable data back-up every 1 hour?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                $("#exportIntervalBtn").removeClass("selected")
                                exportIntervalIsActive = false
                                await saveJSON(exportIntervalIsActive,"exportIntervalIsActive")
                            }
                        })
                    } else {
                        Swal.fire({
                            heightAuto: false,
                            text: `Do you want to enable data Back-Up every 1 hour?`,
                            showConfirmButton: true,
                            confirmButtonText: "Yes",
                            showDenyButton: true,
                            denyButtonText: "No",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "question",
                            reverseButtons: true
                        })
                        .then(async(value) => {
                            if(value.isConfirmed){
                                $("#exportIntervalBtn").addClass("selected")
                                exportIntervalIsActive = true
                                await saveJSON(exportIntervalIsActive,"exportIntervalIsActive")
                                exportIntervalStartDate = await retrieveJSON("exportIntervalStartDate") || new Date()
                                await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                                if((new Date).getTime()-(exportIntervalStartDate.getTime())>3600000){// 1hrs
                                    await new Promise(async(resolve)=>{
                                        await $(".menu-container").fadeOut(250)
                                        $("#dataStatusContainer").fadeOut(1000)
                                        setTimeout(()=>{
                                            $("#dataStatusSpinner").show()
                                            $("#dataStatus")
                                                .empty()
                                                .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                            $("#dataStatusContainer").css("display","flex").fadeIn(1000)
                                        },1000)
                                        resolve()
                                    }).then(async()=>{
                                        var worker5 = new Worker(`./js-css/worker/export-${version}.js`)
                                        const savedUsername = await retrieveJSON("savedUsername")
                                        const savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs")
                                        const savedWarnAnime = await retrieveJSON("savedWarnAnime")
                                        const savedFilterAlgo = await retrieveJSON("savedFilterAlgo")
                                        const savedUserList = await retrieveJSON("savedUserList")
                                        const savedAnimeEntries = await retrieveJSON("savedAnimeEntries")
                                        const savedRecScheme = await retrieveJSON("savedRecScheme")
                                        const savedAnalyzeVariableTime = await retrieveJSON("savedAnalyzeVariableTime")
                                        const savedUpdateAnalyzeAnimeTime = await retrieveJSON("savedUpdateAnalyzeAnimeTime")
                                        const savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime")
                                        const lastAnilistPage = await retrieveJSON("lastAnilistPage")
                                        const lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
                                        const backUpVersion = await retrieveJSON("backUpVersion")
                                        worker5.postMessage({
                                            savedUsername: savedUsername,
                                            savedWarnAnime: savedWarnAnime,
                                            savedFilterAlgo: savedFilterAlgo,
                                            savedHiddenAnimeIDs: savedHiddenAnimeIDs,
                                            savedRecScheme: savedRecScheme,
                                            savedAnimeEntries: savedAnimeEntries,
                                            savedUserList: savedUserList,
                                            savedAnalyzeVariableTime: savedAnalyzeVariableTime,
                                            savedUpdateAnalyzeAnimeTime: savedUpdateAnalyzeAnimeTime,
                                            savedDeepUpdateTime: savedDeepUpdateTime,
                                            lastAnilistPage: lastAnilistPage,
                                            lastSavedUpdateTime: lastSavedUpdateTime,
                                            backUpVersion: backUpVersion,
                                        })
                                        worker5.onmessage = async(message) => {
                                            worker5.terminate()
                                            // Browser
                                            await downloadObjectAsJson(message.data.backupStr, `Kanshi.${savedUsername.toLowerCase()||"Backup"}.json`)
                                            // Browser
                                            exportIntervalStartDate = await new Date()
                                            await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                                            if(!requestIsRunning){
                                                await $("#dataStatusContainer").fadeOut(1000)
                                            }
                                            await Swal.fire({
                                                heightAuto: false,
                                                text: "Data has been exported!",
                                                icon: "success",
                                                confirmButtonColor: "#000"
                                            })
                                        }
                                    })
                                } else {
                                    for(let i=0;i<exportIntervalTimeout.length;i++) clearTimeout(exportIntervalTimeout[i])
                                    var saveExportIntervalTimeout = setTimeout(async()=>{
                                        $("#dataStatusContainer").fadeOut(1000)
                                        setTimeout(()=>{
                                            $("#dataStatusSpinner").show()
                                            $("#dataStatus")
                                                .empty()
                                                .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                            $("#dataStatusContainer").css("display","flex").fadeIn(1000)
                                        },1000)
                                        var worker6 = new Worker(`./js-css/worker/export-${version}.js`)
                                        const savedUsername = await retrieveJSON("savedUsername")
                                        const savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs")
                                        const savedWarnAnime = await retrieveJSON("savedWarnAnime")
                                        const savedFilterAlgo = await retrieveJSON("savedFilterAlgo")
                                        const savedUserList = await retrieveJSON("savedUserList")
                                        const savedAnimeEntries = await retrieveJSON("savedAnimeEntries")
                                        const savedRecScheme = await retrieveJSON("savedRecScheme")
                                        const savedAnalyzeVariableTime = await retrieveJSON("savedAnalyzeVariableTime")
                                        const savedUpdateAnalyzeAnimeTime = await retrieveJSON("savedUpdateAnalyzeAnimeTime")
                                        const savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime")
                                        const lastAnilistPage = await retrieveJSON("lastAnilistPage")
                                        const lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
                                        const backUpVersion = await retrieveJSON("backUpVersion")
                                        worker6.postMessage({
                                            savedUsername: savedUsername,
                                            savedWarnAnime: savedWarnAnime,
                                            savedFilterAlgo: savedFilterAlgo,
                                            savedHiddenAnimeIDs: savedHiddenAnimeIDs,
                                            savedRecScheme: savedRecScheme,
                                            savedAnimeEntries: savedAnimeEntries,
                                            savedUserList: savedUserList,
                                            savedAnalyzeVariableTime: savedAnalyzeVariableTime,
                                            savedUpdateAnalyzeAnimeTime: savedUpdateAnalyzeAnimeTime,
                                            savedDeepUpdateTime: savedDeepUpdateTime,
                                            lastAnilistPage: lastAnilistPage,
                                            lastSavedUpdateTime: lastSavedUpdateTime,
                                            backUpVersion: backUpVersion,
                                        })
                                        worker6.onmessage = async(message) => {
                                            worker6.terminate()
                                            // Browser
                                            await downloadObjectAsJson(message.data.backupStr, `Kanshi.${savedUsername.toLowerCase()||"Backup"}.json`)
                                            // Browser
                                            exportIntervalStartDate = await new Date()
                                            await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                                            if(!requestIsRunning){
                                                await $("#dataStatusContainer").fadeOut(1000)
                                            }
                                            await Swal.fire({
                                                heightAuto: false,
                                                text: "Data has been exported!",
                                                icon: "success",
                                                confirmButtonColor: "#000"
                                            })
                                        }
                                    },3600000-((new Date).getTime()-(exportIntervalStartDate.getTime())))
                                    exportIntervalTimeout.push(saveExportIntervalTimeout)
                                }
                            }
                        })
                    }
                })
                $("#warnAnimeBtn").on("click", async ()=>{
                    await $("#warnAnimeContainer").show()
                    $("#warnAnimeModal").removeClass("swal2-hide-custom").addClass("swal2-show-custom").show()
                })
                $("#submitWarnAnime").on("click",async()=>{
                    var warnAnimeInputs = $("#warnAnimeModal .flexdatalist-multiple > .value").children(".text")
                    var warnAnime = []
                    for(let i=0; i<warnAnimeInputs.length; i++){
                        var warnName = warnAnimeInputs[i].textContent
                        warnAnime.push(warnName)
                    }
                    await saveJSON(warnAnime,"savedWarnAnime")
                    savedRecScheme = await retrieveJSON("savedRecScheme")
                    await $("#warnAnimeModal").removeClass("swal2-show-custom").addClass("swal2-hide-custom")
                    setTimeout(()=>{
                        $("#warnAnimeContainer").hide()
                    },300)
                    LoadData(savedRecScheme)
                })
                $("#warnAnimeContainer, #cancelWarnAnime").on("click",async()=>{
                    $("#warnAnimeModal").removeClass("swal2-show-custom").addClass("swal2-hide-custom")
                    setTimeout(async()=>{
                        $("#warnAnimeContainer").hide()
                        savedWarnAnime = await retrieveJSON("savedWarnAnime") || []
                        await new Promise(async(resolve)=>{
                            // Remove Current Filters
                            var warnInfo = await $("#warnAnimeModal .flexdatalist-multiple").children("li.value")
                            for(let i=0; i<warnInfo.length; i++) {
                                var infoName = await warnInfo.eq(i).children(".text")[0].innerText
                                await warnInfo.eq(i).children(".fdl-remove").trigger("click")
                                await $("#warnAnimeModal .flexdatalist-alias").blur()
                            }
                            resolve()
                        }).then(async()=>{
                            // apply saved
                            for(let i=0; i<savedWarnAnime.length; i++) {
                                warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                await warnAnimeInput.val(savedWarnAnime[i])
                                var e = await $.Event("keyup",{keyCode:13})
                                await warnAnimeInput.trigger(e)
                                await warnAnimeInput.val("")
                            }
                        })                        
                    },300)
                })
                $("#warnAnimeContainer, .swal2-modal-custom").on("click",(e)=>{
                    e.stopImmediatePropagation()
                })
                $("#filterAlgoBtn").on("click", async ()=>{
                    await $("#filterAlgoContainer").show()
                    $("#filterAlgoModal").removeClass("swal2-hide-custom").addClass("swal2-show-custom").show()
                })
                $("#submitFilterAlgo").on("click",async()=>{
                    savedUserList = await retrieveJSON("savedUserList") || {}
                    var savedUserListValues = Object.values(savedUserList)
                    if(!isJson(savedUserList)||!isJson(savedUserListValues[0])||jsonIsEmpty(savedUserList)){
                        Swal.fire({
                            heightAuto: false,
                            text: `You need to update first before using this Feature!`,
                            showConfirmButton: true,
                            confirmButtonText: "Update",
                            showDenyButton: true,
                            denyButtonText: "Later",
                            confirmButtonColor: '#000',
                            denyButtonColor: '#e27d81',
                            icon: "info",
                            reverseButtons: true
                        }).then(async(value)=>{
                            if(value.isConfirmed){
                                $("#filterAlgoModal").removeClass("swal2-show-custom").addClass("swal2-hide-custom")
                                setTimeout(()=>{
                                    $("#filterAlgoContainer").hide()
                                },300)
                                Update(false)
                                $(".menu-container").fadeOut(250)
                                $("#dataStatusContainer").fadeOut(1000)
                            }
                        })
                        return
                    } else {
                        var filterAlgoInputs = $("#filterAlgoModal .flexdatalist-multiple > .value").children(".text")
                        var filterAlgo = []
                        for(let i=0; i<filterAlgoInputs.length; i++){
                            var filterName = filterAlgoInputs[i].textContent
                            filterAlgo.push(filterName)
                        }
                        $("#filterAlgoModal #filterAlgo-validation")
                            .removeClass("success-before")
                            .addClass("no-before")
                            .css({display:"flex"})
                            .html(
                                `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                    <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                    <div>Analyzing Variables...</div>
                                </div>`
                            )
                        Update(true, filterAlgo)
                    }
                })
                $("#filterAlgoContainer, #cancelFilterAlgo").on("click",async()=>{
                    $("#filterAlgoModal").removeClass("swal2-show-custom").addClass("swal2-hide-custom")
                    setTimeout(async()=>{
                        $("#filterAlgoContainer").hide()
                        // Remove Current Filters
                        savedFilterAlgo = await retrieveJSON("savedFilterAlgo") || []
                        await new Promise(async(resolve)=>{
                            var filterInfo = await $("#filterAlgoModal .flexdatalist-multiple").children("li.value")
                            for(let i=0; i<filterInfo.length; i++) {
                                var infoName = await filterInfo.eq(i).children(".text")[0].innerText
                                await filterInfo.eq(i).children(".fdl-remove").trigger("click")
                                await $("#filterAlgoModal .flexdatalist-alias").blur()
                            }
                            resolve()
                        }).then(async()=>{
                            for(let i=0; i<savedFilterAlgo.length; i++) {
                                filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                                await filterAlgoInput.val(savedFilterAlgo[i])
                                var e = await $.Event("keyup",{keyCode:13})
                                await filterAlgoInput.trigger(e)
                                await filterAlgoInput.val("")
                            }
                        })
                    },300)
                })
                $("#filterAlgoContainer, .swal2-modal-custom").on("click",(e)=>{
                    e.stopImmediatePropagation()
                })
                $("#sign-up").on("click", async ()=>{
                    Swal.fire({
                        heightAuto: false,
                        text: `Do you want to create an Anilist account?`,
                        showConfirmButton: true,
                        confirmButtonText: "Yes, Signup",
                        showDenyButton: true,
                        denyButtonText: "No",
                        confirmButtonColor: '#000',
                        denyButtonColor: '#e27d81',
                        icon: "question",
                        reverseButtons: true
                    }).then(async(value)=>{
                        if(value.isConfirmed){
                            await window.open('https://anilist.co/signup', '_blank')
                            if(!requestIsRunning){
                                var initStartTime = await retrieveJSON("initStartTime") || undefined
                                const { value: username} = await Swal.fire({
                                    heightAuto: false,
                                    text: "Done signing-up your new account with Anilist? Update with your new username to load your own data.",
                                    input: 'text',
                                    inputLabel: 'Enter your Anilist Username:',
                                    customClass: {
                                        icon: 'no-border'
                                    },
                                    allowOutsideClick: false,
                                    allowEscapeKey: false,
                                    showConfirmButton: true,
                                    confirmButtonText: "Update",
                                    confirmButtonColor: '#000',
                                    showDenyButton: true,
                                    denyButtonColor: '#e27d81',
                                    denyButtonText: "Cancel",
                                    reverseButtons: true,
                                    inputValidator: async(value) => {
                                        return await new Promise(async(resolve) => {
                                            if(!value) {
                                                resolve("You need to write Something...")
                                            } else {
                                                $.ajax({
                                                    type: 'POST',
                                                    url: 'https://graphql.anilist.co',
                                                    headers: {
                                                        'Content-Type': 'application/json',
                                                        'Accept': 'application/json',
                                                        'Cache-Control': 'max-age=31536000, immutable'
                                                    },
                                                    dataType: 'json',
                                                    data: JSON.stringify({
                                                        query: `{User(name:"${value}"){name}}`
                                                    }),
                                                    beforeSend: () => {
                                                        $(".swal2-validation-message")
                                                            .addClass("no-before")
                                                            .css({display:"flex"})
                                                            .html(
                                                                `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                                                    <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                                                    <div>Checking Username...</div>
                                                                </div>`
                                                            )
                                                    },
                                                    success: (data) => {
                                                        initStartTime = undefined;
                                                        (async()=>{
                                                            await saveJSON(initStartTime,"initStartTime")
                                                            $("#UsernameValidation").fadeOut(1000,()=>{
                                                                $("#UsernameValidation").remove()
                                                                $(".swal2-validation-message")
                                                                    .addClass("no-before").removeClass("no-before")
                                                                    .addClass("success-before")
                                                                    .html("User has been Found")
                                                                setTimeout(()=>{
                                                                    // Reset Custom Validation
                                                                    $("#filterAlgo-validation").html("").hide()
                                                                    resolve()
                                                                },1000) 
                                                            })
                                                        })();
                                                    },
                                                    error: (xhr) =>{
                                                        try{
                                                            if(xhr.responseJSON.errors[0].message==='Not Found.'){
                                                                initStartTime = undefined;
                                                                (async()=>{
                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                    $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                                                    resolve("Username not Found, Please Try Again")
                                                                })();
                                                            }
                                                        } catch(ex){}
                                                        try{
                                                            if(xhr.responseJSON.data.User==null){
                                                                initStartTime = undefined;
                                                                (async()=>{
                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                    $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                                                    resolve("Username not Found, Please Try Again")
                                                                })();
                                                            }
                                                        } catch(ex){
                                                            if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                                                initStartTime = new Date();
                                                                (async()=>{
                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                })();
                                                            }
                                                            $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                                            resolve(`An Error Occured, Please Try Again in ${msToTime(Math.max(60000-(new Date()-initStartTime),1000))}`)
                                                        }
                                                    }
                                                })
                                            }
                                        })
                                    }
                                })
                                if(username){
                                    await $("#username").val(username)
                                    Update(false)
                                }
                            }
                        }
                    })
                })
                $("#themeBtn").on("click", async ()=>{
                    savedTheme = await retrieveJSON("savedTheme") || "darkMode"
                    savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                    if(savedTheme==="darkMode"){
                        var newTheme = "lightMode"
                        $("#themeBtn").removeClass("selected")
                        await loadTheme(newTheme,savedTheme)
                        savedTheme = newTheme
                        await saveJSON(savedTheme,"savedTheme")
                        LoadData(savedRecScheme)
                    } else {
                        var newTheme = "darkMode"
                        $("#themeBtn").addClass("selected")
                        await loadTheme(newTheme,savedTheme)
                        savedTheme = newTheme
                        await saveJSON(savedTheme,"savedTheme")
                        LoadData(savedRecScheme)
                    }
                })
                $("#hideKidsAnimeBtn").on("click", async ()=>{
                    kidsAnimeIsHidden = await retrieveJSON("kidsAnimeIsHidden")
                    if(kidsAnimeIsHidden){
                        kidsAnimeIsHidden = false
                        await saveJSON(kidsAnimeIsHidden,"kidsAnimeIsHidden")
                        $("#hideKidsAnimeBtn").removeClass("selected")
                        savedRecScheme = await retrieveJSON("savedRecScheme")
                        LoadData(savedRecScheme)
                    } else {
                        kidsAnimeIsHidden = true
                        await saveJSON(kidsAnimeIsHidden,"kidsAnimeIsHidden")
                        $("#hideKidsAnimeBtn").addClass("selected")
                        savedRecScheme = await retrieveJSON("savedRecScheme")
                        LoadData(savedRecScheme)
                    }
                })
                $("#animeRecommendationList").delegate('td.anime-score', 'click' , async function() {
                    var warns = $(this).children("div").children("div").attr("title")
                    if(warns!==undefined){
                        await Swal.fire({
                            heightAuto: false,
                            text: `Content Warning, Anime has the following contents: \n${warns}`,
                            icon: "info",
                            confirmButtonColor: "#000",
                            customClass: {
                                container: 'whitespace-pre-wrap'
                            }
                        })
                    }
                })
                $(".anime-table-headers").on('click', ()=>{
                    setTimeout(()=>{
                        let setPageInfo = setInterval(async()=>{
                            if(typeof $('#anime-table')[0].config!=="undefined"){
                                await saveJSON($('#anime-table')[0].config.sortList[0],"savedSort")
                                clearInterval(setPageInfo)
                                $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                            }
                        },1)
                    },0)
                })
                $(".filter-container, .filter-container-custom").on('DOMNodeInserted','.flexdatalist-multiple',()=>{
                    if(savedTheme==="darkMode"){
                        $(` .flexdatalist-multiple,
                            .flexdatalist-alias, 
                            .flexdatalist-results, 
                            .flexdatalist-multiple li.value
                        `).addClass('darkMode')
                    }
                })
                $("body").on('DOMNodeInserted','.swal2-popup, .swal2-popup-custom, .swal2-container',()=>{
                    if(savedTheme==="darkMode"){
                        $(`.swal2-confirm, .swal2-confirm-custom, .swal2-footer a, .swal2-popup, .swal2-popup-custom, .swal2-validation-message`).addClass('darkMode')
                        // Observe Attribute Change
                        var swalValMes = document.getElementById("swal2-validation-message")
                        if(swalValMes){
                            var observed = new MutationObserver((mutations)=>{
                                var classList = mutations[0].target.classList
                                if(!classList.contains("darkMode")){
                                    classList.add("darkMode")
                                } else {
                                    return
                                }
                            })
                            observed.observe(document.getElementById("swal2-validation-message"),{attributes:true})
                        }
                    }
                })
                $("body").on('DOMNodeInserted','.flexdatalist-results',()=>{
                    if(savedTheme==="darkMode"){
                        $(`.flexdatalist-results`).addClass('darkMode')
                    }
                })
                $(".flexdatalist-multiple").on('DOMNodeInserted',()=>{
                    if(savedTheme==="darkMode"){
                        $(`.flexdatalist-multiple li.value`).addClass('darkMode')
                    }
                })
                $("body").on('scroll', function () {
                    setTimeout(async()=>{
                        await saveJSON($("body").scrollTop(),"savedYscroll")
                    },1)
                })
                // Browser (Mobile)
                $(window).on("orientationchange", function(event) {
                    $('body').animate({scrollTop: 0},1)
                })
                // Browser (Mobile)
                resolve()
            })
        }).then(async()=>{
            // Init Global Saved Data
            return await new Promise(async(resolve)=>{
                savedAnimeEntries = await retrieveJSON("savedAnimeEntries") || []
                lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
                savedTheme = await retrieveJSON("savedTheme") || "darkMode"
                savedUnhiddenTablePage = await retrieveJSON("savedUnhiddenTablePage") || 0
                savedHiddenTablePage = await retrieveJSON("savedHiddenTablePage") || 0
                savedTableStatus = await retrieveJSON("savedTableStatus") || "Unhidden"
                savedUsername = await retrieveJSON("savedUsername") || ""
                savedFilterOptionsJson = await retrieveJSON("savedFilterOptionsJson") || []
                allFilterInfo = await retrieveJSON("allFilterInfo") || {}
                savedBackUpVersion = await retrieveJSON(`backUpVersion`) || false
                kidsAnimeIsHidden = await retrieveJSON("kidsAnimeIsHidden") || true
                savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs") || {}
                savedSort = await retrieveJSON("savedSort") || [1,1]
                savedYscroll = await retrieveJSON("savedYscroll") || 0.0
                savedFilterAlgo = await retrieveJSON("savedFilterAlgo") || []
                savedWarnAnime = await retrieveJSON("savedWarnAnime") || [ "ecchi","mahou shoujo","!boys' love","cgi","!ero guro","!female harem",
                                                                            "full cgi","kids","love triangle","!male harem","!mixed gender harem",
                                                                            "!nudity","!slavery","!suicide","tokusatsu","!yuri","wuxia","!netorare",
                                                                            "!rape"
                                                                            ]
                updateIntervalIsActive = await retrieveJSON("updateIntervalIsActive") || false
                exportIntervalIsActive = await retrieveJSON("exportIntervalIsActive") || false
                resolve()
            })
        }).then(async()=>{
            return await new Promise(async(resolve)=>{
                // Initial SavedTheme
                await loadTheme(savedTheme)
                resolve()
            })
        }).then(async()=>{
            // Init Modules/Config/Functions
            return await new Promise(async(resolve)=>{
                // Jquery Table Sorter
                await $("#anime-table")
                    .tablesorter({
                        sortInitialOrder: "asc",
                        headers: {
                            1:{sortInitialOrder: "desc"},
                            4:{sortInitialOrder: "desc"},
                            9:{sortInitialOrder: "desc"},
                        },
                        widgets: ["saveSort"],
                        widgetOptions : {
                            saveSort : true
                        }
                    })
                    .tablesorterPager({
                        container: $(".pager"),
                        updateArrows: true,
                        page: (savedTableStatus==="Unhidden"? savedUnhiddenTablePage:savedHiddenTablePage),
                        savePages: true,
                        size: 8,
                        pageReset: false,
                        removeRows: true,
                        cssNext: '.next',
                        cssPrev: '.prev',
                        cssFirst: '.first',
                        cssLast: '.last',
                        cssGoto: '.pagenum',
                        cssPageDisplay: '.pagedisplay'
                    })
                    .delegate('button.hide-anime', 'click' , async(e) => {
                        var hiddenRow = await $(e.currentTarget).closest('tr') || $(e.target).closest('tr')
                        var hiddenAnimeID = hiddenRow.children("td.animeTitle").children("a").attr("data-value")
                        savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs") || {}
                        savedHiddenAnimeIDs[hiddenAnimeID] = await null
                        await saveJSON(savedHiddenAnimeIDs,"savedHiddenAnimeIDs")
                        hiddenRow.addClass("remove-me")
                        $("#anime-table").trigger("pagerUpdate")
                        if($("#anime-table")[0].config.rowsCopy.length===0){
                            await $("#animeRecommendationList").empty()
                            await $("#animeRecommendationList").append(`
                                <tr class="item ${savedTheme}" role="row">
                                    <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                        <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                        No Data
                                    </td>
                                </tr>
                            `)
                        }
                        // Have a Hidden Anime
                        if(await !jsonIsEmpty(savedHiddenAnimeIDs)){
                            await $("#showAllAnime").show()
                        }
                        await setTimeout(async()=>{
                            let setPageInfo = await setInterval(async()=>{
                                if(typeof $('#anime-table')[0].config!=="undefined"){
                                    await clearInterval(setPageInfo)
                                    await $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                                }
                            },1)
                        },0)
                        return false
                    })
                    .delegate('button.show-anime', 'click' , async(e) => {
                        var hiddenRow = await $(e.currentTarget).closest('tr') || $(e.target).closest('tr')
                        var hiddenAnimeID = await hiddenRow.children("td.animeTitle").children("a").attr("data-value")
                        savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs") || {}
                        delete savedHiddenAnimeIDs[hiddenAnimeID]
                        await saveJSON(savedHiddenAnimeIDs,"savedHiddenAnimeIDs")
                        // No Hidden Anime
                        await hiddenRow.addClass("remove-me")
                        await $("#anime-table").trigger("pagerUpdate")
                        if(await jsonIsEmpty(savedHiddenAnimeIDs)||$("#anime-table")[0].config.rowsCopy.length===0){
                            await $("#animeRecommendationList").empty()
                            await $("#animeRecommendationList").append(`
                                <tr class="item ${savedTheme}" role="row">
                                    <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                        <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                        No Data
                                    </td>
                                </tr>
                            `)
                            await $("#showAllAnime").hide()
                        }
                        await setTimeout(async()=>{
                            let setPageInfo = await setInterval(async()=>{
                                if(await (typeof $('#anime-table')[0].config!=="undefined")){
                                    await clearInterval(setPageInfo)
                                    await $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                                }
                            },1)
                        },0)
                        return false
                    })
                    .bind('pageMoved', async() => {
                        await setTimeout(async()=>{
                            let setPageInfo = await setInterval(async()=>{
                                if(typeof $('#anime-table')[0].config!=="undefined"){
                                    await clearInterval(setPageInfo)
                                    await $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                                    var page = await $('#anime-table')[0].config.pager.page
                                    ++page
                                    savedTableStatus = await retrieveJSON("savedTableStatus") || "Unhidden"
                                    if(savedTableStatus==="Unhidden"){
                                        await saveJSON(page,"savedUnhiddenTablePage")
                                    } else {
                                        await saveJSON(page,"savedHiddenTablePage")
                                    }
                                }
                            },1)
                        },0)
                    })
                // Flex DataList
                await $('.flexdatalist').flexdatalist({})
                await $('.flexdatalistWarnAnime').flexdatalist({})
                await $('.flexdatalistFilterAlgo').flexdatalist({})
                resolve()
            })
        }).then(async()=>{
            // Init Backup Data
            return await new Promise(async(resolve)=>{
                if(savedAnimeEntries.length<1||lastSavedUpdateTime===0||savedBackUpVersion<backUpVersion){
                    var worker0 = await new Worker(`./js-css/worker/getAnimeEntries-${version}.js`)
                    await worker0.postMessage("")
                    worker0.onmessage = async (message) => {
                        await worker0.terminate()
                        const data = await message.data
                        savedAnimeEntries = await data.savedAnimeEntries
                        await saveJSON(savedAnimeEntries,"savedAnimeEntries")
                        lastSavedUpdateTime = await data.lastSavedUpdateTime
                        await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                        resolve()
                    }
                    worker0.onerror = () => {
                        resolve()
                    }
                } else {
                    resolve()
                }
            }).then(async()=>{  
                if(await savedFilterOptionsJson.length===0||savedBackUpVersion<backUpVersion){
                    var worker1 = await new Worker(`./js-css/worker/getOptions-${version}.js`)
                    await worker1.postMessage("")
                    worker1.onmessage = async (message) => {
                        await worker1.terminate()
                        const data = await message.data
                        savedFilterOptionsJson = await data.savedFilterOptionsJson
                        await saveJSON(savedFilterOptionsJson,"savedFilterOptionsJson")
                        allFilterInfo = await data.allFilterInfo
                        await saveJSON(allFilterInfo,"allFilterInfo")
                        await $('.flexdatalist').flexdatalist({
                            minLength: 0,
                            searchIn: 'info',
                            data: savedFilterOptionsJson
                        })
                        return
                    }
                    worker1.onerror = async (message) => {
                        return
                    }
                } else {
                    await $('.flexdatalist').flexdatalist({
                        minLength: 0,
                        searchIn: 'info',
                        data: savedFilterOptionsJson
                    })
                    return
                }
            })
        }).then(async()=>{
            // Apply Saved Data   
            return await new Promise(async(resolve) => {
                // Reload Name
                if(await savedUsername.length>0){
                    await $("#username").val(savedUsername)
                    await $("#updateIntervalBtn").show()
                } else {
                    savedUserList = {}
                    await saveJSON(savedUserList,"savedUserList")
                }
                // Reload Table Filters/Identifiers
                    // Table Filters
                if(savedUsername!==undefined){
                    if(savedUsername.length>0){
                        var filterInput
                        savedFilters = await retrieveJSON("savedFilters") || []
                        for(let i=0; i<savedFilters.length; i++) {
                            filterInput = await $("#filters .flexdatalist-multiple-value > .flexdatalist-alias")
                            await filterInput.val(savedFilters[i])
                            var e = await $.Event("keyup",{keyCode:13})
                            await filterInput.trigger(e)
                            await filterInput.val("")
                        }
                    }
                }
                    // Algorithm Filters
                var filterAlgoInput
                for(let i=0; i<savedFilterAlgo.length; i++) {
                    filterAlgoInput = await $("#filterAlgoModal .flexdatalist-multiple-value > .flexdatalist-alias")
                    await filterAlgoInput.val(savedFilterAlgo[i])
                    var e = await $.Event("keyup",{keyCode:13})
                    await filterAlgoInput.trigger(e)
                    await filterAlgoInput.val("")
                }
                await $("#filterAlgoContainer").css({visibility:"visible"}).hide()
                    // Warn Content Identifier
                var warnAnimeInput
                for(let i=0; i<savedWarnAnime.length; i++) {
                    warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                    await warnAnimeInput.val(savedWarnAnime[i])
                    var e = await $.Event("keyup",{keyCode:13})
                    await warnAnimeInput.trigger(e)
                    await warnAnimeInput.val("")
                }
                await $("#warnAnimeContainer").css({visibility:"visible"}).hide()
                
                // Menu Filters
                if(await kidsAnimeIsHidden){
                    await $("#hideKidsAnimeBtn").addClass("selected")
                }
                if(await savedTheme==="darkMode"){
                    await $("#themeBtn").addClass("selected")
                }
                if(await updateIntervalIsActive){
                    await $("#updateIntervalBtn").addClass("selected")
                }
                if(await exportIntervalIsActive){
                    await $("#exportIntervalBtn").addClass("selected")
                }

                // Init Last List (Unhidden/Hidden) 
                var filters = await $("#filters .flexdatalist-multiple").children("li.value")
                for(let i=0; i<filters.length; i++) {
                    var filterName = await filters.eq(i).children(".text")[0].innerText
                    if(await filterName.toLowerCase()==="hidden"){
                        await $("#hiddenUnhiddenBtn").text("Hidden")
                    }
                }

                // Load Table
                if(await Object.keys(savedRecScheme).length>0){
                    await $("#updateBtn").show()
                    await LoadData(savedRecScheme)
                    $(".loader").fadeOut(250)
                    if(await !jsonIsEmpty(savedHiddenAnimeIDs)){
                        await $("#showAllAnime").show()
                    }
                    resolve()
                } else {
                    animeData = `
                        <tr class="item ${savedTheme}" role="row">
                            <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                No Data
                            </td>
                        </tr>
                    `
                    await $("#animeRecommendationList").empty()
                    await $("#animeRecommendationList").append(animeData)
                    await $("#anime-table").trigger("update")
                    resolve()
                }
            })
        }).then(async()=>{
            // Update Saved DOM State
            return await new Promise(async(resolve)=>{
                await $.tablesorter.sortOn($('#anime-table')[0].config, [savedSort])
                await $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                await $('body').animate({scrollTop: savedYscroll},1)
                resolve()
            })
        }).then(async()=>{
            // Auto Intervals
            return await new Promise(async(resolve) => {
                // Auto Update
                if(await updateIntervalIsActive){
                    await $("#updateIntervalBtn").css({background: "white",color:"black"})
                    updateIntervalStartDate = await retrieveJSON("updateIntervalStartDate") || new Date()
                    await saveJSON(updateIntervalStartDate,"updateIntervalStartDate")
                    if(await (new Date).getTime()-(updateIntervalStartDate.getTime())>3600000){// 1hr
                        if(!requestIsRunning){
                            savedUsername = await retrieveJSON("savedUsername") || ""
                            if(await $("#username").val()!==savedUsername) await $("#username").val(savedUsername)
                            willAutoUpdate = true
                            await Update(false)
                            resolve()
                        } else {
                            resolve()
                        }
                    } else {
                        for(let i=0;i<updateIntervalTimeout.length;i++) await clearTimeout(updateIntervalTimeout[i])
                        var saveUpdateIntervalTimeout = setTimeout(async()=>{
                            if(!requestIsRunning){
                                savedUsername = await retrieveJSON("savedUsername") || ""
                                if(await $("#username").val()!==savedUsername) await $("#username").val(savedUsername)
                                willAutoUpdate = true
                                await Update(false)
                            }
                        },await 3600000-((new Date).getTime()-(updateIntervalStartDate.getTime())))
                        await updateIntervalTimeout.push(saveUpdateIntervalTimeout)
                        resolve()
                    }
                } else {
                    resolve()
                }
            }).then(async()=>{
                // Auto Export
                if(await exportIntervalIsActive){
                    await $("#exportIntervalBtn").css({background: "white",color:"black"})
                    exportIntervalStartDate = await retrieveJSON("exportIntervalStartDate") || new Date()
                    await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                    if(await ((new Date).getTime()-(exportIntervalStartDate.getTime())>3600000)){// 1hr
                        $("#dataStatusContainer").fadeOut(1000)
                        setTimeout(()=>{
                            $("#dataStatusSpinner").show()
                            $("#dataStatus")
                                .empty()
                                .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                            $("#dataStatusContainer").css("display","flex").fadeIn(1000)
                        },1000)
                        var worker2 = new Worker(`./js-css/worker/export-${version}.js`)
                        const savedUsername = await retrieveJSON("savedUsername")
                        const savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs")
                        const savedWarnAnime = await retrieveJSON("savedWarnAnime")
                        const savedFilterAlgo = await retrieveJSON("savedFilterAlgo")
                        const savedUserList = await retrieveJSON("savedUserList")
                        const savedAnimeEntries = await retrieveJSON("savedAnimeEntries")
                        const savedRecScheme = await retrieveJSON("savedRecScheme")
                        const savedAnalyzeVariableTime = await retrieveJSON("savedAnalyzeVariableTime")
                        const savedUpdateAnalyzeAnimeTime = await retrieveJSON("savedUpdateAnalyzeAnimeTime")
                        const savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime")
                        const lastAnilistPage = await retrieveJSON("lastAnilistPage")
                        const lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
                        const savedBackUpVersion = await retrieveJSON("backUpVersion")
                        worker2.postMessage({
                            savedUsername: savedUsername,
                            savedWarnAnime: savedWarnAnime,
                            savedFilterAlgo: savedFilterAlgo,
                            savedHiddenAnimeIDs: savedHiddenAnimeIDs,
                            savedRecScheme: savedRecScheme,
                            savedAnimeEntries: savedAnimeEntries,
                            savedUserList: savedUserList,
                            savedAnalyzeVariableTime: savedAnalyzeVariableTime,
                            savedUpdateAnalyzeAnimeTime: savedUpdateAnalyzeAnimeTime,
                            savedDeepUpdateTime: savedDeepUpdateTime,
                            lastAnilistPage: lastAnilistPage,
                            lastSavedUpdateTime: lastSavedUpdateTime,
                            savedBackUpVersion: savedBackUpVersion,
                        })
                        worker2.onmessage = async(message) => {
                            worker2.terminate()
                            // Browser
                            await downloadObjectAsJson(message.data.backupStr, `Kanshi.${savedUsername.toLowerCase()||"Backup"}.json`)
                            // Browser
                            exportIntervalStartDate = await new Date()
                            await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                            if(!requestIsRunning){
                                await $("#dataStatusContainer").fadeOut(1000)
                            }
                            await Swal.fire({
                                heightAuto: false,
                                text: "Data has been exported!",
                                icon: "success",
                                confirmButtonColor: "#000"
                            })
                            return
                        }
                        worker2.onerror = () => {
                            return
                        }
                    } else {
                        for(let i=0;i<exportIntervalTimeout.length;i++) await clearTimeout(exportIntervalTimeout[i])
                        var saveExportIntervalTimeout = await setTimeout(async()=>{
                            $("#dataStatusContainer").fadeOut(1000)
                            setTimeout(()=>{
                                $("#dataStatusSpinner").show()
                                $("#dataStatus")
                                    .empty()
                                    .append(`<span style="white-space:nowrap;">Exporting data, please wait...</span>`)
                                $("#dataStatusContainer").css("display","flex").fadeIn(1000)
                            },1000)
                            var worker3 = new Worker(`./js-css/worker/export-${version}.js`)
                            const savedUsername = await retrieveJSON("savedUsername")
                            const savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs")
                            const savedWarnAnime = await retrieveJSON("savedWarnAnime")
                            const savedFilterAlgo = await retrieveJSON("savedFilterAlgo")
                            const savedUserList = await retrieveJSON("savedUserList")
                            const savedAnimeEntries = await retrieveJSON("savedAnimeEntries")
                            const savedRecScheme = await retrieveJSON("savedRecScheme")
                            const savedAnalyzeVariableTime = await retrieveJSON("savedAnalyzeVariableTime")
                            const savedUpdateAnalyzeAnimeTime = await retrieveJSON("savedUpdateAnalyzeAnimeTime")
                            const savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime")
                            const lastAnilistPage = await retrieveJSON("lastAnilistPage")
                            const lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
                            const savedBackUpVersion = await retrieveJSON("backUpVersion")
                            worker3.postMessage({
                                savedUsername: savedUsername,
                                savedWarnAnime: savedWarnAnime,
                                savedFilterAlgo: savedFilterAlgo,
                                savedHiddenAnimeIDs: savedHiddenAnimeIDs,
                                savedRecScheme: savedRecScheme,
                                savedAnimeEntries: savedAnimeEntries,
                                savedUserList: savedUserList,
                                savedAnalyzeVariableTime: savedAnalyzeVariableTime,
                                savedUpdateAnalyzeAnimeTime: savedUpdateAnalyzeAnimeTime,
                                savedDeepUpdateTime: savedDeepUpdateTime,
                                lastAnilistPage: lastAnilistPage,
                                lastSavedUpdateTime: lastSavedUpdateTime,
                                savedBackUpVersion: savedBackUpVersion,
                            })
                            worker3.onmessage = async(message) => {
                                worker3.terminate()
                                // Browser
                                await downloadObjectAsJson(message.data.backupStr, `Kanshi.${savedUsername.toLowerCase()||"Backup"}.json`)
                                // Browser
                                exportIntervalStartDate = await new Date()
                                await saveJSON(exportIntervalStartDate,"exportIntervalStartDate")
                                if(!requestIsRunning){
                                    await $("#dataStatusContainer").fadeOut(1000)
                                }
                                await Swal.fire({
                                    heightAuto: false,
                                    text: "Data has been exported!",
                                    icon: "success",
                                    confirmButtonColor: "#000"
                                })
                            }
                        },await 3600000-((new Date).getTime()-(exportIntervalStartDate.getTime())))
                        await exportIntervalTimeout.push(saveExportIntervalTimeout)
                        return
                    }
                } else {
                    return
                }
            })
        }).then(async()=>{
            // Save Back-Up Data Version Updates
            if(savedBackUpVersion<backUpVersion){
                await saveJSON(backUpVersion,"backUpVersion")
                return
            } else {
                return
            }
            return
        }).then(async()=>{
            // Init New User
            if(savedUsername===undefined||savedUsername.length===0){
                initUsernameData()
                return
            } else {
                return
            }
        }).then(async()=>{
            // Load Saved Theme
            return await new Promise(async(resolve)=>{
                await loadTheme(savedTheme)
                resolve()
            })
        }).then(async()=>{
            $(".loader").fadeOut(250)
        })
    }

    // Main Functions
    function Update(notAnUpdate, filterAlgo){
        updateStartTime = new Date
        var filterInput = $("#filters > ul > .flexdatalist-multiple-value > input")
        var username = $("#username").val()
        var filter = filterInput.val()
        // Check Input Validity
        if(username===""||username===null||typeof username==="undefined"){
            $("#username")[0].setCustomValidity("Anilist Username is Required!")
            $("#username")[0].reportValidity()
        } else if($("#filters .flexdatalist-multiple").children("li").length<2&&filterInput.val()!=""){
            filterInput[0].setCustomValidity("Select or Enter a word to Filter!")
            filterInput[0].reportValidity()
        } else {
            // Start Update Request
            if(!requestIsRunning){
                requestIsRunning = true
            }
            var updateID = Math.random()
            while(updateIDs.includes(updateID)){
                updateID = Math.random()
            }
            updateIDs.push(updateID)
            if(updateIDs.length>1){
                setTimeout(()=>{
                    analyzeVariables(updateID, username, notAnUpdate, filterAlgo)
                },requestIntervalMS)
            } else {
                analyzeVariables(updateID, username, notAnUpdate, filterAlgo)
            }
        }
    }

    async function analyzeVariables(updateID, username, notAnUpdate, filterAlgo) {
        var savedAnalyzeVariableTime = await retrieveJSON("savedAnalyzeVariableTime") || 90
        savedAnimeEntries = await retrieveJSON("savedAnimeEntries") || []
        savedFilterAlgo = await (filterAlgo || await retrieveJSON("savedFilterAlgo") || [])
        //
        $("#dataStatusContainer").fadeOut(1000)
        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
        setTimeout(()=>{
            $("#dataStatusSpinner").show()
            $("#dataStatusContainer").css("display","flex").fadeIn(1000)
        },1000)
        for(let i=savedAnalyzeVariableTime; i>=0; i--){
            var timeout = setTimeout(()=>{
                $("#dataStatusSpinner").show()
                if(i===0){
                    $("#dataStatus")
                        .empty()
                        .append(`<span style="white-space:nowrap;">Analyzing your List... Please Wait a Moment...`)
                } else {
                    $("#dataStatus")
                        .empty()
                        .append(`<span style="white-space:nowrap;">Analyzing your List...⠀</span><span style="white-space:nowrap;">Estimated Time: ${msToTime(i*1000)}</span>`)
                }
            },(savedAnalyzeVariableTime-i)*1000)
            updateStateText.push(timeout)
        }
        var savedIncluded = []
        var savedExcluded = []
        for(let i=0; i<savedFilterAlgo.length; i++){
            var filterName = savedFilterAlgo[i].toLowerCase()
            if(filterName.charAt(0)==="!") savedExcluded.push(filterName.slice(1))
            else savedIncluded.push(filterName)
        }
        if(!notAnUpdate){
            var lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
            var AnalyzeVariableStartTime = new Date()
            if(lastSavedUpdateTime===0){
                isDeepUpdate = true
            }
            // Check Parameters
            if(username.length>0) {
                var maxAnimePerChunk = 500
                var userEntries = []
                async function recallAV(chunk){
                    // Allow Single Instance of Update
                    if(updateIDs.length>1&&updateID!==updateIDs.at(-1)){
                        updateIDs = updateIDs.filter((id)=>id!==updateID) // one line
                        return
                    }
                    // Initialize Anilist Graphql Data
                    var query = `
                    {
                        MediaListCollection(userName: "${username}", 
                        chunk:${chunk}, 
                        perChunk:${maxAnimePerChunk}, 
                        forceSingleCompletedList: true,
                        type: ANIME) {
                            hasNextChunk
                            lists {
                                entries {
                                    status
                                    media {
                                        id
                                        title {
                                            userPreferred
                                        }
                                        relations {
                                            edges { 
                                                relationType      
                                                node{
                                                    id
                                                }
                                            }
                                        }
                                        averageScore
                                        episodes
                                        duration
                                        trending
                                        popularity
                                        favourites
                                        format
                                        genres
                                        tags {
                                            name
                                            rank
                                            category
                                        }
                                        studios {
                                            nodes {
                                                name
                                                isAnimationStudio
                                            }
                                        }
                                        seasonYear
                                        season
                                        staff {
                                            edges {
                                                node {
                                                    name {
                                                        userPreferred
                                                    }
                                                }
                                                role
                                            }
                                        }
                                    }
                                    score
                                }
                            }
                        }
                    }
                    `;
                    savedUserList = await retrieveJSON("savedUserList") || {}
                    // Request API
                    $.ajax({
                        type: 'POST',
                        url: 'https://graphql.anilist.co',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json',
                            'Cache-Control': 'max-age=31536000, immutable'
                        },
                        dataType: 'json',
                        data: JSON.stringify({
                            query: query
                        }),
                        success: (result)=> {
                            var userList = result.data.MediaListCollection.lists
                            var hasNextChunk = result.data.MediaListCollection.hasNextChunk || userList.length>0
                            for(let i=0; i<userList.length; i++){
                                userEntries = userEntries.concat(userList[i].entries)
                            }
                            if(hasNextChunk){
                                return recallAV(++chunk)
                            } else {
                                // Reset User List
                                if(isDeepUpdate){
                                    savedUserList = {};
                                    (async()=>{
                                        await saveJSON(savedUserList,"savedUserList")
                                    })();
                                }
                                var worker7 = new Worker(`./js-css/worker/analyzeVariable-${version}.js`)
                                worker7.postMessage({savedUserList: savedUserList, userEntries: userEntries, savedIncluded: savedIncluded, savedExcluded: savedExcluded})
                                worker7.onmessage = (message) => {
                                    worker7.terminate()
                                    const data = message.data
                                    // Alert user if Scored List is 0
                                    // to have a better recommendation
                                    var userListCount = data.userListCount
                                    if(userListCount===0){
                                        Swal.fire({
                                            heightAuto: false,
                                            title: "Let us know you've liked...",
                                            text: `To make your recommendations better, rate the anime you've already watched in your Anilist account for us to make an Analysis, you can also transfer your MAL List to Anilist.`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Go to Anilist",
                                            showDenyButton: true,
                                            denyButtonText: "Import my MAL",
                                            showCancelButton: true,
                                            cancelButtonText: "Later",
                                            confirmButtonColor: '#000',
                                            denyButtonColor: '#2E51A2',
                                            cancelButtonColor: '#e27d81',
                                            icon: "info",
                                            reverseButtons: true
                                        })
                                        .then(async(value) => {
                                            if(value.isConfirmed){
                                                window.open('https://anilist.co/search/anime', '_blank')
                                                Swal.fire({
                                                    heightAuto: false,
                                                    title: "Let us know you've liked...",
                                                    text: `If you're done rating an Anime, click update below or in the settings.`,
                                                    showConfirmButton: true,
                                                    confirmButtonText: "Update",
                                                    showDenyButton: true,
                                                    denyButtonText: "Cancel",
                                                    confirmButtonColor: '#000',
                                                    denyButtonColor: '#e27d81',
                                                    icon: "info",
                                                    reverseButtons: true
                                                })
                                                .then(async(value)=>{
                                                    if(value.isConfirmed){
                                                        Update(false)
                                                    }
                                                })
                                            } else if(value.isDenied) {
                                                malanilistImportExport()
                                            }
                                        })
                                    } else if(userListCount>0&&userListCount<100) {
                                        Swal.fire({
                                            heightAuto: false,
                                            title: "Let us know you've liked...",
                                            text: `You currently rated ${userListCount} unique anime in your Anilist account, a minimum of 30-100 will suffice the recommendation analysis.`,
                                            showConfirmButton: true,
                                            confirmButtonText: "Sure, Later",
                                            showDenyButton: true,
                                            denyButtonText: "Go to Anilist",
                                            confirmButtonColor: '#e27d81',
                                            denyButtonColor: '#000',
                                            icon: "info",
                                            reverseButtons: true
                                        })
                                        .then(async(value) => {
                                            if(value.isDenied){
                                                window.open('https://anilist.co/search/anime', '_blank');
                                                Swal.fire({
                                                    heightAuto: false,
                                                    title: "Let us know you've liked...",
                                                    text: `If you're done rating an Anime, click update below or in the settings.`,
                                                    showConfirmButton: true,
                                                    confirmButtonText: "Update",
                                                    showDenyButton: true,
                                                    denyButtonText: "Cancel",
                                                    confirmButtonColor: '#000',
                                                    denyButtonColor: '#e27d81',
                                                    icon: "info",
                                                    reverseButtons: true
                                                })
                                                .then(async(value)=>{
                                                    if(value.isConfirmed){
                                                        Update(false)
                                                    }
                                                })
                                            }
                                        })
                                    }
                                    savedUserList = data.savedUserList
                                    const varScheme = data.varScheme
                                    const userListStatus = data.userListStatus
                                    const alteredVariables = data.alteredVariables
                                    var timeInterval = (new Date).getTime()-AnalyzeVariableStartTime.getTime();
                                    (async()=>{
                                        await saveJSON(Math.max(Math.ceil(timeInterval/1000),savedAnalyzeVariableTime), "savedAnalyzeVariableTime");
                                        if(savedAnimeEntries.length>0){
                                            await analyzeAnime(updateID, savedAnimeEntries, varScheme, userListStatus, alteredVariables, username, true)
                                            await saveJSON(savedUserList,"savedUserList")
                                        } else {
                                            await updateAllAnimeList(updateID, username, varScheme, userListStatus, alteredVariables, savedUserList)
                                        }
                                    })();
                                }
                            }
                        },
                        error: function(xhr) {
                            var err = xhr
                            try{
                                if(err.responseJSON.errors[0].message==='Not Found.'){
                                    err = 'Not Found.'
                                } else if(err.responseJSON.data.User==null){
                                    err = 'Not Found.'
                                }
                            } catch(ex){}
                            try {
                                if(err==='Not Found.'){
                                    setTimeout(()=>{
                                        $("#dataStatusContainer").fadeOut(1000)
                                        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                                    },1500)
                                    requestIsRunning = false
                                    Swal.fire({
                                        heightAuto: false,
                                        text: `Username '${username}' was not found in Anilist. Do you want to create another Anilist account?`,
                                        showConfirmButton: true,
                                        confirmButtonText: "Yes, Signup",
                                        showDenyButton: true,
                                        denyButtonText: "No, Change it Back",
                                        confirmButtonColor: '#000',
                                        denyButtonColor: '#e27d81',
                                        icon: "question",
                                        reverseButtons: true
                                    }).then(async(value)=>{
                                        if(value.isConfirmed){
                                            await window.open('https://anilist.co/signup', '_blank');
                                            if(!requestIsRunning){
                                                var initStartTime = await retrieveJSON("initStartTime") || undefined
                                                const { value: xusername} = await Swal.fire({
                                                    heightAuto: false,
                                                    text: "Done signing-up your new account with Anilist? Update with your new username or Return to the old username.",
                                                    input: 'text',
                                                    inputLabel: 'Enter your Anilist Username:',
                                                    inputValue: username,
                                                    customClass: {
                                                        icon: 'no-border'
                                                    },
                                                    allowOutsideClick: false,
                                                    allowEscapeKey: false,
                                                    showConfirmButton: true,
                                                    confirmButtonText: "Update",
                                                    confirmButtonColor: '#000',
                                                    showDenyButton: true,
                                                    denyButtonColor: '#e27d81',
                                                    denyButtonText: "Change it Back",
                                                    reverseButtons: true,
                                                    inputValidator: async(value) => {
                                                        return await new Promise(async(resolve) => {
                                                            if(savedTheme==="darkMode"){
                                                                $(`.swal2-validation-message`).addClass('darkMode')
                                                            }
                                                            if(!value) {
                                                                resolve("You need to write Something...")
                                                            } else {
                                                                $.ajax({
                                                                    type: 'POST',
                                                                    url: 'https://graphql.anilist.co',
                                                                    headers: {
                                                                        'Content-Type': 'application/json',
                                                                        'Accept': 'application/json',
                                                                        'Cache-Control': 'max-age=31536000, immutable'
                                                                    },
                                                                    dataType: 'json',
                                                                    data: JSON.stringify({
                                                                        query: `{User(name:"${value}"){name}}`
                                                                    }),
                                                                    beforeSend: () => {
                                                                        $(".swal2-validation-message")
                                                                            .addClass("no-before")
                                                                            .css({display:"flex"})
                                                                            .html(
                                                                                `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                                                                    <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                                                                    <div>Checking Username...</div>
                                                                                </div>`
                                                                            )
                                                                    },
                                                                    success: (data) => {
                                                                        initStartTime = undefined;
                                                                        (async()=>{
                                                                            await saveJSON(initStartTime,"initStartTime")
                                                                            $("#UsernameValidation").fadeOut(1000,()=>{
                                                                                $("#UsernameValidation").remove()
                                                                                $(".swal2-validation-message")
                                                                                    .addClass("no-before").removeClass("no-before")
                                                                                    .addClass("success-before")
                                                                                    .html("Username Found")
                                                                                setTimeout(()=>{
                                                                                    // Reset Custom Validation
                                                                                    $("#filterAlgo-validation").html("").hide()
                                                                                    resolve()
                                                                                },1000)
                                                                            })
                                                                        })();
                                                                    },
                                                                    error: (xhr) =>{
                                                                        try{
                                                                            if(xhr.responseJSON.errors[0].message==='Not Found.'){
                                                                                initStartTime = undefined;
                                                                                (async()=>{
                                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                                    $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                                                                    resolve("Username not Found, Please Try Again")
                                                                                })();
                                                                            }
                                                                        } catch(ex){}
                                                                        try{
                                                                            if(xhr.responseJSON.data.User==null){
                                                                                initStartTime = undefined;
                                                                                (async()=>{
                                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                                    $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                                                                    resolve("Username not Found, Please Try Again")
                                                                                })();
                                                                            }
                                                                        } catch(ex){
                                                                            if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                                                                initStartTime = new Date();
                                                                                (async()=>{
                                                                                    await saveJSON(initStartTime,"initStartTime")
                                                                                })();
                                                                            }
                                                                            $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                                                            resolve(`An Error Occured, Please Try Again in ${msToTime(Math.max(60000-(new Date()-initStartTime),1000))}`)
                                                                        }
                                                                    }
                                                                })
                                                            }
                                                        })
                                                    }
                                                })
                                                if(xusername){
                                                    await $("#username").val(xusername)
                                                    Update(false)
                                                } else {
                                                    savedUsername = await retrieveJSON("savedUsername")
                                                    $("#username").val(savedUsername)
                                                }
                                            }
                                        } else if(value.isDenied){
                                            savedUsername = await retrieveJSON("savedUsername")
                                            $("#username").val(savedUsername)
                                        }
                                    })
                                } else {
                                    for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                                    for(let i=60; i>=0; i--){
                                        var timeout = setTimeout(()=>{
                                            $("#dataStatusSpinner").show()
                                            if(i===0){
                                                $("#dataStatus")
                                                    .empty()
                                                    .append(`<span style="white-space:nowrap;">Limit Request, Please Wait a Moment...`)
                                            } else {
                                                $("#dataStatus")
                                                    .empty()
                                                    .append(`<span style="white-space:nowrap;">Limit Request, Continuing in ${msToTime(i*1000)}`)
                                            }
                                        },(60-i)*1000)
                                        updateStateText.push(timeout)
                                    }
                                    setTimeout(()=>{
                                        var analyzeVariableTime = Math.max(savedAnalyzeVariableTime-Math.ceil(((new Date).getTime()-AnalyzeVariableStartTime.getTime())/1000),1)
                                        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                                        for(let i=analyzeVariableTime; i>=0; i--){
                                            var timeout = setTimeout(()=>{
                                                $("#dataStatusSpinner").show()
                                                if(i===0){
                                                    $("#dataStatus")
                                                        .empty()
                                                        .append(`<span style="white-space:nowrap;">Analyzing your List... Please Wait a Moment...`)
                                                } else {
                                                    $("#dataStatus")
                                                        .empty()
                                                        .append(`<span style="white-space:nowrap;">Analyzing your List...⠀</span><span style="white-space:nowrap;">Estimated Time: ${msToTime(i*1000)}</span>`)
                                                }
                                            },(analyzeVariableTime-i)*1000)
                                            updateStateText.push(timeout)
                                        }
                                        return recallAV(chunk)
                                    },60000)
                                }
                            } catch(ex) {
                                requestIsRunning = false
                                console.error(ex)
                                $("#dataStatusContainer").fadeOut(1000)
                                console.error("Error 101")
                                Swal.fire({
                                    heightAuto: false,
                                    text: `Error 101: Oops...Something went wrong! Please try again...`,
                                    icon: "error",
                                    confirmButtonColor: "#000"
                                });
                                (async()=>{
                                    savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                                    await LoadData(savedRecScheme)
                                })();
                                // Browser
                                showNotification(`Oops...Something went wrong! Please try again...`)
                                // Browser
                                console.log("WebtoApp: Update Error")
                                if(Object.keys(savedRecScheme).length===0){
                                    $("#animeRecommendationList").empty()
                                    $("#animeRecommendationList").append(`
                                        <tr class="item ${savedTheme}" role="row">
                                            <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                                <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                                No Data
                                            </td>
                                        </tr>
                                    `)
                                }
                                for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                            }
                        }
                    })
                }
                recallAV(1) // first chunk
            }
        } else {
            savedUserList = await retrieveJSON("savedUserList") || {}
            var savedUserListValues = Object.values(savedUserList)
            if(isJson(savedUserList)&&isJson(savedUserListValues[0])&&!jsonIsEmpty(savedUserList)){
                var worker12 = new Worker(`./js-css/worker/analyzeVariable-${version}.js`)
                worker12.postMessage({savedUserList: savedUserList, notAnUpdate: true, savedIncluded: savedIncluded, savedExcluded: savedExcluded})
                worker12.onmessage = (message) => {
                    worker12.terminate()
                    const data = message.data
                    const varScheme = data.varScheme
                    const userListStatus = data.userListStatus
                    const alteredVariables = data.alteredVariables
                    analyzeAnime(updateID, savedAnimeEntries, varScheme, userListStatus, alteredVariables, username, false, true, filterAlgo)
                }
            } else {
                requestIsRunning = false
                $("#filterAlgoModal #filterAlgo-validation").hide()
                $("#dataStatusContainer").hide()
            }
        }
    }

    async function updateAllAnimeList(updateID, username, varScheme, userListStatus, alteredVariables, savedUserList){
        var lastAnilistPage = await retrieveJSON("lastAnilistPage") || 284
        var lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
        var tempLastSavedUpdateTime = lastSavedUpdateTime
        var maxAnimePerPage = 50
        var animeEntries = []
        async function recalluAAL(page){
            // Allow Single Instance of Update
            if(updateIDs.length>1&&updateID!==updateIDs.at(-1)){
                updateIDs = [updateIDs.at(-1)] // one line
                return
            }
            $.ajax({
                type: 'POST',
                url: 'https://graphql.anilist.co',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'Cache-Control': 'max-age=31536000, immutable'
                },
                dataType: 'json',
                data: JSON.stringify({
                    query: `
                    {
                        Page(page: ${page}, perPage: ${maxAnimePerPage}) {
                            pageInfo{
                                hasNextPage
                            }
                            media(
                                type: ANIME,
                                genre_not_in: ["Hentai"],
                                status_in:[FINISHED, RELEASING],
                                format_in:[TV,TV_SHORT,MOVIE,OVA,ONA,SPECIAL],
                                sort: [UPDATED_AT_DESC]) {
                                id
                                ${page===1?'updatedAt':''}
                                title {
                                    userPreferred
                                }
                                siteUrl
                                averageScore
                                episodes
                                duration
                                trending
                                popularity
                                favourites
                                format
                                genres
                                status
                                tags {
                                    name
                                    rank
                                    category
                                }
                                studios {
                                    nodes {
                                        name
                                        siteUrl
                                        isAnimationStudio
                                    }
                                }
                                seasonYear
                                season
                                staff {
                                    edges {
                                        node {
                                            name {
                                                userPreferred
                                            }
                                            siteUrl
                                        }
                                        role
                                    }
                                }
                            }
                        }
                    }
                    `
                }),
                beforeSend: ()=> {
                    for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                    $("#dataStatus")
                        .empty()
                        .append(`<span style="white-space:nowrap;">Getting Anime from Anilist:⠀</span><span style="white-space:nowrap;"><progress style="vertical-align:revert;" value="${page}" max="${lastAnilistPage>page?lastAnilistPage:page+1}"></progress>⠀${(page/(lastAnilistPage>page?lastAnilistPage:page+1)*100).toFixed(2)}%</span>`);
                    (async()=>{
                        await saveJSON(new Date(),"savedLastRequestDate")
                    })();
                },
                success: (result)=>{
                    var tempAnimeEntries = result.data.Page.media
                    var hasNextPage = result.data.Page.hasNextPage || tempAnimeEntries.length>0
                    animeEntries = animeEntries.concat(tempAnimeEntries)
                    if(tempAnimeEntries.length>0){
                        if(tempAnimeEntries[0].updatedAt!==null){
                            if(tempAnimeEntries[0].updatedAt>tempLastSavedUpdateTime){
                                tempLastSavedUpdateTime = tempAnimeEntries[0].updatedAt
                            }
                        }
                    }
                    if(hasNextPage){
                        return recalluAAL(++page)
                    } else {
                        $("#dataStatus")
                            .empty()
                            .append(`<span style="white-space:nowrap;">Getting Anime from Anilist:⠀</span><span style="white-space:nowrap;"><progress style="vertical-align:revert;" value="100" max="100"></progress>⠀100%</span>`);
                        (async()=>{
                            await saveJSON(animeEntries,"savedAnimeEntries")
                            lastSavedUpdateTime = tempLastSavedUpdateTime
                            await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                            await saveJSON(page, "lastAnilistPage")
                            if(savedUserList!==undefined){
                                await saveJSON(savedUserList,"savedUserList")
                            }
                            analyzeAnime(updateID, animeEntries, varScheme, userListStatus, alteredVariables, username, false)
                        })();
                    }
                },
                error: function(xhr) {
                    var err = xhr
                    try {
                        if(isJsonString(xhr.responseText)){
                            err = JSON.parse(xhr.responseText).errors[0].message
                            console.error(JSON.parse(xhr.responseText))
                        }
                        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                        for(let i=60; i>=0; i--){
                            var timeout = setTimeout(()=>{
                                $("#dataStatusSpinner").hide()
                                if(i===0){
                                    $("#dataStatus")
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Limit Request, Please Wait a Moment:⠀</span><span style="white-space:nowrap;"><progress style="vertical-align:revert;" value="${page}" max="${lastAnilistPage>page?lastAnilistPage:page+1}"></progress>⠀${(page/(lastAnilistPage>page?lastAnilistPage:page+1)*100).toFixed(2)}%</span>`)
                                } else {
                                    $("#dataStatus")
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Limit Request, Continuing in ${msToTime(i*1000)}:⠀</span><span style="white-space:nowrap;"><progress style="vertical-align:revert;" value="${page}" max="${lastAnilistPage>page?lastAnilistPage:page+1}"></progress>⠀${(page/(lastAnilistPage>page?lastAnilistPage:page+1)*100).toFixed(2)}%</span>`)
                                }
                            },(60-i)*1000)
                            updateStateText.push(timeout)
                        }
                        setTimeout(()=>{
                            return recalluAAL(page)
                        },60000)
                    } catch(ex) {
                        requestIsRunning = false
                        console.error(ex)
                        console.error("Error 102")
                        Swal.fire({
                            heightAuto: false,
                            text: `Error 102: Oops...Something went wrong! Please try again...`,
                            icon: "error",
                            confirmButtonColor: "#000"
                        });
                        (async()=>{
                            savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                            await LoadData(savedRecScheme)
                        })();
                        // Browser
                        showNotification(`Oops...Something went wrong! Please try again...`)
                        // Browser
                        $("#dataStatusContainer").fadeOut(1000)
                        console.log("WebtoApp: Update Error")
                        if(Object.keys(savedRecScheme).length===0){
                            $("#animeRecommendationList").empty()
                            $("#animeRecommendationList").append(`
                                <tr class="item ${savedTheme}" role="row">
                                    <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                        <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                        No Data
                                    </td>
                                </tr>
                            `)
                        }
                        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                    }
                }
            })
        }
        recalluAAL(1) // First Page
    }

    async function updateAnimeList(updateID, username, varScheme, userListStatus, alteredVariables){
        var lastSavedUpdateTime = await retrieveJSON("lastSavedUpdateTime") || 0
        var tempLastSavedUpdateTime = lastSavedUpdateTime
        var savedAnimeEntries = await retrieveJSON("savedAnimeEntries") || []
        if(lastSavedUpdateTime!==0&&savedAnimeEntries.length>0&&!isDeepUpdate){
            var maxAnimePerPage = 50
            var updatedAnimeEntries = []
            async function recalluAL(page){
                // Allow Single Instance of Update
                if(updateIDs.length>1&&updateID!==updateIDs.at(-1)){
                    updateIDs = updateIDs.filter((id)=>id!==updateID) // one line
                    return
                }
                $.ajax({
                    type: 'POST',
                    url: 'https://graphql.anilist.co',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Cache-Control': 'max-age=31536000, immutable'
                    },
                    dataType: 'json',
                    data: JSON.stringify({
                        query: `
                        {
                            Page(page: ${page}, perPage: ${maxAnimePerPage}) {
                                pageInfo{
                                    hasNextPage
                                }
                                media(
                                    type: ANIME,
                                    genre_not_in: ["Hentai"],
                                    status_in:[FINISHED, RELEASING],
                                    format_in:[TV,TV_SHORT,MOVIE,OVA,ONA,SPECIAL],
                                    sort: [UPDATED_AT_DESC]) {
                                    id
                                    updatedAt
                                    title {
                                        userPreferred
                                    }
                                    siteUrl
                                    averageScore
                                    episodes
                                    duration
                                    trending
                                    popularity
                                    favourites
                                    format
                                    genres
                                    status
                                    tags {
                                        name
                                        rank
                                        category
                                    }
                                    studios {
                                        nodes {
                                            name
                                            siteUrl
                                            isAnimationStudio
                                        }
                                    }
                                    seasonYear
                                    season
                                    staff {
                                        edges {
                                            node {
                                                name {
                                                    userPreferred
                                                }
                                                siteUrl
                                            }
                                            role
                                        }
                                    }
                                }
                            }
                        }
                        `
                    }),
                    beforeSend: ()=> {
                        for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                        $("#dataStatus")
                            .empty()
                            .append(`<span style="white-space:nowrap;">Updating Anime from Anilist...⠀</span><span style="white-space:nowrap;"><progress value="${updatedAnimeEntries.length}" max="${savedAnimeEntries.length}"></progress>⠀${(updatedAnimeEntries.length/savedAnimeEntries.length*100).toFixed(2)}%</span>`);
                        (async()=>{
                            await saveJSON(new Date(),"savedLastRequestDate")
                            if(page===1) {
                                $("#dataStatusSpinner").hide()
                            }
                        })();
                    },
                    success: (result)=>{
                        var tempUpdatedAnimeEntries = result.data.Page.media
                        var hasNextPage = result.data.Page.hasNextPage || tempUpdatedAnimeEntries.length>0
                        for(let i=0;i<tempUpdatedAnimeEntries.length;i++){
                            if(tempUpdatedAnimeEntries[i].updatedAt>lastSavedUpdateTime){
                                updatedAnimeEntries.push(tempUpdatedAnimeEntries[i].id)
                            }
                        }
                        if(tempUpdatedAnimeEntries.length>0){
                            if(tempUpdatedAnimeEntries[0].updatedAt>tempLastSavedUpdateTime){
                                tempLastSavedUpdateTime = tempUpdatedAnimeEntries[0].updatedAt
                            }
                        }
                        if(hasNextPage&&tempUpdatedAnimeEntries.at(-1).updatedAt>lastSavedUpdateTime){
                            return recalluAL(++page)
                        } else {
                            var worker8 = new Worker(`./js-css/worker/updateAnime-${version}.js`)
                            worker8.postMessage({
                                updatedAnimeEntries: updatedAnimeEntries,
                                savedAnimeEntries: savedAnimeEntries
                            })
                            worker8.onmessage = (message) => {
                                worker8.terminate()
                                $("#dataStatus")
                                    .empty()
                                    .append(`<span style="white-space:nowrap;">Updating Anime from Anilist...⠀</span><span style="white-space:nowrap;"><progress value="100" max="100"></progress>⠀100%</span>`)
                                const data = message.data
                                animeEntries = data.animeEntries;
                                (async()=>{
                                    await saveJSON(animeEntries,"savedAnimeEntries")
                                    lastSavedUpdateTime = tempLastSavedUpdateTime
                                    await saveJSON(lastSavedUpdateTime,"lastSavedUpdateTime")
                                    analyzeAnime(updateID, animeEntries, varScheme, userListStatus, alteredVariables, username, false)
                                })();
                            }
                        }
                    },
                    error: function(xhr) {
                        var err = xhr
                        try {
                            if(isJsonString(xhr.responseText)){
                                err = JSON.parse(xhr.responseText).errors[0].message
                                console.error(JSON.parse(xhr.responseText))
                            }
                            for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                            for(let i=60; i>=0; i--){
                                var timeout = setTimeout(()=>{
                                    $("#dataStatusSpinner").hide()
                                    if(i===0){
                                        $("#dataStatus")
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Limit Request, Please Wait a Moment:⠀</span><span style="white-space:nowrap;"><progress value="${updatedAnimeEntries.length}" max="${savedAnimeEntries.length}"></progress>⠀${(updatedAnimeEntries.length/savedAnimeEntries.length*100).toFixed(2)}%</span>`)
                                    } else {
                                        $("#dataStatus")
                                        .empty()
                                        .append(`<span style="white-space:nowrap;">Limit Request, Continuing in ${msToTime(i*1000)}:⠀</span><span style="white-space:nowrap;"><progress value="${updatedAnimeEntries.length}" max="${savedAnimeEntries.length}"></progress>⠀${(updatedAnimeEntries.length/savedAnimeEntries.length*100).toFixed(2)}%</span>`)
                                    }
                                },(60-i)*1000)
                                updateStateText.push(timeout)
                            }
                            setTimeout(()=>{
                                return recalluAL(page)
                            },60000)
                        } catch(ex) {
                            requestIsRunning = false
                            console.error(ex)
                            console.error("Error 106")
                            Swal.fire({
                                heightAuto: false,
                                text: `Error 106: Oops...Something went wrong! Please try again...`,
                                icon: "error",
                                confirmButtonColor: "#000"
                            });
                            (async()=>{
                                savedRecScheme = await retrieveJSON("savedRecScheme") || {}
                                await LoadData(savedRecScheme)
                            })();
                            // Browser
                            showNotification(`Oops...Something went wrong! Please try again...`)
                            // Browser
                            $("#dataStatusContainer").fadeOut(1000)
                            console.log("WebtoApp: Update Error")
                            if(Object.keys(savedRecScheme).length===0){
                                $("#animeRecommendationList").empty()
                                $("#animeRecommendationList").append(`
                                    <tr class="item ${savedTheme}" role="row">
                                        <td class="${savedTheme}" style="padding: 1.5em !important;" colspan="14">
                                            <i class="fa fa-solid fa-file fa-xl" style="padding-right: 1ch;"></i>
                                            No Data
                                        </td>
                                    </tr>
                                `)
                            }
                            for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
                        }
                    }
                })
            }
            recalluAL(1) // First Page
        } else {
            updateAllAnimeList(updateID, username, varScheme, userListStatus, alteredVariables)
        }
    }

    async function analyzeAnime(updateID, animeEntries, varScheme, userListStatus, alteredVariables, username, alertUser, notAnUpdate, filterAlgo){
        return await new Promise(async(resolve)=>{
            var UpdateAnalyzeAnimeStartTime = new Date()
            var savedUpdateAnalyzeAnimeTime = await retrieveJSON("savedUpdateAnalyzeAnimeTime") || 3
            allFilterInfo = await retrieveJSON("allFilterInfo") || {}
            if(notAnUpdate){
                $("#filterAlgoModal #filterAlgo-validation")
                    .removeClass("success-before")
                    .addClass("no-before")
                    .css({display:"flex"})
                    .html(
                        `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                            <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                            <div>Updating Recommendations List...</div>
                        </div>`
                    )
            }
            for(let i=0;i<updateStateText.length;i++) clearTimeout(updateStateText[i])
            $("#dataStatusSpinner").show()
            for(let i=savedUpdateAnalyzeAnimeTime; i>=0; i--){
                var timeout = setTimeout(()=>{
                    if(i===0){
                        $("#dataStatusSpinner").show()
                        $("#dataStatus")
                            .empty()
                            .append(`<span style="white-space:nowrap;">Updating Recommendations List... Please Wait a Moment...`)
                    } else {
                        $("#dataStatus")
                            .empty()
                            .append(`<span style="white-space:nowrap;">Updating Recommendations List...⠀</span><span style="white-space:nowrap;">Estimated Time: ${msToTime(i*1000)}</span>`)
                    }
                },(savedUpdateAnalyzeAnimeTime-i)*1000)
                updateStateText.push(timeout)
            }
            // Normal Update
            if(animeEntries.length===0) {
                animeEntries = await retrieveJSON("savedAnimeEntries") || []
            }
            var savedUsername = await retrieveJSON("savedUsername") || ""
            // Reset if Username Changed || isDeepUpdate
            if(username!==savedUsername||isDeepUpdate) {
                savedRecScheme = {}
            // Normal Update
            } else {
                savedRecScheme = await retrieveJSON("savedRecScheme") || {}
            }
            var worker9 = new Worker(`./js-css/worker/analyzeAnime-${version}.js`)
            worker9.postMessage({
                animeEntries: animeEntries,
                savedRecScheme: savedRecScheme,
                userListStatus: userListStatus,
                varScheme: varScheme,
                allFilterInfo: allFilterInfo,
                alteredVariables: alteredVariables,
            })
            worker9.onmessage = async(message) => {
                worker9.terminate()
                const data = message.data
                savedRecScheme = data.savedRecScheme
                // Save New Filter Options
                if(!notAnUpdate){
                    allFilterInfo = data.allFilterInfo
                    await saveJSON(allFilterInfo,"allFilterInfo")
                }
                // Save Filtered Algorithm Contents
                if(notAnUpdate){
                    await saveJSON(filterAlgo,"savedFilterAlgo")
                }
                // Save Table Filters
                var filterInputs = $("#filters .flexdatalist-multiple > .value").children(".text")
                var filters = []
                for(let i=0; i<filterInputs.length; i++){
                    var filterName = filterInputs[i].textContent
                    filters.push(filterName)
                }
                await saveJSON(filters, "savedFilters")
                // Save Username
                await saveJSON(username,"savedUsername")
                // Save new Recommendation List
                await saveJSON(savedRecScheme, "savedRecScheme")
                if(Object.keys(savedRecScheme).length>1){
                    $("#updateBtn").show()
                    $("#updateIntervalBtn").show()
                }
                var worker10 = new Worker(`./js-css/worker/updateOptions-${version}.js`)
                worker10.postMessage({
                    allFilterInfo: allFilterInfo
                })
                worker10.onmessage = async(message) => {
                    worker10.terminate()
                    const data = message.data
                    if(!notAnUpdate){
                        // Save and Reload Filters
                        savedFilterOptionsJson = data.savedFilterOptionsJson
                        await saveJSON(savedFilterOptionsJson,"savedFilterOptionsJson")
                        // This Remove Current Filters in DOM
                        $('.flexdatalist').flexdatalist({
                            data: savedFilterOptionsJson
                        })
                        // So Reload Table Filters
                        var filterInput
                        savedFilters = await retrieveJSON("savedFilters") || []
                        for(let i=0; i<savedFilters.length; i++) {
                            filterInput = $("#filters .flexdatalist-multiple-value > .flexdatalist-alias")
                            await filterInput.val(savedFilters[i])
                            var e = await $.Event("keyup",{keyCode:13})
                            await filterInput.trigger(e)
                            await filterInput.val("")
                        }
                        // Reload Warn Anime Contents
                        $("#warnAnimeContainer").css({visibility:"hidden"}).show()
                        savedWarnAnime = await retrieveJSON("savedWarnAnime") || [ "ecchi","mahou shoujo","!boys' love","cgi","!ero guro","!female harem",
                                                                            "full cgi","kids","love triangle","!male harem","!mixed gender harem",
                                                                            "!nudity","!slavery","!suicide","tokusatsu","!yuri","wuxia","!netorare",
                                                                            "!rape"
                                                                        ]
                        var warnAnimeInput
                        for(let i=0; i<savedWarnAnime.length; i++) {
                            warnAnimeInput = await $("#warnAnimeModal .flexdatalist-multiple-value > .flexdatalist-alias")
                            await warnAnimeInput.val(savedWarnAnime[i])
                            var e = await $.Event("keyup",{keyCode:13})
                            await warnAnimeInput.trigger(e)
                            await warnAnimeInput.val("")
                        }
                        await $("#warnAnimeContainer").css({visibility:"visible"}).hide()
                    }
                    // Lastly Update Update Time 
                    var timeInterval = (new Date).getTime()-UpdateAnalyzeAnimeStartTime.getTime()
                    await saveJSON(Math.max(Math.ceil(timeInterval/1000),savedUpdateAnalyzeAnimeTime), "savedUpdateAnalyzeAnimeTime")
                    // Reload New Recommendation Data
                    LoadData(savedRecScheme)
                    if(notAnUpdate){
                        $("#filterAlgoModal #filterAlgo-validation")
                            .addClass("no-before").removeClass("no-before")
                            .addClass("success-before")
                            .html("Filters have been applied")
                        setTimeout(()=>{
                            $("#filterAlgoModal #filterAlgo-validation").fadeOut(1000)
                        },1000)
                        $("#dataStatusContainer").fadeOut(1000)
                        requestIsRunning = false
                        resolve()
                    } else if(alertUser){
                        console.log("WebtoApp: List is Updated")
                        if(!swal.isVisible()){
                            Swal.fire({
                                heightAuto: false,
                                text: "List has been updated!",
                                icon: "success",
                                confirmButtonColor: "#000"
                            })
                        }
                        // Browser
                        showNotification("List has been updated!")
                        // Browser
                        // Continue Extra Updates
                        updateAnimeList(updateID, username, varScheme, userListStatus, alteredVariables)
                    } else {
                        if(willAutoUpdate){
                            (async()=>{
                                updateIntervalStartDate = await new Date()
                                await saveJSON(updateIntervalStartDate,"updateIntervalStartDate")
                                willAutoUpdate = false
                            })();
                        }
                        if(isDeepUpdate){
                            (async()=>{
                                isDeepUpdate = false
                                savedDeepUpdateTime = await retrieveJSON("savedDeepUpdateTime") || 320
                                var timeInterval = (new Date).getTime()-deepUpdateStartTime.getTime()
                                await saveJSON(Math.max(Math.ceil(timeInterval/1000),savedDeepUpdateTime),"savedDeepUpdateTime")
                            })();
                        }
                        $("#dataStatusContainer").fadeOut(1000)
                        requestIsRunning = false
                        resolve()
                    }
                }
            }
        })
    }

    async function LoadData(savedRecScheme){
        if(!isLoading) isLoading = true
        return await new Promise(async(resolve) => {
            var recList = Object.values(savedRecScheme)
            if((recList.length>0)) {
                var filterInputs = $("#filters .flexdatalist-multiple > .value").children(".text")
                var filters = []
                var includes = []
                var excludes = kidsAnimeIsHidden? ["tag: kids"] : []
                for(let i=0; i<filterInputs.length; i++){
                    var filterName = filterInputs[i].textContent
                    filters.push(filterName)
                    if(filterName.charAt(0)==="!") excludes.push(filterName.slice(1))
                    else includes.push(filterName)
                }
                $("#hiddenUnhiddenBtn").text("Unhidden")
                for(let i=0; i<includes.length; i++){
                    if(equalsNCS(includes[i],"hidden")){
                        $("#hiddenUnhiddenBtn").text("Hidden")
                        break;
                    }
                }
                await saveJSON(filters, "savedFilters")
                savedWarnAnime = await retrieveJSON("savedWarnAnime") || [ "ecchi","mahou shoujo","!boys' love","cgi","!ero guro","!female harem",
                                                                        "full cgi","kids","love triangle","!male harem","!mixed gender harem",
                                                                        "!nudity","!slavery","!suicide","tokusatsu","!yuri","wuxia","!netorare",
                                                                        "!rape"
                                                                        ]
                var savedWarnR = {}
                var savedWarnY = {}
                for(let i=0; i<savedWarnAnime.length; i++){
                    var warnName = savedWarnAnime[i].toLowerCase()
                    if(warnName.charAt(0)==="!") savedWarnR[warnName.slice(1)] = null
                    else savedWarnY[warnName] = null
                }
                savedHiddenAnimeIDs = await retrieveJSON("savedHiddenAnimeIDs") || {}
                var worker11 = new Worker(`./js-css/worker/loadData-${version}.js`)
                worker11.postMessage({
                    recList: recList,
                    savedHiddenAnimeIDs: savedHiddenAnimeIDs,
                    includes: includes,
                    excludes: excludes,
                    savedWarnR: savedWarnR,
                    savedWarnY: savedWarnY,
                    savedTheme: savedTheme
                })
                worker11.onmessage = async (message) => {
                    worker11.terminate()
                    const data = message.data
                    const animeData = data.animeData
                    savedUnhiddenTablePage = await retrieveJSON("savedUnhiddenTablePage") || 0
                    savedHiddenTablePage = await retrieveJSON("savedHiddenTablePage") || 0
                    savedTableStatus = await retrieveJSON("savedTableStatus") || "Unhidden"
                    await $("#animeRecommendationList").empty()
                    await $("#animeRecommendationList").css({
                        "display":"none",
                        "visibility":"hidden",
                        "content-visibility":"hidden"
                    }).append(animeData)
                    await $("#anime-table").trigger("update")
                    // await $("#anime-table").trigger("pagerUpdate")
                    await $("#animeRecommendationList").css({"content-visibility":"auto"})
                    await $("#animeRecommendationList").css({
                        "display":"",
                        "visibility":"",
                        "content-visibility":"auto"
                    })
                    // idk why savedUnhiddenTable Page sets to (page - 1) in SecondTolast and Last
                    await $("#anime-table").trigger("pageSet",(savedTableStatus==="Unhidden"? savedUnhiddenTablePage:savedHiddenTablePage))
                    // Rename Pager Options Text
                    setTimeout(()=>{
                        let setPageInfo = setInterval(()=>{
                            if(typeof $('#anime-table')[0].config!=="undefined"){
                                clearInterval(setPageInfo)
                                $("#pageNumberOptions").find("option:selected").text(`${$("#pageNumberOptions").val()} of ${$('#anime-table')[0].config.pager.totalPages||1}`).prop('selected', true)
                            }
                        },1)
                    },0)
                    isLoading = false
                    resolve()
                }
                worker11.onerror = () => {
                    isLoading = false
                    resolve()
                }
            }
        })
    }

    async function initUsernameData(){
        var initStartTime = await retrieveJSON("initStartTime") || undefined
        const { value: username } = await Swal.fire({
            heightAuto: false,
            title: "Starting Up",
            input: 'text',
            inputLabel: 'Enter your Anilist Username:',
            iconHtml: '<img src="./public/logo.png">',
            customClass: {
                icon: 'no-border'
            },
            allowOutsideClick: false,
            allowEscapeKey: false,
            showConfirmButton: true,
            confirmButtonText: "Search",
            confirmButtonColor: '#000',
            denyButtonColor: '#e27d81',
            reverseButtons: true,
            footer: `
                <a target="_blank" rel="noopener noreferrer" href="https://anilist.co/signup">Create an Anilist Account</a>
                <a href="javascript:$('#importBtn').click()">Import Backup</a>
            `,
            inputValidator: async(value) => {
                return await new Promise(async(resolve) => {
                    if(savedTheme==="darkMode"){
                        $(`.swal2-validation-message`).addClass('darkMode')
                    }
                    if(!value) {
                        resolve("You need to write Something...")
                    } else {
                        $.ajax({
                            type: 'POST',
                            url: 'https://graphql.anilist.co',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json',
                                'Cache-Control': 'max-age=31536000, immutable'
                            },
                            dataType: 'json',
                            data: JSON.stringify({
                                query: `{User(name:"${value}"){name}}`
                            }),
                            beforeSend: () => {
                                $(".swal2-validation-message")
                                    .addClass("no-before")
                                    .css({display:"flex"})
                                    .html(
                                        `<div id="UsernameValidation" style="display:flex; align-items:center; justify-content:center; ">
                                            <div><div id="dataStatusSpinner" style="margin-right:0.5ch;" class="spinner ${savedTheme}"></div></div>
                                            <div>Checking Username...</div>
                                        </div>`
                                    )
                            },
                            success: (data) => {
                                initStartTime = undefined;
                                (async()=>{
                                    await saveJSON(initStartTime,"initStartTime")
                                    $("#UsernameValidation").fadeOut(1000,()=>{
                                        $("#UsernameValidation").remove()
                                        $(".swal2-validation-message")
                                            .addClass("no-before").removeClass("no-before")
                                            .addClass("success-before")
                                            .html("User has been Found")
                                        setTimeout(()=>{
                                            // Reset Custom Validation
                                            $("#filterAlgo-validation").html("").hide()
                                            resolve()
                                        },1000)
                                    })
                                })();
                            },
                            error: (xhr) =>{
                                try{
                                    if(xhr.responseJSON.errors[0].message==='Not Found.'){
                                        initStartTime = undefined;
                                        (async()=>{
                                            await saveJSON(initStartTime,"initStartTime")
                                            $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                            resolve("Username not Found, Please Try Again")
                                        })();
                                    }
                                } catch(ex){}
                                try{
                                    if(xhr.responseJSON.data.User==null){
                                        initStartTime = undefined;
                                        (async()=>{
                                            await saveJSON(initStartTime,"initStartTime")
                                            $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                            resolve("Username not Found, Please Try Again")
                                        })();
                                    }
                                } catch(ex){
                                    if((Math.floor(new Date()-initStartTime)>60000)||initStartTime===undefined){
                                        initStartTime = new Date();
                                        (async()=>{
                                            await saveJSON(initStartTime,"initStartTime")
                                        })();
                                    }
                                    $("#UsernameValidation").fadeOut(1000,()=>$(this).remove())
                                    resolve(`An Error Occured, Please Try Again in ${msToTime(Math.max(60000-(new Date()-initStartTime),1000))}`)
                                }
                            }
                        })
                    }
                })
            }
        })
        $("#filterAlgo-validation").html("").hide()
        if(username){
            await $("#username").val(username)
            Update(false)
        }
    }

    function malanilistImportExport(){
        Swal.fire({
            heightAuto: false,
            title: "Transfer MAL to Anilist",
            icon: "info",
            text: `In order to transfer your MAL list to Anilist, you first need to export your list from MAL (e.g, xml file or extract the zip file first) and import the exported MAL file to your Anilist account, click a button below to continue.`,
            showConfirmButton: true,
            denyButtonText: "Export MAL",
            denyButtonColor: '#2E51A2',
            showDenyButton: true,
            confirmButtonText: "Import to Anilist",
            confirmButtonColor: "#000",
            showCancelButton: true,
            cancelButtonText: "Cancel",
            cancelButtonColor: "#e27d81",
            allowOutsideClick: false,
            allowEscapeKey: false,
            reverseButtons: true,
            footer: `<a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=eWooqnJ87-0">Watch this video for tutorial</a>
                        <a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=rfHTiT_7a4U">Auto sync MAL and Anilist</a>`
        }).then(async(value) => {
            if(value.isConfirmed){
                await window.open('https://anilist.co/settings/import', '_blank');
                malanilistImportExport()
            } else if(value.isDenied) {
                await window.open('https://myanimelist.net/panel.php?go=export', '_blank');
                malanilistImportExport()
            }
        })
    }
    
    async function loadTheme(newTheme,prevTheme){
        return await new Promise(async(resolve)=>{
            if(prevTheme!==undefined){
                await $(` 
                    html
                    body,
                    button,
                    .overlay,
                    #username, 
                    .flexdatalist-multiple,
                    .flexdatalist-alias,
                    .flexdatalist-results,
                    .flexdatalist-multiple li.value,
                    #animeRecommendationList td,
                    #anime-table thead,
                    #anime-table tbody,
                    #anime-table th,
                    #anime-table tr,
                    #anime-table td,
                    .table-responsive,
                    #animeRecommendationList a,
                    .userInput, 
                    .nav, 
                    #pager,
                    #pageNumberOptions,
                    .swal2-popup,
                    .swal2-popup-custom,
                    .swal2-validation-message,
                    .swal2-footer a,
                    .swal2-confirm, 
                    .swal2-confirm-custom,
                    .spinner
                `).removeClass(prevTheme)
                await $(`#pager`).on('click',()=>{
                    $(`#animeRecommendationList td,
                        #anime-table thead,
                        #anime-table tbody,
                        #anime-table th,
                        #anime-table tr,
                        #anime-table td,
                        .table-responsive,
                        #animeRecommendationList a
                    `).removeClass(prevTheme)
                })
            }
            if(newTheme!=="lightMode"){
                await $(` 
                    html,
                    body,
                    button,
                    .overlay,
                    #username, 
                    .flexdatalist-multiple,
                    .flexdatalist-alias,
                    .flexdatalist-results,
                    .flexdatalist-multiple li.value,
                    #animeRecommendationList td,
                    #anime-table thead,
                    #anime-table tbody,
                    #anime-table th,
                    #anime-table tr,
                    #anime-table td,
                    .table-responsive,
                    #animeRecommendationList a,
                    .userInput, 
                    .nav, 
                    #pager,
                    #pageNumberOptions,
                    .swal2-popup,
                    .swal2-popup-custom,
                    .swal2-validation-message,
                    .swal2-footer a,
                    .swal2-confirm, 
                    .swal2-confirm-custom,
                    .spinner
                `).addClass(newTheme)
                await $(`#pager`).on('click',()=>{
                    $(`#animeRecommendationList td,
                        #anime-table thead,
                        #anime-table tbody,
                        #anime-table th,
                        #anime-table tr,
                        #anime-table td,
                        .table-responsive,
                        #animeRecommendationList a
                    `).addClass(newTheme)
                })
                resolve()
            } else {
                resolve()
            }
        })
    }
    
    // Helper Function 
    async function saveJSON(data, name) { 
        return new Promise((resolve)=>{
            try { 
                var write = db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").openCursor() 
                write.onsuccess = (event) => { 
                    const cursor = event.target.result; 
                    if (cursor) { 
                        if(cursor.key===name){ 
                            cursor.update(data) 
                            resolve() 
                        } 
                        cursor.continue() 
                    } else { 
                        db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").add(data, name) 
                        resolve() 
                    } 
                } 
            } catch(ex) { 
                try{ 
                    console.error(ex) 
                    db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").add(data, name) 
                    resolve() 
                } catch(ex2) { 
                    console.error(ex2) 
                    localStorage.setItem(name, JSON.stringify(data)) 
                    resolve() 
                } 
            } 
        }) 
    }
    async function retrieveJSON(name) {
        return new Promise((resolve)=>{
            try {
                var read = db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").get(name)
                read.onsuccess = (event) => {
                    resolve(read.result)
                }
                read.onerror = (event) => {
                    resolve(JSON.parse(localStorage.getItem(name)))
                }
            } catch(ex){
                console.error(ex)
                resolve(JSON.parse(localStorage.getItem(name)))
            }
        })
    }
    async function deleteJSON(name) { 
        return new Promise((resolve)=>{ 
            try { 
                db.transaction("MyObjectStore","readwrite").objectStore("MyObjectStore").delete(name) 
                read.onsuccess = (event) => { 
                    resolve() 
                } 
                read.onerror = (event) => { 
                    JSON.parse(localStorage.removeItem(name)) 
                    resolve() 
                } 
            } catch(ex) { 
                console.error(ex) 
                JSON.parse(localStorage.removeItem(name)) 
                resolve() 
            } 
        }) 
    }
    function equalsNCS(str1, str2) {
        var s1 = str1
        var s2 = str2
        if(typeof s1==="number") s1 = s1.toString()
        if(typeof s2==="number") s2 = s2.toString()
        if(typeof s1==="string") s1 = s1.trim().toLowerCase()
        if(typeof s2==="string") s2 = s2.trim().toLowerCase()
        return s1 === s2
    }
    function jsonIsEmpty(obj){
        for(var i in obj) return false
        return true
    }
    function isJson(j){
        if(j instanceof Array||typeof j==="string") return false
        for(e in j) return true
        return false
    }
    function arraySum(obj) {
        return obj.reduce((a, b) => a + b, 0)
    }
    function arrayMean(obj) {
        return (arraySum(obj) / obj.length) || 0
    }
    function msToTime(duration) {
        var seconds = Math.floor((duration / 1000) % 60),
            minutes = Math.floor((duration / (1000*60)) % 60),
            hours = Math.floor((duration / (1000*60*60)) % 24),
            days = Math.floor((duration / (1000*60*60*24)) % 7),
            weeks = Math.floor((duration / (1000*60*60*24*7)) % 4),
            months = Math.floor((duration / (1000*60*60*24*7*4)) % 12)
            years = Math.floor((duration / (1000*60*60*24*7*4*12)) % 10)
            decades = Math.floor((duration / (1000*60*60*24*7*4*12*10)) % 10)
            century = Math.floor((duration / (1000*60*60*24*7*4*12*10*10)) % 10)
            millenium = Math.floor((duration / (1000*60*60*24*7*4*12*10*10*10)) % 10)
        var time = []
        if(millenium<=0&&century<=0&&decades<=0&&years<=0&&months<=0&&weeks<=0&&days<=0&&hours<=0&&minutes<=0&&seconds<=0) return "0s"
        if(millenium>0) time.push(millenium===1?`${millenium}mil`:`${millenium}mils`)
        if(decades>0) time.push(decades===1?`${decades}de`:`${decades}des`)
        if(years>0) time.push(`${years}y`)
        if(months>0) time.push(months===1?`${months}mo`:`${months}mos`)
        if(weeks>0) time.push(`${weeks}w`)
        if(days>0) time.push(`${days}d`)
        if(hours>0) time.push(`${hours}h`)
        if(minutes>0) time.push(`${minutes}m`)
        if(seconds>0) time.push(`${seconds}s`)
        return time.join(" ")
    }
    // Browser
    async function downloadObjectAsJson(objStr, fileName) {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(new Blob([objStr], { type:`text/json` }));
        a.download = fileName;
        a.click();
    }
    // Browser
    function isJsonString(str) {
        try {JSON.parse(str);}
        catch (e) {return false;}
        return true;
    }
    async function parseJsonFile(file) {
        return new Promise((resolve, reject) => {
            const fileReader = new FileReader()
            fileReader.onload = event => resolve(JSON.parse(event.target.result))
            fileReader.onerror = error => reject(error)
            fileReader.readAsText(file)
        })
    }
    // Browser
    // Notification
    function showNotification(text) {
        if(document.hasFocus()) return
        const notification = new Notification('Kanshi. Recommendation Update', {
            body: text,
            icon: './public/logo.png'
        })
        setTimeout(() => {
            notification.close();
        }, 10 * 1000)
        notification.addEventListener('click', () => {
            window.parent.parent.focus()
        })
    }
    (async ()=>{
        if (Notification.permission === 'granted') {
            notificationGranted = true
        } else if (Notification.permission !== 'denied') {
            let permission = await Notification.requestPermission()
            notificationGranted = permission === 'granted' ? true : false
        }
    })();
    //Browser
    </script>
</body>
</html>
